!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ExampleApp=e():t.ExampleApp=e()}(self,()=>(()=>{"use strict";var t={1:t=>{t.exports="\nprecision mediump float;\nprecision mediump int;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying mat4 v_model;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_attenuation;\nvarying float v_light1_ambient_coefficient;\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\nvarying vec4 v_shadow_pos;\n\nuniform sampler2D texture;\nuniform sampler2D shadowMap;\nuniform float numLights;\n\nstruct Light {\n  vec3 position;\n  vec3 intensities;\n  float ambientCoefficient;\n  float attenuation;\n};\n\nfloat decodeFloat(vec4 color) {\n  const vec4 bitShift = vec4(\n    1.0 / (256.0 * 256.0 * 256.0),\n    1.0 / (256.0 * 256.0),\n    1.0 / 256.0,\n    1\n  );\n  return dot(color, bitShift);\n}\n\nfloat random(vec3 seed, int i) {\n  vec4 seed4 = vec4(seed, i);\n  float dot_product = dot(seed4, vec4(12.9898, 78.233, 45.164, 94.673));\n  return fract(sin(dot_product) * 43758.5453);\n}\n\nvec2 poisson(int index) {\n  if (index == 0)\n    return vec2(-0.94201624, -0.39906216);\n  if (index == 1)\n    return vec2(0.94558609, -0.76890725);\n  if (index == 2)\n    return vec2(-0.094184101, -0.92938870);\n  if (index == 3)\n    return vec2(0.34495938, 0.29387760);\n  if (index == 4)\n    return vec2(-0.91588581, 0.45771432);\n  if (index == 5)\n    return vec2(-0.81544232, -0.87912464);\n  if (index == 6)\n    return vec2(-0.38277543, 0.27676845);\n  if (index == 7)\n    return vec2(0.97484398, 0.75648379);\n  if (index == 8)\n    return vec2(0.44323325, -0.97511554);\n  if (index == 9)\n    return vec2(0.53742981, -0.47373420);\n  if (index == 10)\n    return vec2(-0.26496911, -0.41893023);\n  if (index == 11)\n    return vec2(0.79197514, 0.19090188);\n  if (index == 12)\n    return vec2(-0.24188840, 0.99706507);\n  if (index == 13)\n    return vec2(-0.81409955, 0.91437590);\n  if (index == 14)\n    return vec2(0.19984126, 0.78641367);\n  if (index == 15)\n    return vec2(0.14383161, -0.14100790);\n  return vec2(0, 0);\n}\n\nfloat unpackRGBAToDepth(const vec4 v) {\n  const float UnpackDownscale = 255. / 256.;\n  const vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n  const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.);\n  return dot(v, UnpackFactors);\n}\n\nvoid main(void) {\n  Light light1;\n  light1.intensities = v_light1_intensities;\n  light1.position = v_light1_pos;\n  light1.attenuation = v_light1_attenuation;\n  light1.ambientCoefficient = v_light1_ambient_coefficient;\n\n  vec4 surfaceColor = texture2D(texture, v_texture_coords);\n  vec3 diffuse = v_diffuseCoefficient * surfaceColor.rgb * light1.intensities;\n  vec3 ambient = light1.ambientCoefficient * surfaceColor.rgb * light1.intensities;\n  vec3 n = normalize(v_normal);\n  vec3 l = normalize(v_light1_pos);\n  float cosTheta = clamp(dot(n, l), 0.0, 1.0);\n\n  const float texelSize = 1.0 / 1024.0;\n\n  float amountInLight = 0.0;\n\n  vec3 fragmentDepth = v_shadow_pos.xyz / v_shadow_pos.w;\n  const float shadowAcneRemover = 0.001;\n  fragmentDepth.z -= shadowAcneRemover;\n\n  float soften = 0.0;\n  for (int x = -1; x <= 1; x++) {\n    for (int y = -1; y <= 1; y++) {\n      float texelDepth = unpackRGBAToDepth(texture2D(shadowMap, fragmentDepth.xy + vec2(x, y) * texelSize));\n      soften += 1.0;\n      if (fragmentDepth.z < texelDepth) {\n        amountInLight += 1.0;\n      }\n    }\n  }\n\n  amountInLight /= soften;\n\n  vec3 linearColor = ambient + amountInLight * v_attenuation * diffuse * cosTheta;\n  vec3 gamma = vec3(1.0 / 2.2);\n  gl_FragColor = vec4(pow(linearColor, gamma), surfaceColor.a);\n}\n"},368:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(1620),i=n(2224),o=function(){function t(t){this.ctx=t,this.program=new r.default(t)}return t.prototype.updatePerspective=function(t){this.program.bindProgram(),this.program.glSetProjectMatrix(t)},t.prototype.delete=function(){this.program.arrayBuffer.delete(),this.program.delete()},t.prototype.setLight=function(t,e){this.program.setLight(t,e)},t.prototype.updateBuffer=function(t,e){var n=t.getOpt();if(i.ShaderType.THREE_DIMENSION===n.shaderType){var o=this.program.arrayBuffer.bufferReg[t.rendererBufferId];e&&e.length===o.verticesSize||console.error("New Buffer data does not match initial buffer data!",t,e,o.verticesSize),this.program.arrayBuffer.bufferSub(o.offset,e,r.default.DRAW_VERTEX_SIZE)}else console.error("Updating buffer for registered 3D Entity but with different shader type as RenderOptions",n)},t.prototype._render3DShadowEntities=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n[0],o=n[1],a=r.getOpt();if(this.program.glSetShadowModelMatrix(o),!r.rendererBufferId)throw new Error("Unregistered entity buffer"+r);var s=this.program.arrayBuffer.bufferReg[r.rendererBufferId];a.renderType===i.RenderType.TRIANGLE?this.ctx.drawArrays(this.ctx.TRIANGLES,s.offset,s.size):this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,s.offset,s.size)}},t.prototype._setupShadow=function(){this.program.bindShadowTexture()},t.prototype.render3DShadowMap=function(t,e){this.program.isShadowEnabled&&(this.ctx.disable(this.ctx.CULL_FACE),this.program.prepareShadowTexture(),this._render3DShadowEntities(t),this.program.revertShadowTexture(),e(),this.ctx.enable(this.ctx.CULL_FACE),this.ctx.cullFace(this.ctx.BACK),this._setupShadow())},t.prototype.render=function(t,e,n,r){this.program.arrayBuffer.bind(),this.program.bindAttributePointers(),this.program.bindProgram(),this.program.glSetViewMatrix(e.viewMatrix),r?(this.ctx.isEnabled(this.ctx.CULL_FACE)&&this.ctx.disable(this.ctx.CULL_FACE),this.ctx.isEnabled(this.ctx.DEPTH_TEST)&&this.ctx.disable(this.ctx.DEPTH_TEST)):(this.ctx.isEnabled(this.ctx.CULL_FACE)||this.ctx.enable(this.ctx.CULL_FACE),this.ctx.isEnabled(this.ctx.DEPTH_TEST)||this.ctx.enable(this.ctx.DEPTH_TEST));for(var o=0;o<t.length;o++){var a=t[o],s=a[0],u=a[1],c=s.getOpt();if(!s.rendererTextureRef)throw new Error("Unregistered entity texture"+s);var h=n[s.rendererTextureRef];if(this.program.bindTexture(h.texture),this.program.glSetModelViewMatrix(u),!s.rendererBufferId)throw new Error("Unregistered entity buffer"+s);var f=this.program.arrayBuffer.bufferReg[s.rendererBufferId];c.renderType===i.RenderType.TRIANGLE?this.ctx.drawArrays(this.ctx.TRIANGLES,f.offset,f.size):this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,f.offset,f.size)}this.program.arrayBuffer.unbind(),this.program.unbindAttributePointers(),this.program.unbindProgram()},t.prototype.bindBuffer=function(){this.program.arrayBuffer.bufferBind()},t.prototype.registerEntity=function(t,e){var n=e.length/r.default.DRAW_VERTEX_SIZE;this.program.arrayBuffer.bufferReg[this.program.arrayBuffer.bufferRegId]={offset:this.program.arrayBuffer.length(),size:n,verticesSize:e.length},this.program.arrayBuffer.push(e,n),t.rendererBufferId=this.program.arrayBuffer.bufferRegId,this.program.arrayBuffer.bufferRegId++},t}();e.default=o},372:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(842),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this[0]},set:function(t){this[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this[1]},set:function(t){this[1]=t},enumerable:!1,configurable:!0}),e.prototype.normalise=function(){return o.default.normalize(e.newVector(0,0),this)},e.prototype.dot=function(t){return o.default.dot(this,t)},e.prototype.negate=function(){return o.default.negate(e.newVector(0,0),this)},e.prototype.scale=function(t){return o.default.scale(e.newVector(0,0),this,t)},e.prototype.subtract=function(t){return o.default.subtract(e.newVector(0,0),this,t)},e.prototype.add=function(t){return o.default.add(e.newVector(0,0),this,t)},e.newVector=function(t,n){var r=new e;return r.x=t,r.y=n,r},e}(Float32Array);e.default=a},534:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2224),a=n(5103),s=n(5673),u=n(5425),c=n(5642),h=n(9463),f=function(t){function e(e,n){var r=t.call(this)||this;return r.rgba=n,r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(t){this.vertexModel=(new c.default).fillRenderUnits(h.default.vertex.planeXYColour(this.rgba||new u.default(0,0,0,0)));var e=new o.default;e.renderType=o.RenderType.TRIANGLE,e.shaderType=o.ShaderType.COLOUR,this.shaderEntity=new s.default(t).addBuffer(this.vertexModel).build(this,e)},e}(a.default);e.default=f},566:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(1355),i=n(684),o=n(7613),a=function(){function t(){var t=this;this.position=new o.default,this.dirtyModel=!0,this.dirtyQuat=!0,this.dirtyPos=!0,this.dirtyScale=!0,this.dirtyOrigin=!0,this.intermediateModels=[r.mat4.create(),r.mat4.create(),r.mat4.create(),r.mat4.create()],this.initialMat4Temp=r.mat4.create(),this.rotateQuatTemp=r.quat.create(),this.rotateMat4Temp=r.mat4.create(),this.getModel=function(){return t.dirtyModel&&(t.dirtyModel=!1,t._buildModel()),t.cachedModel},this.getPosition=function(){return t.position}}return t.prototype.setPosition=function(t){this.position=t,this.dirtyOrigin=!0,this.dirtyQuat=!0,this.dirtyPos=!0,this.dirtyModel=!0},t.prototype.pos=function(){return[this.position.x,this.position.y,this.position.z]},t.prototype.centerRect=function(t){this.center(t.x,t.y,t.z)},t.prototype.rotateOriginRect=function(t){this.rotateOrigin(t.x,t.y,t.z)},t.prototype.centerCoord=function(t){this.center(t.x,t.y,t.z)},t.prototype.center=function(t,e,n){this.position.x===t&&this.position.y===e&&this.position.z===n||(this.position.x=t,this.position.y=e,this.position.z=n,this.dirtyPos=!0,this.dirtyModel=!0,this.rotateOrigin(t,e,n))},t.prototype.translate=function(t,e,n){this.position.x+=t,this.position.y+=e,this.position.z+=n,this.dirtyPos=!0,this.dirtyModel=!0,this.rotateOrigin(this.position.x,this.position.y,this.position.z)},t.prototype.rotateOrigin=function(t,e,n){this.position.originX===t&&this.position.originY===e&&this.position.originZ===n||(this.position.originX=t,this.position.originY=e,this.position.originZ=n,this.dirtyOrigin=!0,this.dirtyQuat=!0,this.dirtyModel=!0)},t.prototype.angleX=function(t){this.position.ax!==t&&(this.position.ax=t,this.dirtyQuat=!0,this.dirtyModel=!0)},t.prototype.angleY=function(t){this.position.ay!==t&&(this.position.ay=t,this.dirtyQuat=!0,this.dirtyModel=!0)},t.prototype.angleZ=function(t){this.position.az!==t&&(this.position.az=t,this.dirtyQuat=!0,this.dirtyModel=!0)},t.prototype.rotateX=function(t){this.angleX(t)},t.prototype.rotateY=function(t){this.angleY(t)},t.prototype.rotateZ=function(t){this.angleZ(t)},t.prototype.scaleX=function(t){this.position.scaleX=t,this.position.width=this.position.scaleX,this.dirtyScale=!0,this.dirtyModel=!0},t.prototype.scaleY=function(t){this.position.scaleY=t,this.position.height=this.position.scaleY,this.dirtyScale=!0,this.dirtyModel=!0},t.prototype.scaleZ=function(t){this.position.scaleZ=t,this.dirtyScale=!0,this.dirtyModel=!0},t.prototype.scale=function(t,e,n){this.position.scaleX===t&&this.position.scaleY===e&&this.position.scaleZ===n||(this.position.scaleX=t,this.position.scaleY=e,this.position.scaleZ=n,this.position.width=t,this.position.height=e,this.position.length=n,this.dirtyScale=!0,this.dirtyModel=!0)},t.prototype.scaleRect=function(t){this.scale(t.width,t.height,t.length)},t.prototype._buildQuat=function(){var t=this.createMat4NoAlloc(this.rotateMat4Temp),e=this.createQuatNoAlloc(this.rotateQuatTemp);return e=r.quat.rotateX(e,e,this.degreesToRadians(this.position.ax)),e=r.quat.rotateY(e,e,this.degreesToRadians(this.position.ay)),e=r.quat.rotateZ(e,e,this.degreesToRadians(this.position.az)),e=r.quat.normalize(e,e),r.mat4.fromQuat(t,e)},t.prototype.getIntermediateModel=function(t,e){var n=this.intermediateModels[t];for(var r in e)e.hasOwnProperty(r)&&(e[r]=n[r]);return e},t.prototype._buildModelIntermediate=function(t,e){var n=this.intermediateModels[t];for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return e},t.prototype.createQuatNoAlloc=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},t.prototype.createMat4NoAlloc=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.prototype._buildModel=function(){var t=!1,e=this.createMat4NoAlloc(this.initialMat4Temp);if(this.dirtyOrigin){t=!0;var n=[this.position.originX,this.position.originY,this.position.originZ];r.mat4.translate(e,e,n),this._buildModelIntermediate(0,e)}else e=this.getIntermediateModel(0,e);if(this.dirtyQuat||t?(t=!0,this.quatRotationxyz=this._buildQuat(),r.mat4.multiply(e,e,this.quatRotationxyz),this._buildModelIntermediate(1,e)):e=this.getIntermediateModel(1,e),this.dirtyPos||t){t=!0;var i=[-1*this.position.originX,-1*this.position.originY,-1*this.position.originZ];r.mat4.translate(e,e,i);var o=[this.position.x,this.position.y,this.position.z];r.mat4.translate(e,e,o),this._buildModelIntermediate(2,e)}else e=this.getIntermediateModel(2,e);if(this.dirtyScale||t){t=!0;var a=[this.position.scaleX,this.position.scaleY,this.position.scaleZ];r.mat4.scale(e,e,a),this._buildModelIntermediate(3,e)}else e=this.getIntermediateModel(3,e);this.dirtyPos=!1,this.dirtyQuat=!1,this.dirtyScale=!1,this.dirtyOrigin=!1,this.cachedModel=e},t.prototype.degreesToRadians=function(t){return Math.round(100*r.glMatrix.toRadian(t))/100},t.prototype.setRect=function(t){this.scaleRect(t),this.centerRect(t)},t.prototype.setRect2=function(t,e,n,r,i,o){this.scale(r,i,o),this.center(t,e,n)},t.prototype.getRect2=function(){return this.position},t.prototype.getRect=function(){return new i.default(this.position.x,this.position.y,this.position.z,this.position.width,this.position.height,this.position.length)},t}();e.default=a},684:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n,r,i,o,a){var s=t.call(this,e,n,r)||this;return s.width=i||0,s.height=o||0,s.length=a||0,s}return i(e,t),e.prototype.center=function(){return this.centre&&this.equalCenter(this.centre)||(this.centre=this.newCenter()),this.centre},e.prototype.equal=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.width===this.width&&t.height===this.height&&t.length===this.length},e.prototype.equalCenter=function(t){return t.x===this.x+this.width/2&&t.y===this.y+this.height/2&&t.z===this.z+this.length/2&&t.width===this.width&&t.height===this.height&&t.length===this.length},e.prototype.newCenter=function(){return new e(this.x+this.width/2,this.y+this.height/2,this.z+this.length/2,this.width,this.height,this.length)},e}(n(2667).default);e.default=o},842:(t,e,n)=>{n.r(e),n.d(e,{add:()=>c,angle:()=>j,ceil:()=>p,clone:()=>o,copy:()=>s,create:()=>i,cross:()=>O,dist:()=>G,distance:()=>_,div:()=>k,divide:()=>l,dot:()=>R,equals:()=>z,exactEquals:()=>B,floor:()=>d,forEach:()=>Z,fromValues:()=>a,inverse:()=>T,len:()=>V,length:()=>w,lerp:()=>S,max:()=>v,min:()=>y,mul:()=>X,multiply:()=>f,negate:()=>M,normalize:()=>P,random:()=>I,rotate:()=>L,round:()=>m,scale:()=>b,scaleAndAdd:()=>g,set:()=>u,sqrDist:()=>q,sqrLen:()=>W,squaredDistance:()=>x,squaredLength:()=>E,str:()=>U,sub:()=>H,subtract:()=>h,transformMat2:()=>C,transformMat2d:()=>A,transformMat3:()=>D,transformMat4:()=>N,zero:()=>F});var r=n(7823);function i(){var t=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function o(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e}function a(t,e){var n=new r.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n}function s(t,e){return t[0]=e[0],t[1]=e[1],t}function u(t,e,n){return t[0]=e,t[1]=n,t}function c(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function h(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function f(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function l(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function p(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function d(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function y(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function v(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function m(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function b(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function g(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function _(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function x(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function w(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function E(t){var e=t[0],n=t[1];return e*e+n*n}function M(t,e){return t[0]=-e[0],t[1]=-e[1],t}function T(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function P(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function R(t,e){return t[0]*e[0]+t[1]*e[1]}function O(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function S(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function I(t,e){e=e||1;var n=2*r.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function C(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function A(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function D(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function N(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function L(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=i*s-o*a+n[0],t[1]=i*a+o*s+n[1],t}function j(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),s=a&&(n*i+r*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}function F(t){return t[0]=0,t[1]=0,t}function U(t){return"vec2("+t[0]+", "+t[1]+")"}function B(t,e){return t[0]===e[0]&&t[1]===e[1]}function z(t,e){var n=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))}var Y,V=w,H=h,X=f,k=l,G=_,q=x,W=E,Z=(Y=i(),function(t,e,n,r,i,o){var a,s;for(e||(e=2),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)Y[0]=t[a],Y[1]=t[a+1],i(Y,Y,o),t[a]=Y[0],t[a+1]=Y[1];return t})},978:function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.SubscriptionListeners=e.Subscription=void 0;var i=function(t){this.key=t};e.Subscription=i;var o=function(t){function e(e){var n=t.call(this,e)||this;return n.listeners={},n.subscriptionId=0,n}return r(e,t),e.prototype.listen=function(t){return this.listeners[this.subscriptionId++]=t,this.subscriptionId-1},e.prototype.unlisten=function(t){delete this.listeners[t]},e.prototype.publish=function(t){Object.values(this.listeners).forEach(function(e){return e(t)})},e.prototype.flush=function(){this.listeners={}},e}(i);e.SubscriptionListeners=o;var a=function(){function t(){this.subscribers={}}return t.prototype.listen=function(t,e){return this.getSubscriptionListeners(t).listen(e)},t.prototype.getSubscriptionListeners=function(t){var e=t.key;return this.subscribers[e]||(this.subscribers[e]=new o(e)),this.subscribers[e]},t.prototype.publish=function(t,e){this.getSubscriptionListeners(t).publish(e)},t}();e.default=a},993:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5673),a=n(2224),s=function(t){function e(e,n){var r=t.call(this)||this;return r.renderType=a.RenderType.TRIANGLE,r.vertexModel=n,r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.setRenderType=function(t){this.renderType=t},e.prototype.init=function(t){var e=new a.default;e.renderType=this.renderType,e.shaderType=a.ShaderType.THREE_DIMENSION,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).createTexture(this.vertexModel.textureSource).build(this,e)},e}(n(5103).default);e.default=s},1213:function(t,e,n){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigEntity=void 0;var i=n(8043),o=n(8148),a=n(5835),s=n(4648),u=n(3637),c=n(534),h=n(6058),f=n(1866),l=n(8184),p=n(2667),d=n(5881),y=n(684),v=n(5103),m=n(5063),b=n(2067),g=n(3335),_=function(){function t(t){this.engineHelper=t,this.objects=[],this.ref={},this.anchor={},this.texts=[]}return t.prototype.build=function(t){for(var e in t)if(t.hasOwnProperty(e))if(e.startsWith("$"))this.ref[e]=t[e];else if(e.startsWith("+"))this.anchor[e]=t[e];else{var n=t[e];if(this.initObjectPosition(n),n.$ref&&this.ref[n.$ref]&&(n=r(r({},this.ref[n.$ref]),n)),n.$anchor&&this.anchor[n.$anchor]){var i=this.anchor[n.$anchor];"Font"===n.type?(n.position.x+=i.position.x,n.position.y+=i.position.y):(n.position.x+=i.position.x,n.position.y+=i.position.y,n.position.width+=i.position.width,n.position.height+=i.position.height)}this.buildModel(n)}},t.prototype.initObjectPosition=function(t){t.position?(t.position.x||(t.position.x=0),t.position.y||(t.position.y=0),t.position.width||(t.position.width=0),t.position.height||(t.position.height=0)):t.position={x:0,y:0,height:0,width:0}},t.prototype.buildModel=function(t){if(!t.type)return console.error("unable to parse empty type for object",t),null;var e=null;return"Plane2D"===t.type?(e=this.createPlane2D(t.model,this.createRect2d(t.position,t.isCentre),t.hasPhysics),this.hookCustomHandler(t,e)):"Plane3D"===t.type?(e=this.createPlane3D(t.model,this.createRect3d(t.position,t.isCentre),t.hasPhysics,t.planeType),this.hookCustomHandler(t,e)):"Triangle"===t.type?(e=this.createTriangle(t.rgba,this.createRect2d(t.position,t.isCentre)),this.hookCustomHandler(t,e)):"SpriteMoveable"===t.type?(e=this.createSpriteMoveable(t.spriteModel,this.createRect2d(t.position,t.isCentre),t.hasPhysics,t.ticks),this.hookCustomHandler(t,e)):"Moveable"===t.type?(e=this.createMoveable(t.model,this.createRect2d(t.position,t.isCentre),t.hasPhysics),this.hookCustomHandler(t,e)):"Sprite"===t.type?(e=this.createSprite(t.spriteModel,this.createRect2d(t.position,t.isCentre),t.hasPhysics,t.ticks),this.hookCustomHandler(t,e)):"Font"===t.type?(e=this.createText(t.texture,this.createCoordinate(t.position),t.fontSize,t.text)).id=t.id:"Colour"===t.type?(e=this.createColour(t.rgba,this.createRect2d(t.position,t.isCentre)),this.hookCustomHandler(t,e)):"Line"===t.type?(e=this.createLineColour(t.rgba,t.point1,t.point2,t.thickness),this.hookCustomHandler(t,e)):console.warn("Unable to find entity of type ".concat(t.type)),e instanceof v.default&&(e.$id=t.id||e.$id,e.data=t.data,e.isLastEvent=t.isLastEvent||!1),(e instanceof v.default||e instanceof b.FontReference)&&t.isTop&&e.setTop(!0),e instanceof v.default&&t.clone&&e.setClone(!0),e},t.prototype.hookCustomHandler=function(t,e){var n=this;if(t.render){var r;r="function"==typeof window[t.render]?window[t.render].bind(e):"function"==typeof t.render?t.render:function(){};var i=e.render.bind(e);e.render=function(t){i(t),r(t)}}if(t.update){var o;o="function"==typeof window[t.update]?window[t.update].bind(e):"function"==typeof t.update?t.update:function(){};var a=e.update.bind(e);e.update=function(t){a(t),o(t)}}var s=t.onClick&&"function"==typeof t.onClick;if(t.event){var u;u="function"==typeof window[t.event]?window[t.event].bind(e):"function"==typeof t.event?t.event:function(){};var c=e.event.bind(e);e.event=function(r,i){var o=!0;return o=(o=o&&!1!==c(r,i))&&!1!==u(r,i,e),s&&(o=o&&!1!==n.isClicked(r,i,e,t.onClick)),o}}else if(s){var h=e.event.bind(e);e.event=function(r,i){var o=!1!==h(r,i);return o&&!1!==n.isClicked(r,i,e,t.onClick)}}},t.prototype.isClicked=function(t,e,n,r){if(t.eventType===m.default.UP&&e.isClicked(t,n.getRect2())&&!1===n.hidden)return r.bind(n)(t,e,n)},t.prototype.createRect2d=function(t,e){var n=new d.default(Number(t.x),Number(t.y),Number(t.width),Number(t.height),0);return e?n.center():n},t.prototype.createRect3d=function(t,e){var n=new y.default(Number(t.x),Number(t.y),Number(t.z),Number(t.width),Number(t.height),Number(t.length));return e?n.center():n},t.prototype.createCoordinate=function(t){return new p.default(Number(t.x),Number(t.y),0)},t.prototype.createText=function(t,e,n,r){var i=b.FontReference.newFont(e,t,0).setText(r).setFontSize(n);return this.texts.push(i),i},t.prototype.createLineColour=function(t,e,n,r){var i=new o.default(e,n,r,t);return this.objects.push(i),i},t.prototype.createColour=function(t,e){var n=new c.default(e,t);return this.objects.push(n),n},t.prototype.createSpriteMoveable=function(t,e,n,r){var i=new h.default(e,r||120,t),o=new f.default(e,i);return i.position.z=-1,i.scaleZ(0),n&&g.default.registerPhysics(o,o.physics),this.objects.push(o),o},t.prototype.createMoveable=function(t,e,n){var r=new s.default(e,t);r.setLayer(-1);var i=new a.default;return i.entities.push(r),i.rotateZ(180),i.setRect(e),n&&g.default.registerPhysics(i,i.physics),i.updatePhysicsPosition(),this.objects.push(i),i},t.prototype.createSprite=function(t,e,n,r){var o=new h.default(e,r||120,t),a=new i.default(e,o);return o.position.z=-1,o.rotateZ(180),o.scaleZ(0),n&&g.default.registerPhysics(a,a.physics),this.objects.push(a),a},t.prototype.createPlane2D=function(t,e,n){var r=new s.default(e,t);return r.rotateZ(180),n&&g.default.registerPhysics(r),this.objects.push(r),r},t.prototype.createPlane3D=function(t,e,n,r){var i=this.engineHelper.newVertexModel(t,r),o=new u.default(e,i);return n&&g.default.registerPhysics(o),this.objects.push(o),o},t.prototype.createTriangle=function(t,e){var n=new l.default(e,t);return this.objects.push(n),n},t}();e.ConfigEntity=function(){},e.default=_},1355:(t,e,n)=>{n.r(e),n.d(e,{glMatrix:()=>f,mat2:()=>r,mat2d:()=>i,mat3:()=>o,mat4:()=>a,quat:()=>c,quat2:()=>h,vec2:()=>Ki,vec3:()=>s,vec4:()=>u});var r={};n.r(r),n.d(r,{LDU:()=>S,add:()=>I,adjoint:()=>_,clone:()=>p,copy:()=>d,create:()=>l,determinant:()=>x,equals:()=>D,exactEquals:()=>A,frob:()=>O,fromRotation:()=>T,fromScaling:()=>P,fromValues:()=>v,identity:()=>y,invert:()=>g,mul:()=>j,multiply:()=>w,multiplyScalar:()=>N,multiplyScalarAndAdd:()=>L,rotate:()=>E,scale:()=>M,set:()=>m,str:()=>R,sub:()=>F,subtract:()=>C,transpose:()=>b});var i={};n.r(i),n.d(i,{add:()=>et,clone:()=>B,copy:()=>z,create:()=>U,determinant:()=>k,equals:()=>at,exactEquals:()=>ot,frob:()=>tt,fromRotation:()=>$,fromScaling:()=>K,fromTranslation:()=>Q,fromValues:()=>V,identity:()=>Y,invert:()=>X,mul:()=>st,multiply:()=>G,multiplyScalar:()=>rt,multiplyScalarAndAdd:()=>it,rotate:()=>q,scale:()=>W,set:()=>H,str:()=>J,sub:()=>ut,subtract:()=>nt,translate:()=>Z});var o={};n.r(o),n.d(o,{add:()=>Dt,adjoint:()=>bt,clone:()=>ft,copy:()=>lt,create:()=>ct,determinant:()=>gt,equals:()=>Ut,exactEquals:()=>Ft,frob:()=>At,fromMat2d:()=>Rt,fromMat4:()=>ht,fromQuat:()=>Ot,fromRotation:()=>Tt,fromScaling:()=>Pt,fromTranslation:()=>Mt,fromValues:()=>pt,identity:()=>yt,invert:()=>mt,mul:()=>Bt,multiply:()=>_t,multiplyScalar:()=>Lt,multiplyScalarAndAdd:()=>jt,normalFromMat4:()=>St,projection:()=>It,rotate:()=>wt,scale:()=>Et,set:()=>dt,str:()=>Ct,sub:()=>zt,subtract:()=>Nt,translate:()=>xt,transpose:()=>vt});var a={};n.r(a),n.d(a,{add:()=>Ie,adjoint:()=>Zt,clone:()=>Vt,copy:()=>Ht,create:()=>Yt,determinant:()=>$t,equals:()=>Le,exactEquals:()=>Ne,frob:()=>Se,fromQuat:()=>me,fromQuat2:()=>fe,fromRotation:()=>ae,fromRotationTranslation:()=>he,fromRotationTranslationScale:()=>ye,fromRotationTranslationScaleOrigin:()=>ve,fromScaling:()=>oe,fromTranslation:()=>ie,fromValues:()=>Xt,fromXRotation:()=>se,fromYRotation:()=>ue,fromZRotation:()=>ce,frustum:()=>be,getRotation:()=>de,getScaling:()=>pe,getTranslation:()=>le,identity:()=>Gt,invert:()=>Wt,lookAt:()=>Pe,mul:()=>je,multiply:()=>Kt,multiplyScalar:()=>Ae,multiplyScalarAndAdd:()=>De,ortho:()=>Me,orthoNO:()=>Ee,orthoZO:()=>Te,perspective:()=>_e,perspectiveFromFieldOfView:()=>we,perspectiveNO:()=>ge,perspectiveZO:()=>xe,rotate:()=>te,rotateX:()=>ee,rotateY:()=>ne,rotateZ:()=>re,scale:()=>Jt,set:()=>kt,str:()=>Oe,sub:()=>Fe,subtract:()=>Ce,targetTo:()=>Re,translate:()=>Qt,transpose:()=>qt});var s={};n.r(s),n.d(s,{add:()=>Xe,angle:()=>_n,bezier:()=>ln,ceil:()=>We,clone:()=>Be,copy:()=>Ve,create:()=>Ue,cross:()=>cn,dist:()=>Sn,distance:()=>en,div:()=>On,divide:()=>qe,dot:()=>un,equals:()=>Mn,exactEquals:()=>En,floor:()=>Ze,forEach:()=>Dn,fromValues:()=>Ye,hermite:()=>fn,inverse:()=>an,len:()=>Cn,length:()=>ze,lerp:()=>hn,max:()=>Ke,min:()=>$e,mul:()=>Rn,multiply:()=>Ge,negate:()=>on,normalize:()=>sn,random:()=>pn,rotateX:()=>mn,rotateY:()=>bn,rotateZ:()=>gn,round:()=>Qe,scale:()=>Je,scaleAndAdd:()=>tn,set:()=>He,sqrDist:()=>In,sqrLen:()=>An,squaredDistance:()=>nn,squaredLength:()=>rn,str:()=>wn,sub:()=>Pn,subtract:()=>ke,transformMat3:()=>yn,transformMat4:()=>dn,transformQuat:()=>vn,zero:()=>xn});var u={};n.r(u),n.d(u,{add:()=>Bn,ceil:()=>Hn,clone:()=>Ln,copy:()=>Fn,create:()=>Nn,cross:()=>ir,dist:()=>vr,distance:()=>$n,div:()=>yr,divide:()=>Vn,dot:()=>rr,equals:()=>lr,exactEquals:()=>fr,floor:()=>Xn,forEach:()=>_r,fromValues:()=>jn,inverse:()=>er,len:()=>br,length:()=>Qn,lerp:()=>or,max:()=>Gn,min:()=>kn,mul:()=>dr,multiply:()=>Yn,negate:()=>tr,normalize:()=>nr,random:()=>ar,round:()=>qn,scale:()=>Wn,scaleAndAdd:()=>Zn,set:()=>Un,sqrDist:()=>mr,sqrLen:()=>gr,squaredDistance:()=>Kn,squaredLength:()=>Jn,str:()=>hr,sub:()=>pr,subtract:()=>zn,transformMat4:()=>sr,transformQuat:()=>ur,zero:()=>cr});var c={};n.r(c),n.d(c,{add:()=>Kr,calculateW:()=>Ir,clone:()=>qr,conjugate:()=>Fr,copy:()=>Zr,create:()=>xr,dot:()=>ti,equals:()=>ui,exactEquals:()=>si,exp:()=>Cr,fromEuler:()=>Br,fromMat3:()=>Ur,fromValues:()=>Wr,getAngle:()=>Tr,getAxisAngle:()=>Mr,identity:()=>wr,invert:()=>jr,len:()=>ri,length:()=>ni,lerp:()=>ei,ln:()=>Ar,mul:()=>Qr,multiply:()=>Pr,normalize:()=>ai,pow:()=>Dr,random:()=>Lr,rotateX:()=>Rr,rotateY:()=>Or,rotateZ:()=>Sr,rotationTo:()=>ci,scale:()=>Jr,set:()=>$r,setAxes:()=>fi,setAxisAngle:()=>Er,slerp:()=>Nr,sqlerp:()=>hi,sqrLen:()=>oi,squaredLength:()=>ii,str:()=>zr});var h={};n.r(h),n.d(h,{add:()=>Li,clone:()=>pi,conjugate:()=>Vi,copy:()=>_i,create:()=>li,dot:()=>Bi,equals:()=>$i,exactEquals:()=>Zi,fromMat4:()=>gi,fromRotation:()=>bi,fromRotationTranslation:()=>vi,fromRotationTranslationValues:()=>yi,fromTranslation:()=>mi,fromValues:()=>di,getDual:()=>Mi,getReal:()=>Ei,getTranslation:()=>Ri,identity:()=>xi,invert:()=>Yi,len:()=>Xi,length:()=>Hi,lerp:()=>zi,mul:()=>Fi,multiply:()=>ji,normalize:()=>qi,rotateAroundAxis:()=>Ni,rotateByQuatAppend:()=>Ai,rotateByQuatPrepend:()=>Di,rotateX:()=>Si,rotateY:()=>Ii,rotateZ:()=>Ci,scale:()=>Ui,set:()=>wi,setDual:()=>Pi,setReal:()=>Ti,sqrLen:()=>Gi,squaredLength:()=>ki,str:()=>Wi,translate:()=>Oi});var f=n(7823);function l(){var t=new f.ARRAY_TYPE(4);return f.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function p(t){var e=new f.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function d(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function v(t,e,n,r){var i=new f.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function m(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function b(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function g(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*o-i*r;return a?(a=1/a,t[0]=o*a,t[1]=-r*a,t[2]=-i*a,t[3]=n*a,t):null}function _(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function x(t){return t[0]*t[3]-t[2]*t[1]}function w(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*s+o*u,t[1]=i*s+a*u,t[2]=r*c+o*h,t[3]=i*c+a*h,t}function E(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t}function M(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1];return t[0]=r*s,t[1]=i*s,t[2]=o*u,t[3]=a*u,t}function T(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function P(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function R(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function O(t){return Math.hypot(t[0],t[1],t[2],t[3])}function S(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function I(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function C(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function A(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function D(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))}function N(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function L(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}var j=w,F=C;function U(){var t=new f.ARRAY_TYPE(6);return f.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function B(t){var e=new f.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function z(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function V(t,e,n,r,i,o){var a=new f.ARRAY_TYPE(6);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a[4]=i,a[5]=o,a}function H(t,e,n,r,i,o,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t}function X(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=n*o-r*i;return u?(u=1/u,t[0]=o*u,t[1]=-r*u,t[2]=-i*u,t[3]=n*u,t[4]=(i*s-o*a)*u,t[5]=(r*a-n*s)*u,t):null}function k(t){return t[0]*t[3]-t[1]*t[2]}function G(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=n[0],h=n[1],f=n[2],l=n[3],p=n[4],d=n[5];return t[0]=r*c+o*h,t[1]=i*c+a*h,t[2]=r*f+o*l,t[3]=i*f+a*l,t[4]=r*p+o*d+s,t[5]=i*p+a*d+u,t}function q(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=Math.sin(n),h=Math.cos(n);return t[0]=r*h+o*c,t[1]=i*h+a*c,t[2]=r*-c+o*h,t[3]=i*-c+a*h,t[4]=s,t[5]=u,t}function W(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r*c,t[1]=i*c,t[2]=o*h,t[3]=a*h,t[4]=s,t[5]=u,t}function Z(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*c+o*h+s,t[5]=i*c+a*h+u,t}function $(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function K(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Q(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function J(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function tt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function et(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function nt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function rt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function it(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function ot(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function at(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=e[0],c=e[1],h=e[2],l=e[3],p=e[4],d=e[5];return Math.abs(n-u)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-h)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-l)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-p)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-d)<=f.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))}var st=G,ut=nt;function ct(){var t=new f.ARRAY_TYPE(9);return f.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function ft(t){var e=new f.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function lt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function pt(t,e,n,r,i,o,a,s,u){var c=new f.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=i,c[5]=o,c[6]=a,c[7]=s,c[8]=u,c}function dt(t,e,n,r,i,o,a,s,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t}function yt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function vt(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function mt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=h*a-s*c,l=-h*o+s*u,p=c*o-a*u,d=n*f+r*l+i*p;return d?(d=1/d,t[0]=f*d,t[1]=(-h*r+i*c)*d,t[2]=(s*r-i*a)*d,t[3]=l*d,t[4]=(h*n-i*u)*d,t[5]=(-s*n+i*o)*d,t[6]=p*d,t[7]=(-c*n+r*u)*d,t[8]=(a*n-r*o)*d,t):null}function bt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8];return t[0]=a*h-s*c,t[1]=i*c-r*h,t[2]=r*s-i*a,t[3]=s*u-o*h,t[4]=n*h-i*u,t[5]=i*o-n*s,t[6]=o*c-a*u,t[7]=r*u-n*c,t[8]=n*a-r*o,t}function gt(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*o-a*u)+n*(-c*i+a*s)+r*(u*i-o*s)}function _t(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=n[0],p=n[1],d=n[2],y=n[3],v=n[4],m=n[5],b=n[6],g=n[7],_=n[8];return t[0]=l*r+p*a+d*c,t[1]=l*i+p*s+d*h,t[2]=l*o+p*u+d*f,t[3]=y*r+v*a+m*c,t[4]=y*i+v*s+m*h,t[5]=y*o+v*u+m*f,t[6]=b*r+g*a+_*c,t[7]=b*i+g*s+_*h,t[8]=b*o+g*u+_*f,t}function xt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=n[0],p=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l*r+p*a+c,t[7]=l*i+p*s+h,t[8]=l*o+p*u+f,t}function wt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=Math.sin(n),p=Math.cos(n);return t[0]=p*r+l*a,t[1]=p*i+l*s,t[2]=p*o+l*u,t[3]=p*a-l*r,t[4]=p*s-l*i,t[5]=p*u-l*o,t[6]=c,t[7]=h,t[8]=f,t}function Et(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Mt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Tt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Pt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Rt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Ot(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,h=r*a,f=r*s,l=i*a,p=i*s,d=i*u,y=o*a,v=o*s,m=o*u;return t[0]=1-f-d,t[3]=h-m,t[6]=l+v,t[1]=h+m,t[4]=1-c-d,t[7]=p-y,t[2]=l-v,t[5]=p+y,t[8]=1-c-f,t}function St(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],l=e[10],p=e[11],d=e[12],y=e[13],v=e[14],m=e[15],b=n*s-r*a,g=n*u-i*a,_=n*c-o*a,x=r*u-i*s,w=r*c-o*s,E=i*c-o*u,M=h*y-f*d,T=h*v-l*d,P=h*m-p*d,R=f*v-l*y,O=f*m-p*y,S=l*m-p*v,I=b*S-g*O+_*R+x*P-w*T+E*M;return I?(I=1/I,t[0]=(s*S-u*O+c*R)*I,t[1]=(u*P-a*S-c*T)*I,t[2]=(a*O-s*P+c*M)*I,t[3]=(i*O-r*S-o*R)*I,t[4]=(n*S-i*P+o*T)*I,t[5]=(r*P-n*O-o*M)*I,t[6]=(y*E-v*w+m*x)*I,t[7]=(v*_-d*E-m*g)*I,t[8]=(d*w-y*_+m*b)*I,t):null}function It(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ct(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function At(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Dt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function Nt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Lt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function jt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Ft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Ut(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],l=e[0],p=e[1],d=e[2],y=e[3],v=e[4],m=e[5],b=e[6],g=e[7],_=e[8];return Math.abs(n-l)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-p)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-d)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-y)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-m)<=f.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-b)<=f.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(c-g)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(h-_)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(_))}var Bt=_t,zt=Nt;function Yt(){var t=new f.ARRAY_TYPE(16);return f.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Vt(t){var e=new f.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Xt(t,e,n,r,i,o,a,s,u,c,h,l,p,d,y,v){var m=new f.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=c,m[10]=h,m[11]=l,m[12]=p,m[13]=d,m[14]=y,m[15]=v,m}function kt(t,e,n,r,i,o,a,s,u,c,h,f,l,p,d,y,v){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=h,t[10]=f,t[11]=l,t[12]=p,t[13]=d,t[14]=y,t[15]=v,t}function Gt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qt(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Wt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],l=e[10],p=e[11],d=e[12],y=e[13],v=e[14],m=e[15],b=n*s-r*a,g=n*u-i*a,_=n*c-o*a,x=r*u-i*s,w=r*c-o*s,E=i*c-o*u,M=h*y-f*d,T=h*v-l*d,P=h*m-p*d,R=f*v-l*y,O=f*m-p*y,S=l*m-p*v,I=b*S-g*O+_*R+x*P-w*T+E*M;return I?(I=1/I,t[0]=(s*S-u*O+c*R)*I,t[1]=(i*O-r*S-o*R)*I,t[2]=(y*E-v*w+m*x)*I,t[3]=(l*w-f*E-p*x)*I,t[4]=(u*P-a*S-c*T)*I,t[5]=(n*S-i*P+o*T)*I,t[6]=(v*_-d*E-m*g)*I,t[7]=(h*E-l*_+p*g)*I,t[8]=(a*O-s*P+c*M)*I,t[9]=(r*P-n*O-o*M)*I,t[10]=(d*w-y*_+m*b)*I,t[11]=(f*_-h*w-p*b)*I,t[12]=(s*T-a*R-u*M)*I,t[13]=(n*R-r*T+i*M)*I,t[14]=(y*g-d*x-v*b)*I,t[15]=(h*x-f*g+l*b)*I,t):null}function Zt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],l=e[10],p=e[11],d=e[12],y=e[13],v=e[14],m=e[15];return t[0]=s*(l*m-p*v)-f*(u*m-c*v)+y*(u*p-c*l),t[1]=-(r*(l*m-p*v)-f*(i*m-o*v)+y*(i*p-o*l)),t[2]=r*(u*m-c*v)-s*(i*m-o*v)+y*(i*c-o*u),t[3]=-(r*(u*p-c*l)-s*(i*p-o*l)+f*(i*c-o*u)),t[4]=-(a*(l*m-p*v)-h*(u*m-c*v)+d*(u*p-c*l)),t[5]=n*(l*m-p*v)-h*(i*m-o*v)+d*(i*p-o*l),t[6]=-(n*(u*m-c*v)-a*(i*m-o*v)+d*(i*c-o*u)),t[7]=n*(u*p-c*l)-a*(i*p-o*l)+h*(i*c-o*u),t[8]=a*(f*m-p*y)-h*(s*m-c*y)+d*(s*p-c*f),t[9]=-(n*(f*m-p*y)-h*(r*m-o*y)+d*(r*p-o*f)),t[10]=n*(s*m-c*y)-a*(r*m-o*y)+d*(r*c-o*s),t[11]=-(n*(s*p-c*f)-a*(r*p-o*f)+h*(r*c-o*s)),t[12]=-(a*(f*v-l*y)-h*(s*v-u*y)+d*(s*l-u*f)),t[13]=n*(f*v-l*y)-h*(r*v-i*y)+d*(r*l-i*f),t[14]=-(n*(s*v-u*y)-a*(r*v-i*y)+d*(r*u-i*s)),t[15]=n*(s*l-u*f)-a*(r*l-i*f)+h*(r*u-i*s),t}function $t(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],h=t[9],f=t[10],l=t[11],p=t[12],d=t[13],y=t[14],v=t[15];return(e*a-n*o)*(f*v-l*y)-(e*s-r*o)*(h*v-l*d)+(e*u-i*o)*(h*y-f*d)+(n*s-r*a)*(c*v-l*p)-(n*u-i*a)*(c*y-f*p)+(r*u-i*s)*(c*d-h*p)}function Kt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=e[9],p=e[10],d=e[11],y=e[12],v=e[13],m=e[14],b=e[15],g=n[0],_=n[1],x=n[2],w=n[3];return t[0]=g*r+_*s+x*f+w*y,t[1]=g*i+_*u+x*l+w*v,t[2]=g*o+_*c+x*p+w*m,t[3]=g*a+_*h+x*d+w*b,g=n[4],_=n[5],x=n[6],w=n[7],t[4]=g*r+_*s+x*f+w*y,t[5]=g*i+_*u+x*l+w*v,t[6]=g*o+_*c+x*p+w*m,t[7]=g*a+_*h+x*d+w*b,g=n[8],_=n[9],x=n[10],w=n[11],t[8]=g*r+_*s+x*f+w*y,t[9]=g*i+_*u+x*l+w*v,t[10]=g*o+_*c+x*p+w*m,t[11]=g*a+_*h+x*d+w*b,g=n[12],_=n[13],x=n[14],w=n[15],t[12]=g*r+_*s+x*f+w*y,t[13]=g*i+_*u+x*l+w*v,t[14]=g*o+_*c+x*p+w*m,t[15]=g*a+_*h+x*d+w*b,t}function Qt(t,e,n){var r,i,o,a,s,u,c,h,f,l,p,d,y=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*y+e[4]*v+e[8]*m+e[12],t[13]=e[1]*y+e[5]*v+e[9]*m+e[13],t[14]=e[2]*y+e[6]*v+e[10]*m+e[14],t[15]=e[3]*y+e[7]*v+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=e[9],p=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=f,t[9]=l,t[10]=p,t[11]=d,t[12]=r*y+s*v+f*m+e[12],t[13]=i*y+u*v+l*m+e[13],t[14]=o*y+c*v+p*m+e[14],t[15]=a*y+h*v+d*m+e[15]),t}function Jt(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function te(t,e,n,r){var i,o,a,s,u,c,h,l,p,d,y,v,m,b,g,_,x,w,E,M,T,P,R,O,S=r[0],I=r[1],C=r[2],A=Math.hypot(S,I,C);return A<f.EPSILON?null:(S*=A=1/A,I*=A,C*=A,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],c=e[2],h=e[3],l=e[4],p=e[5],d=e[6],y=e[7],v=e[8],m=e[9],b=e[10],g=e[11],_=S*S*a+o,x=I*S*a+C*i,w=C*S*a-I*i,E=S*I*a-C*i,M=I*I*a+o,T=C*I*a+S*i,P=S*C*a+I*i,R=I*C*a-S*i,O=C*C*a+o,t[0]=s*_+l*x+v*w,t[1]=u*_+p*x+m*w,t[2]=c*_+d*x+b*w,t[3]=h*_+y*x+g*w,t[4]=s*E+l*M+v*T,t[5]=u*E+p*M+m*T,t[6]=c*E+d*M+b*T,t[7]=h*E+y*M+g*T,t[8]=s*P+l*R+v*O,t[9]=u*P+p*R+m*O,t[10]=c*P+d*R+b*O,t[11]=h*P+y*R+g*O,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ee(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],h=e[9],f=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+h*r,t[6]=s*i+f*r,t[7]=u*i+l*r,t[8]=c*i-o*r,t[9]=h*i-a*r,t[10]=f*i-s*r,t[11]=l*i-u*r,t}function ne(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],h=e[9],f=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-h*r,t[2]=s*i-f*r,t[3]=u*i-l*r,t[8]=o*r+c*i,t[9]=a*r+h*i,t[10]=s*r+f*i,t[11]=u*r+l*i,t}function re(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],h=e[5],f=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+h*r,t[2]=s*i+f*r,t[3]=u*i+l*r,t[4]=c*i-o*r,t[5]=h*i-a*r,t[6]=f*i-s*r,t[7]=l*i-u*r,t}function ie(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function oe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ae(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<f.EPSILON?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function se(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ue(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ce(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function he(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,c=o+o,h=r*s,f=r*u,l=r*c,p=i*u,d=i*c,y=o*c,v=a*s,m=a*u,b=a*c;return t[0]=1-(p+y),t[1]=f+b,t[2]=l-m,t[3]=0,t[4]=f-b,t[5]=1-(h+y),t[6]=d+v,t[7]=0,t[8]=l+m,t[9]=d-v,t[10]=1-(h+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function fe(t,e){var n=new f.ARRAY_TYPE(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=r*r+i*i+o*o+a*a;return l>0?(n[0]=2*(s*a+h*r+u*o-c*i)/l,n[1]=2*(u*a+h*i+c*r-s*o)/l,n[2]=2*(c*a+h*o+s*i-u*r)/l):(n[0]=2*(s*a+h*r+u*o-c*i),n[1]=2*(u*a+h*i+c*r-s*o),n[2]=2*(c*a+h*o+s*i-u*r)),he(t,e,n),t}function le(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function pe(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,c,h),t}function de(t,e){var n=new f.ARRAY_TYPE(3);pe(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,c=e[4]*r,h=e[5]*i,l=e[6]*o,p=e[8]*r,d=e[9]*i,y=e[10]*o,v=a+h+y,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(l-d)/m,t[1]=(p-u)/m,t[2]=(s-c)/m):a>h&&a>y?(m=2*Math.sqrt(1+a-h-y),t[3]=(l-d)/m,t[0]=.25*m,t[1]=(s+c)/m,t[2]=(p+u)/m):h>y?(m=2*Math.sqrt(1+h-a-y),t[3]=(p-u)/m,t[0]=(s+c)/m,t[1]=.25*m,t[2]=(l+d)/m):(m=2*Math.sqrt(1+y-a-h),t[3]=(s-c)/m,t[0]=(p+u)/m,t[1]=(l+d)/m,t[2]=.25*m),t}function ye(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,c=o+o,h=a+a,f=i*u,l=i*c,p=i*h,d=o*c,y=o*h,v=a*h,m=s*u,b=s*c,g=s*h,_=r[0],x=r[1],w=r[2];return t[0]=(1-(d+v))*_,t[1]=(l+g)*_,t[2]=(p-b)*_,t[3]=0,t[4]=(l-g)*x,t[5]=(1-(f+v))*x,t[6]=(y+m)*x,t[7]=0,t[8]=(p+b)*w,t[9]=(y-m)*w,t[10]=(1-(f+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ve(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],c=o+o,h=a+a,f=s+s,l=o*c,p=o*h,d=o*f,y=a*h,v=a*f,m=s*f,b=u*c,g=u*h,_=u*f,x=r[0],w=r[1],E=r[2],M=i[0],T=i[1],P=i[2],R=(1-(y+m))*x,O=(p+_)*x,S=(d-g)*x,I=(p-_)*w,C=(1-(l+m))*w,A=(v+b)*w,D=(d+g)*E,N=(v-b)*E,L=(1-(l+y))*E;return t[0]=R,t[1]=O,t[2]=S,t[3]=0,t[4]=I,t[5]=C,t[6]=A,t[7]=0,t[8]=D,t[9]=N,t[10]=L,t[11]=0,t[12]=n[0]+M-(R*M+I*T+D*P),t[13]=n[1]+T-(O*M+C*T+N*P),t[14]=n[2]+P-(S*M+A*T+L*P),t[15]=1,t}function me(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,h=r*a,f=r*s,l=i*a,p=i*s,d=i*u,y=o*a,v=o*s,m=o*u;return t[0]=1-f-d,t[1]=h+m,t[2]=l-v,t[3]=0,t[4]=h-m,t[5]=1-c-d,t[6]=p+y,t[7]=0,t[8]=l+v,t[9]=p-y,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function be(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function ge(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var _e=ge;function xe(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function we(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Ee(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1,t}var Me=Ee;function Te(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*c,t[15]=1,t}function Pe(t,e,n,r){var i,o,a,s,u,c,h,l,p,d,y=e[0],v=e[1],m=e[2],b=r[0],g=r[1],_=r[2],x=n[0],w=n[1],E=n[2];return Math.abs(y-x)<f.EPSILON&&Math.abs(v-w)<f.EPSILON&&Math.abs(m-E)<f.EPSILON?Gt(t):(h=y-x,l=v-w,p=m-E,i=g*(p*=d=1/Math.hypot(h,l,p))-_*(l*=d),o=_*(h*=d)-b*p,a=b*l-g*h,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=l*a-p*o,u=p*i-h*a,c=h*o-l*i,(d=Math.hypot(s,u,c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=u,t[6]=l,t[7]=0,t[8]=a,t[9]=c,t[10]=p,t[11]=0,t[12]=-(i*y+o*v+a*m),t[13]=-(s*y+u*v+c*m),t[14]=-(h*y+l*v+p*m),t[15]=1,t)}function Re(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],c=r[2],h=i-n[0],f=o-n[1],l=a-n[2],p=h*h+f*f+l*l;p>0&&(h*=p=1/Math.sqrt(p),f*=p,l*=p);var d=u*l-c*f,y=c*h-s*l,v=s*f-u*h;return(p=d*d+y*y+v*v)>0&&(d*=p=1/Math.sqrt(p),y*=p,v*=p),t[0]=d,t[1]=y,t[2]=v,t[3]=0,t[4]=f*v-l*y,t[5]=l*d-h*v,t[6]=h*y-f*d,t[7]=0,t[8]=h,t[9]=f,t[10]=l,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function Oe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Se(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ie(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Ce(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Ae(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function De(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Ne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Le(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],l=t[9],p=t[10],d=t[11],y=t[12],v=t[13],m=t[14],b=t[15],g=e[0],_=e[1],x=e[2],w=e[3],E=e[4],M=e[5],T=e[6],P=e[7],R=e[8],O=e[9],S=e[10],I=e[11],C=e[12],A=e[13],D=e[14],N=e[15];return Math.abs(n-g)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-_)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-w)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-E)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-M)<=f.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-T)<=f.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-P)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(h-R)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(l-O)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(p-S)<=f.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(d-I)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(y-C)<=f.EPSILON*Math.max(1,Math.abs(y),Math.abs(C))&&Math.abs(v-A)<=f.EPSILON*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(m-D)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(b-N)<=f.EPSILON*Math.max(1,Math.abs(b),Math.abs(N))}var je=Kt,Fe=Ce;function Ue(){var t=new f.ARRAY_TYPE(3);return f.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Be(t){var e=new f.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ze(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ye(t,e,n){var r=new f.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r}function Ve(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function He(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Xe(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ke(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ge(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function qe(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function We(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Ze(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function $e(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Ke(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Qe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Je(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function tn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function en(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function nn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function rn(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function on(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function an(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function sn(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function un(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cn(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function hn(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function fn(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),h=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*c+i[0]*h,t[1]=e[1]*s+n[1]*u+r[1]*c+i[1]*h,t[2]=e[2]*s+n[2]*u+r[2]*c+i[2]*h,t}function ln(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,h=3*o*s,f=3*u*a,l=u*o;return t[0]=e[0]*c+n[0]*h+r[0]*f+i[0]*l,t[1]=e[1]*c+n[1]*h+r[1]*f+i[1]*l,t[2]=e[2]*c+n[2]*h+r[2]*f+i[2]*l,t}function pn(t,e){e=e||1;var n=2*f.RANDOM()*Math.PI,r=2*f.RANDOM()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function dn(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function yn(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function vn(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],h=i*c-o*u,f=o*s-r*c,l=r*u-i*s,p=i*l-o*f,d=o*h-r*l,y=r*f-i*h,v=2*a;return h*=v,f*=v,l*=v,p*=2,d*=2,y*=2,t[0]=s+h+p,t[1]=u+f+d,t[2]=c+l+y,t}function mn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function bn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function gn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function _n(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&un(t,e)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function xn(t){return t[0]=0,t[1]=0,t[2]=0,t}function wn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function En(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Mn(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}var Tn,Pn=ke,Rn=Ge,On=qe,Sn=en,In=nn,Cn=ze,An=rn,Dn=(Tn=Ue(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)Tn[0]=t[a],Tn[1]=t[a+1],Tn[2]=t[a+2],i(Tn,Tn,o),t[a]=Tn[0],t[a+1]=Tn[1],t[a+2]=Tn[2];return t});function Nn(){var t=new f.ARRAY_TYPE(4);return f.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ln(t){var e=new f.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function jn(t,e,n,r){var i=new f.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Fn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Un(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Bn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function zn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Yn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Vn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Hn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Xn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function kn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function Gn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function qn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Wn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Zn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function $n(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function Kn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function Qn(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function Jn(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function tr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function er(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function nr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t}function rr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function ir(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],h=e[0],f=e[1],l=e[2],p=e[3];return t[0]=f*c-l*u+p*s,t[1]=-h*c+l*a-p*o,t[2]=h*u-f*a+p*i,t[3]=-h*s+f*o-l*i,t}function or(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function ar(t,e){var n,r,i,o,a,s;e=e||1;do{a=(n=2*f.RANDOM()-1)*n+(r=2*f.RANDOM()-1)*r}while(a>=1);do{s=(i=2*f.RANDOM()-1)*i+(o=2*f.RANDOM()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t}function sr(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function ur(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],c=n[3],h=c*r+s*o-u*i,f=c*i+u*r-a*o,l=c*o+a*i-s*r,p=-a*r-s*i-u*o;return t[0]=h*c+p*-a+f*-u-l*-s,t[1]=f*c+p*-s+l*-a-h*-u,t[2]=l*c+p*-u+h*-s-f*-a,t[3]=e[3],t}function cr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function hr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function fr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function lr(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))}var pr=zn,dr=Yn,yr=Vn,vr=$n,mr=Kn,br=Qn,gr=Jn,_r=function(){var t=Nn();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function xr(){var t=new f.ARRAY_TYPE(4);return f.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function wr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Er(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Mr(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>f.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Tr(t,e){var n=ti(t,e);return Math.acos(2*n*n-1)}function Pr(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+a*s+i*c-o*u,t[1]=i*h+a*u+o*s-r*c,t[2]=o*h+a*c+r*u-i*s,t[3]=a*h-r*s-i*u-o*c,t}function Rr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t}function Or(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t}function Sr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t}function Ir(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Cr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=Math.exp(o),u=a>0?s*Math.sin(a)/a:0;return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=s*Math.cos(a),t}function Ar(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=a>0?Math.atan2(a,o)/a:0;return t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(n*n+r*r+i*i+o*o),t}function Dr(t,e,n){return Ar(t,e),Jr(t,t,n),Cr(t,t),t}function Nr(t,e,n,r){var i,o,a,s,u,c=e[0],h=e[1],l=e[2],p=e[3],d=n[0],y=n[1],v=n[2],m=n[3];return(o=c*d+h*y+l*v+p*m)<0&&(o=-o,d=-d,y=-y,v=-v,m=-m),1-o>f.EPSILON?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*c+u*d,t[1]=s*h+u*y,t[2]=s*l+u*v,t[3]=s*p+u*m,t}function Lr(t){var e=f.RANDOM(),n=f.RANDOM(),r=f.RANDOM(),i=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function jr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}function Fr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ur(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}function Br(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),h=Math.cos(r);return t[0]=o*u*h-a*s*c,t[1]=a*s*h+o*u*c,t[2]=a*u*c-o*s*h,t[3]=a*u*h+o*s*c,t}function zr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Yr,Vr,Hr,Xr,kr,Gr,qr=Ln,Wr=jn,Zr=Fn,$r=Un,Kr=Bn,Qr=Pr,Jr=Wn,ti=rr,ei=or,ni=Qn,ri=ni,ii=Jn,oi=ii,ai=nr,si=fr,ui=lr,ci=(Yr=Ue(),Vr=Ye(1,0,0),Hr=Ye(0,1,0),function(t,e,n){var r=un(e,n);return r<-.999999?(cn(Yr,Vr,e),Cn(Yr)<1e-6&&cn(Yr,Hr,e),sn(Yr,Yr),Er(t,Yr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(cn(Yr,e,n),t[0]=Yr[0],t[1]=Yr[1],t[2]=Yr[2],t[3]=1+r,ai(t,t))}),hi=(Xr=xr(),kr=xr(),function(t,e,n,r,i,o){return Nr(Xr,e,i,o),Nr(kr,n,r,o),Nr(t,Xr,kr,2*o*(1-o)),t}),fi=(Gr=ct(),function(t,e,n,r){return Gr[0]=n[0],Gr[3]=n[1],Gr[6]=n[2],Gr[1]=r[0],Gr[4]=r[1],Gr[7]=r[2],Gr[2]=-e[0],Gr[5]=-e[1],Gr[8]=-e[2],ai(t,Ur(t,Gr))});function li(){var t=new f.ARRAY_TYPE(8);return f.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function pi(t){var e=new f.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function di(t,e,n,r,i,o,a,s){var u=new f.ARRAY_TYPE(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=i,u[5]=o,u[6]=a,u[7]=s,u}function yi(t,e,n,r,i,o,a){var s=new f.ARRAY_TYPE(8);s[0]=t,s[1]=e,s[2]=n,s[3]=r;var u=.5*i,c=.5*o,h=.5*a;return s[4]=u*r+c*n-h*e,s[5]=c*r+h*t-u*n,s[6]=h*r+u*e-c*t,s[7]=-u*t-c*e-h*n,s}function vi(t,e,n){var r=.5*n[0],i=.5*n[1],o=.5*n[2],a=e[0],s=e[1],u=e[2],c=e[3];return t[0]=a,t[1]=s,t[2]=u,t[3]=c,t[4]=r*c+i*u-o*s,t[5]=i*c+o*a-r*u,t[6]=o*c+r*s-i*a,t[7]=-r*a-i*s-o*u,t}function mi(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function bi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function gi(t,e){var n=xr();de(n,e);var r=new f.ARRAY_TYPE(3);return le(r,e),vi(t,n,r),t}function _i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function xi(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function wi(t,e,n,r,i,o,a,s,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t}var Ei=Zr;function Mi(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Ti=Zr;function Pi(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Ri(t,e){var n=e[4],r=e[5],i=e[6],o=e[7],a=-e[0],s=-e[1],u=-e[2],c=e[3];return t[0]=2*(n*c+o*a+r*u-i*s),t[1]=2*(r*c+o*s+i*a-n*u),t[2]=2*(i*c+o*u+n*s-r*a),t}function Oi(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=.5*n[0],u=.5*n[1],c=.5*n[2],h=e[4],f=e[5],l=e[6],p=e[7];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=a*s+i*c-o*u+h,t[5]=a*u+o*s-r*c+f,t[6]=a*c+r*u-i*s+l,t[7]=-r*s-i*u-o*c+p,t}function Si(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*a+h*r+u*o-c*i,l=u*a+h*i+c*r-s*o,p=c*a+h*o+s*i-u*r,d=h*a-s*r-u*i-c*o;return Rr(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+d*r+l*o-p*i,t[5]=l*a+d*i+p*r-f*o,t[6]=p*a+d*o+f*i-l*r,t[7]=d*a-f*r-l*i-p*o,t}function Ii(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*a+h*r+u*o-c*i,l=u*a+h*i+c*r-s*o,p=c*a+h*o+s*i-u*r,d=h*a-s*r-u*i-c*o;return Or(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+d*r+l*o-p*i,t[5]=l*a+d*i+p*r-f*o,t[6]=p*a+d*o+f*i-l*r,t[7]=d*a-f*r-l*i-p*o,t}function Ci(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*a+h*r+u*o-c*i,l=u*a+h*i+c*r-s*o,p=c*a+h*o+s*i-u*r,d=h*a-s*r-u*i-c*o;return Sr(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+d*r+l*o-p*i,t[5]=l*a+d*i+p*r-f*o,t[6]=p*a+d*o+f*i-l*r,t[7]=d*a-f*r-l*i-p*o,t}function Ai(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=s*a+h*r+u*o-c*i,t[1]=u*a+h*i+c*r-s*o,t[2]=c*a+h*o+s*i-u*r,t[3]=h*a-s*r-u*i-c*o,s=e[4],u=e[5],c=e[6],h=e[7],t[4]=s*a+h*r+u*o-c*i,t[5]=u*a+h*i+c*r-s*o,t[6]=c*a+h*o+s*i-u*r,t[7]=h*a-s*r-u*i-c*o,t}function Di(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+a*s+i*c-o*u,t[1]=i*h+a*u+o*s-r*c,t[2]=o*h+a*c+r*u-i*s,t[3]=a*h-r*s-i*u-o*c,s=n[4],u=n[5],c=n[6],h=n[7],t[4]=r*h+a*s+i*c-o*u,t[5]=i*h+a*u+o*s-r*c,t[6]=o*h+a*c+r*u-i*s,t[7]=a*h-r*s-i*u-o*c,t}function Ni(t,e,n,r){if(Math.abs(r)<f.EPSILON)return _i(t,e);var i=Math.hypot(n[0],n[1],n[2]);r*=.5;var o=Math.sin(r),a=o*n[0]/i,s=o*n[1]/i,u=o*n[2]/i,c=Math.cos(r),h=e[0],l=e[1],p=e[2],d=e[3];t[0]=h*c+d*a+l*u-p*s,t[1]=l*c+d*s+p*a-h*u,t[2]=p*c+d*u+h*s-l*a,t[3]=d*c-h*a-l*s-p*u;var y=e[4],v=e[5],m=e[6],b=e[7];return t[4]=y*c+b*a+v*u-m*s,t[5]=v*c+b*s+m*a-y*u,t[6]=m*c+b*u+y*s-v*a,t[7]=b*c-y*a-v*s-m*u,t}function Li(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function ji(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[4],u=n[5],c=n[6],h=n[7],f=e[4],l=e[5],p=e[6],d=e[7],y=n[0],v=n[1],m=n[2],b=n[3];return t[0]=r*b+a*y+i*m-o*v,t[1]=i*b+a*v+o*y-r*m,t[2]=o*b+a*m+r*v-i*y,t[3]=a*b-r*y-i*v-o*m,t[4]=r*h+a*s+i*c-o*u+f*b+d*y+l*m-p*v,t[5]=i*h+a*u+o*s-r*c+l*b+d*v+p*y-f*m,t[6]=o*h+a*c+r*u-i*s+p*b+d*m+f*v-l*y,t[7]=a*h-r*s-i*u-o*c+d*b-f*y-l*v-p*m,t}var Fi=ji;function Ui(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var Bi=ti;function zi(t,e,n,r){var i=1-r;return Bi(e,n)<0&&(r=-r),t[0]=e[0]*i+n[0]*r,t[1]=e[1]*i+n[1]*r,t[2]=e[2]*i+n[2]*r,t[3]=e[3]*i+n[3]*r,t[4]=e[4]*i+n[4]*r,t[5]=e[5]*i+n[5]*r,t[6]=e[6]*i+n[6]*r,t[7]=e[7]*i+n[7]*r,t}function Yi(t,e){var n=ki(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Vi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Hi=ni,Xi=Hi,ki=ii,Gi=ki;function qi(t,e){var n=ki(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,i=e[1]/n,o=e[2]/n,a=e[3]/n,s=e[4],u=e[5],c=e[6],h=e[7],f=r*s+i*u+o*c+a*h;t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=(s-r*f)/n,t[5]=(u-i*f)/n,t[6]=(c-o*f)/n,t[7]=(h-a*f)/n}return t}function Wi(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Zi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function $i(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=e[0],l=e[1],p=e[2],d=e[3],y=e[4],v=e[5],m=e[6],b=e[7];return Math.abs(n-h)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-l)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-p)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-y)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-v)<=f.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-m)<=f.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(c-b)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))}var Ki=n(842)},1584:t=>{t.exports="\nprecision mediump float;\n\nvec4 packDepthToRGBA(const float v) {\n  const float PackUpscale = 256. / 255.;\n  const vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n  const float ShiftRight8 = 1. / 256.;\n\n  vec4 r = vec4(fract(v * PackFactors), v);\n  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n  return r * PackUpscale;\n}\n\nvoid main(void) {\n  gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n}\n\n"},1620:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(8745),a=n(1584),s=n(3985),u=n(2883),c=n(1),h=n(7857),f=n(4515),l=n(2e3),p=n(1355),d=n(4160),y=n(2733),v=function(t){function e(e){var n=t.call(this,e)||this;return n.shadowDepthTextureSize=1024,n.arrayBuffer=new l.default(e),n.isShadowEnabled?(n.program=n.compileShaders(u.default,c.default),n.bindProgram(),n.shadowMap=new y.default("shadowMap",e,!1,n.program),n.light1View=new y.default("u_light1_view",e,!1,n.program),n.light1Projection=new y.default("u_light1_projection",e,!1,n.program)):(n.program=n.compileShaders(f.default,h.default),n.bindProgram()),n.normal=new y.default("a_normal",e,!0,n.program),n.position=new y.default("a_position",e,!0,n.program),n.textureCoords=new y.default("a_texture_coords",e,!0,n.program),n.projMtrx=new y.default("u_projection",e,!1,n.program),n.viewMtrx=new y.default("u_view",e,!1,n.program),n.modelMtrx=new y.default("u_model",e,!1,n.program),n.tex2DSampler=new y.default("texture",e,!1,n.program),n.light1Pos=new y.default("u_light1_pos",e,!1,n.program),n.light1Intensities=new y.default("u_light1_intensities",e,!1,n.program),n.light1Attenu=new y.default("u_light1_attenuation",e,!1,n.program),n.light1AmbCoeff=new y.default("u_light1_ambient_coefficient",e,!1,n.program),n.isShadowEnabled&&n.initShadowProgram(),n}return i(e,t),e.prototype.initShadowProgram=function(){var t=this.ctx;this.shadowProgram=this.compileShaders(s.default,a.default),this.bindShadowProgram(),this.shadowPos=new y.default("a_position",t,!0,this.shadowProgram),this.shadowProjection=new y.default("u_projection",t,!1,this.shadowProgram),this.shadowView=new y.default("u_view",t,!1,this.shadowProgram),this.shadowModel=new y.default("u_model",t,!1,this.shadowProgram),this.shadowFramebuffer=t.createFramebuffer(),this.createDepthTexture(),this.shadowRenderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.shadowRenderBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.shadowDepthTextureSize,this.shadowDepthTextureSize),t.bindFramebuffer(t.FRAMEBUFFER,this.shadowFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.shadowDepthTexture,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.shadowRenderBuffer),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},e.prototype.createDepthTexture=function(){var t=this.ctx;this.shadowTextureUnit=d.default.textureCount,t.activeTexture(t.TEXTURE0+this.shadowTextureUnit),d.default.textureCount+=1,this.shadowDepthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.shadowDepthTexture),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.shadowDepthTextureSize,this.shadowDepthTextureSize,0,t.RGBA,t.UNSIGNED_BYTE,null)},e.prototype.bindShadowProgram=function(){this._bindProgram(this.shadowProgram)},e.prototype.bindProgram=function(){this._bindProgram(this.program)},e.prototype.unbindProgram=function(){this._unbindProgram()},e.prototype.unbindShadowProgram=function(){},e.prototype.enableAttribPointers=function(){var t=this.ctx;t.enableVertexAttribArray(this.position.ref),t.enableVertexAttribArray(this.textureCoords.ref),t.enableVertexAttribArray(this.normal.ref)},e.prototype.bindAttributePointers=function(){this.enableAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.position.ref,3,t.FLOAT,!1,32,0),t.vertexAttribPointer(this.normal.ref,3,t.FLOAT,!0,32,12),t.vertexAttribPointer(this.textureCoords.ref,2,t.FLOAT,!0,32,24)},e.prototype.enableShadowAttribPointers=function(){this.ctx.enableVertexAttribArray(this.shadowPos.ref)},e.prototype.bindShadowAttributePointers=function(){this.enableShadowAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.shadowPos.ref,3,t.FLOAT,!1,32,0)},e.prototype.glSetShadowModelMatrix=function(t){this.ctx.uniformMatrix4fv(this.shadowModel.ref,!1,t)},e.prototype.unbindShadowAttributePointers=function(){this.ctx.disableVertexAttribArray(this.shadowPos.ref)},e.prototype.setLight=function(t,e){this.light=t;var n=t.lookAt();this.bindProgram();var r=this.ctx;if(r.uniform3fv(this.light1Pos.ref,t.pos),r.uniform3fv(this.light1Intensities.ref,t.in),r.uniform1f(this.light1AmbCoeff.ref,t.ambientCoeff),r.uniform1f(this.light1Attenu.ref,t.attenuation),this.isShadowEnabled){var i=p.mat4.frustum(p.mat4.create(),-1*e.aspect,1*e.aspect,-1*e.aspect,1*e.aspect,1,p.vec3.squaredDistance(t.posVec(),t.atVec()));r.uniformMatrix4fv(this.light1View.ref,!1,n),r.uniformMatrix4fv(this.light1Projection.ref,!1,i),this.bindShadowProgram(),r.uniformMatrix4fv(this.shadowView.ref,!1,n),r.uniformMatrix4fv(this.shadowProjection.ref,!1,i)}},e.prototype.prepareShadowTexture=function(){var t=this.ctx;t.activeTexture(t.TEXTURE0+this.shadowTextureUnit),t.bindTexture(t.TEXTURE_2D,this.shadowDepthTexture),t.bindRenderbuffer(t.RENDERBUFFER,this.shadowRenderBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.shadowFramebuffer),t.viewport(0,0,this.shadowDepthTextureSize,this.shadowDepthTextureSize),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.arrayBuffer.bind(),this.bindShadowAttributePointers(),this.bindShadowProgram()},e.prototype.revertShadowTexture=function(){var t=this.ctx;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),this.arrayBuffer.unbind(),this.unbindShadowAttributePointers(),this.unbindShadowProgram()},e.prototype.bindShadowTexture=function(){this.bindProgram(),this.ctx.uniform1i(this.shadowMap.ref,this.shadowTextureUnit)},e.prototype.unbindAttributePointers=function(){var t=this.ctx;t.disableVertexAttribArray(this.position.ref),t.disableVertexAttribArray(this.textureCoords.ref),t.disableVertexAttribArray(this.normal.ref)},e.prototype.glSetViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.viewMtrx.ref,!1,t)},e.prototype.glSetProjectMatrix=function(t){this.ctx.uniformMatrix4fv(this.projMtrx.ref,!1,t)},e.prototype.glSetModelViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.modelMtrx.ref,!1,t)},e.prototype.bindTexture=function(t){t.bindTexture(this.ctx,this.tex2DSampler.ref)},e.DRAW_VERTEX_SIZE=8,e}(o.default);e.default=v},1816:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.entities=[],e}return i(e,t),e.prototype.setPosition=function(t){this.entities.forEach(function(e){return e.setPosition(t)})},e.prototype.center=function(e,n,r){t.prototype.center.call(this,e,n,r),this.entities.forEach(function(t){return t.center(e,n,r)})},e.prototype.rotateOrigin=function(e,n,r){t.prototype.rotateOrigin.call(this,e,n,r),this.entities.forEach(function(t){return t.rotateOrigin(e,n,r)})},e.prototype.rotateOriginRect=function(t){this.rotateOrigin(t.x,t.y,t.z)},e.prototype.rotateX=function(t){this.angleX(t)},e.prototype.rotateY=function(t){this.angleY(t)},e.prototype.rotateZ=function(t){this.angleZ(t)},e.prototype.angleX=function(e){t.prototype.angleX.call(this,e),this.entities.forEach(function(t){return t.angleX(e)})},e.prototype.angleY=function(e){t.prototype.angleY.call(this,e),this.entities.forEach(function(t){return t.angleY(e)})},e.prototype.angleZ=function(e){t.prototype.angleZ.call(this,e),this.entities.forEach(function(t){return t.angleZ(e)})},e.prototype.scaleX=function(e){t.prototype.scaleX.call(this,e),this.entities.forEach(function(t){return t.scaleX(e)})},e.prototype.scaleY=function(e){t.prototype.scaleY.call(this,e),this.entities.forEach(function(t){return t.scaleY(e)})},e.prototype.scaleZ=function(e){t.prototype.scaleZ.call(this,e),this.entities.forEach(function(t){return t.scaleZ(e)})},e.prototype.scale=function(e,n,r){t.prototype.scale.call(this,e,n,r),this.entities.forEach(function(t){return t.scale(e,n,r)})},e.prototype.translate=function(e,n,r){t.prototype.translate.call(this,e,n,r),this.entities.forEach(function(t){return t.translate(e,n,r)})},e.prototype.init=function(e){t.prototype.init.call(this,e),this.entities.forEach(function(t){return t.init(e)})},e.prototype.render=function(e){this.hidden||(this.entities.forEach(function(t){return t.render(e)}),t.prototype.render.call(this,e))},e.prototype.update=function(e){this.hidden||(this.entities.forEach(function(t){return t.update(e)}),t.prototype.update.call(this,e))},e.prototype.setTop=function(e){t.prototype.setTop.call(this,e),this.entities.forEach(function(t){return t.setTop(e)})},Object.defineProperty(e.prototype,"hidden",{set:function(e){t.prototype.setHidden.call(this,e),this.entities.forEach(function(t){return t.hidden=e})},enumerable:!1,configurable:!0}),e}(n(5103).default);e.default=o},1854:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.generateId=function(){return"xxxxxxxxx".replace(/[x]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}},1866:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteMoveableModel=void 0;var o=n(6058),a=n(5835),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(o.default);e.SpriteMoveableModel=s;var u=function(t){function e(e,n){var r=t.call(this)||this;return r.spriteModel=n,r.spriteModel.setRect(e),r}return i(e,t),e.prototype.render=function(t){this.spriteModel.render(t)},e.prototype.update=function(t){this.spriteModel.update(t)},e.prototype.init=function(e){this.entities.push(this.spriteModel),t.prototype.init.call(this,e),this.setRect(this.spriteModel.getRect()),this.updatePhysicsPosition()},e}(a.default);e.default=u},2e3:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.bufferArray=[],this.verticeSize=0,this.bufferReg={},this.bufferRegId=1,this.deleted=!1,this.isBuffered=!1,this.bufferid=t.createBuffer(),this.ctx=t,t.bindBuffer(t.ARRAY_BUFFER,this.bufferid)}return t.prototype.delete=function(){this.ctx.deleteBuffer(this.bufferid),this.deleted=!0},t.prototype.bufferBind=function(){if(!this.deleted){this.isBuffered=!0,this.bind(),this.isBuffered?this.maxSize=2*this.bufferArray.length:this.maxSize=2e5;var t=new Float32Array(this.maxSize);t.fill(0,this.bufferArray.length),t.set(this.bufferArray),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,t,this.ctx.STATIC_DRAW)}},t.prototype.length=function(){return this.verticeSize},t.prototype.bufferSub=function(t,e,n){this.deleted||(this.bind(),this.ctx.bufferSubData(this.ctx.ARRAY_BUFFER,t*Float32Array.BYTES_PER_ELEMENT*n,new Float32Array(e)))},t.prototype.reset=function(){this.bufferArray=[]},t.prototype.push=function(t,e){this.bufferArray=this.bufferArray.concat(t),this.verticeSize+=e,this.isBuffered&&(this.bufferArray.length<this.maxSize?this.bufferSub(this.verticeSize-e,t,t.length/e):(this.bufferBind(),console.log("buffer resizing as limit has been reached")))},t.prototype.bind=function(){!0!==this.deleted&&this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.bufferid)},t.prototype.unbind=function(){},t}();e.default=n},2067:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.FontReference=void 0;var o=n(1816),a=n(2949),s=n(2667),u=n(9619),c=n(5881),h=n(9463),f=n(8372),l=n(566),p=n(8101),d=function(t){function e(e,n,r){var i=t.call(this,n,r)||this;return i.fontChar=e,i}return i(e,t),e}(f.default),y=function(){function t(t,e,n){this.repeat=!1,this.newFont(t,e,n)}return t.prototype.render=function(t){this.isRepeat()&&!this.repeat||(this.repeat=!1,this.shaderEntity&&t.render(this.shaderEntity))},t.prototype.expire=function(){this.displayTime=-1,this.shaderEntity=void 0,this.font=void 0},t.prototype.isExpired=function(){return void 0!==this.displayTime&&!this.isRepeat()&&this.displayTime<this.timer.peak()},t.prototype.refresh=function(){this.repeat=!0},t.prototype.isRepeat=function(){return 0===this.displayTime},t.prototype.newFont=function(e,n,r){this.font=e,this.displayTime=r,this.timer=this.timer?this.timer:new a.default,this.timer.start(),this.id=this.id?this.id:t.$id++,this.shaderEntity=e.shaderEntity.shallowCopy();var i=new l.default;i.centerRect(n),i.rotateOriginRect(n),i.rotateZ(180),i.scaleRect(n),this.shaderEntity.model=i.getModel,this.shaderEntity.modelPosition=function(){return i.position},this.modelPos=i},t.$id=0,t}(),v=function(t){function e(e){var n=t.call(this)||this;return n.metaData=e,n.fonts={},n.renderFontState={},n.renderFontPool=[],n.avgWidth=0,n.avgHeight=0,n.count=0,n}return i(e,t),e.prototype.getFont=function(t){return this.fonts[t]},e.prototype.createRender=function(t,e,n){var r;return this.renderFontPool.length>0?(r=this.renderFontPool.pop()).newFont(t,e,n):r=new y(t,e,n),this.renderFontState[r.id]=r,r},e.prototype.refreshExpired=function(){var t=this;Object.values(this.renderFontState).forEach(function(e){e.isExpired()&&(delete t.renderFontState[e.id],t.renderFontPool.push(e))})},e.prototype.update=function(e){this.refreshExpired(),t.prototype.update.call(this,e)},e.prototype.render=function(t){var e=Object.values(this.renderFontState);e.forEach(function(e){return e.render(t)}),this.count=e.length},e.prototype.init=function(e){var n=this.metaData.context,r=n.fonts,i=new c.default(.5,.5,1,1,1),o=0,a=0,s=0;for(var f in r){var l=r[f],p=[l.x,l.y,l.x+l.width,l.y+l.height],y=h.default.vertex.planeCW(p,n.width,n.height),v=e.createPlaneVertexModel(n.filename,y,u.default.YX),m=new d(l,i,v);this.fonts[l.charCode]=m,this.entities.push(m),o+=l.width,a+=l.height,s+=1}this.avgHeight=a/s,this.avgWidth=o/s,t.prototype.init.call(this,e)},e}(o.default),m=function(){function t(){}return t.prototype.render=function(t){t.writeFont(this)},t.newFont=function(e,n,r){var i=new t;return i.displayRect=new c.default(0,0,0,0),i.pos=e,i.time=r,i.$cacheId=n,i.isDirtyPos=!1,i.isDirtyText=!1,i},t.prototype.setTop=function(t){return this.isTop=t,this},t.prototype.translate=function(t,e){return this.pos.x+=t,this.pos.y+=e,this.isDirtyPos=!0,this},t.prototype.center=function(t,e){return this.pos.x=t,this.pos.y=e,this.isDirtyPos=!0,this},t.prototype.setPosition=function(t){return this.pos=new s.default(t.x,t.y),this.isDirtyPos=!0,this},t.prototype.setWidth=function(t){return this.width=t,this.isDirtyPos=!0,this},t.prototype.setText=function(t){return this._hidden?(this.prevText=t,this.text=""):(this.text=t,this.prevText=""),this.isDirtyText=!0,this},t.prototype.setFontSize=function(t){return this.fontSize=t,this.isDirtyPos=!0,this},Object.defineProperty(t.prototype,"hidden",{set:function(t){var e;!this._hidden&&t?(this.prevText=this.text,this.text="",this.isDirtyText=!0):this._hidden&&!t&&(this.text=null!==(e=this.prevText)&&void 0!==e?e:"",this.prevText="",this.isDirtyText=!0),this._hidden=t},enumerable:!1,configurable:!0}),t}();e.FontReference=m;var b=function(){function t(e){var n=this;this.warningShown=!1,this.fontCacheId=1,this.expireRenderFont=function(t){n.fontCache[t.$id].forEach(function(t){return t.expire()}),n.fontCache[t.$id]=[]},this.writeRef=function(e){if(n.fontManager.count>t.MAX_FONT&&(n.warningShown||(n.warningShown=!0,console.warn("Maximum font is being rendered",n.fontManager.count))),e.fontSize)e.width||(e.width=n.calcTotalTextWidth(e));else{if(!e.width)return n.warningShown||(n.warningShown=!0,console.warn("Either font size or width needs to be set in FontReference")),e;if(!e.text)return n.warningShown||(n.warningShown=!0,console.warn("Font text must be set to calculate font size to fit width")),e;e.fontSize=n.calculateFontSize(e.width,e.text.length)}if(e.isDirtyText&&e.$id&&n.expireRenderFont(e),!e.$id||e.isDirtyText){e.$id||(e.$id=n.fontCacheId++),e.isDirtyText=!1,e.isDirtyPos=!1,e.prevPos=new s.default(e.pos.x,e.pos.y);var r=n.createFonts(e);n.fontCache[e.$id]=r,n.fontRefCache[e.$id]=e}else if(e.isDirtyPos){r=n.fontCache[e.$id];var i=e.pos;e.prevPos||(e.prevPos=new s.default(e.pos.x,e.pos.y));var o=e.prevPos.x-i.x,a=e.prevPos.y-i.y;r.forEach(function(t){var e=t.modelPos;e.translate(-o,-a,0),e.rotateOrigin(e.position.x,e.position.y,e.position.z)}),e.isDirtyPos=!1,e.prevPos.x=e.pos.x,e.prevPos.y=e.pos.y}return n.fontCache[e.$id].forEach(function(t){t.refresh(),t.shaderEntity.isTop=e.isTop}),e},this.fontManager=new v(e),this.fontCache={},this.fontRefCache={},t.DefaultFont||(t.DefaultFont=this)}return t.prototype.event=function(){},t.prototype.update=function(t){t.notificationQueue.peak(p.RendererNotification.RESIZE_SCREEN.key)&&(Object.values(this.fontRefCache).forEach(this.expireRenderFont),Object.values(this.fontRefCache).forEach(function(t){return t.isDirtyText=!0}),this.fontManager.refreshExpired(),Object.values(this.fontRefCache).forEach(this.writeRef)),this.fontManager.update(t)},t.prototype.render=function(t){this.fontManager.render(t)},t.prototype.init=function(t){this.fontManager.init(t)},t.prototype.calcTotalTextWidth=function(e){for(var n=e.text,r=e.fontSize/t.pixelDensity,i=0,o=0;o<n.length;o++){var a=n.charCodeAt(o),s=this.fontManager.getFont(a);i+=r*(Math.abs(s.fontChar.height)<1e-5?0:s.fontChar.width/s.fontChar.height)}return i},t.prototype.calculateFontSize=function(e,n){return e/(Math.abs(this.fontManager.avgHeight)<1e-5?0:this.fontManager.avgWidth/this.fontManager.avgHeight)*t.pixelDensity/n/3},t.prototype.createFonts=function(e){for(var n=e.pos,r=e.time,i=e.text,o=t.fontHeight(e.fontSize),a=0,s=-this.calcTotalTextWidth(e)/2,u=[],h=0;h<i.length;h++){var f=i.charCodeAt(h),l=this.fontManager.getFont(f),p=l.fontChar,d=o;a=Math.max(a,d);var y=d*(Math.abs(p.height)<1e-5?0:p.width/p.height);s+=y;var v=new c.default(n.x+s-y/2-p.xOffset/2,n.y+d/2-p.yOffset/2,y,d,-1*n.z),m=this.fontManager.createRender(l,v,r);u.push(m)}return e.displayRect.x=n.x,e.displayRect.y=n.y,e.displayRect.width=s,e.displayRect.height=a,u},t.fontHeight=function(e){return e/t.pixelDensity},t.MAX_FONT=1e3,t.pixelDensity=400,t}();e.default=b},2184:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderEntity=void 0;var r=n(2224),i=function(){function t(){this.opt=new r.default,this.clone=!1}return t.prototype.getVertexModel=function(){return this.vertexModel},t.prototype.getVertexBufferId=function(){return this.vertexModel.vertexBufferId},t.prototype.getOpt=function(){return this.opt},t.prototype.getModel=function(){return this.model()},t.prototype.getTextureSource=function(){return this.src},t.prototype.setTextureSource=function(t){this.src=t},t.prototype.renderCopy=function(t){var e=this.shallowCopy();return e.model=t.getModel,e.modelPosition=t.getPosition,e},t.prototype.shallowCopy=function(){var e=new t;return e.opt=this.opt,e.vertexModel=this.vertexModel,e.rendererBufferId=this.rendererBufferId,e.rendererTextureRef=this.rendererTextureRef,e.src=this.src,e.isTop=this.isTop,e.hidden=this.hidden,e},t}();e.ShaderEntity=i},2224:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RenderType=e.ShaderType=void 0;var n=function(){function t(){}return t.THREE_DIMENSION=2,t.TWO_DIMENSION=1,t.COLOUR=3,t}();e.ShaderType=n;var r=function(){function t(){}return t.PLAIN=4,t.TRIANGLE=5,t.RECTANGLE=6,t}();e.RenderType=r;e.default=function(){}},2667:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}},2733:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e,n,r){if(n){if(this.ref=e.getAttribLocation(r,t),-1===this.ref)throw new Error("Unable to find attribute shader key = "+t)}else if(this.ref=e.getUniformLocation(r,t),null===this.ref)throw new Error("Unable to find uniform shader key = "+t)}},2812:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=t.call(this)||this;return e.entities=[],e.deferred=[],e.isLoaded=!1,e}return i(e,t),e.prototype.render=function(){var t=this;this.entities.forEach(function(e){return e.render(t.engineHelper)})},e.prototype.update=function(){var t=this;this.entities.forEach(function(e){return e.update(t.engineHelper)})},e.prototype.addEntity=function(t){this.entities.push(t)},e.prototype.event=function(t){for(var e=0;e<this.entities.length;e++)if(!1===this.entities[e].event(t,this.engineHelper))return!1},e.prototype.loadTexture=function(t){this.isLoaded?t():this.deferred.push(t)},e.prototype.init=function(){for(var t=0;t<this.entities.length;t++)this.entities[t].init(this.engineHelper);this.deferred.forEach(function(t){return t()}),this.isLoaded=!0},e}(n(5863).default);e.default=o},2883:t=>{t.exports="\nprecision mediump int;\nprecision mediump float;\n\nattribute vec3 a_position;\nattribute vec2 a_texture_coords;\nattribute vec3 a_normal;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_model;\n\nuniform vec3 u_light1_pos;\nuniform vec3 u_light1_intensities;\nuniform float u_light1_attenuation;\nuniform float u_light1_ambient_coefficient;\nuniform mat4 u_light1_view;\nuniform mat4 u_light1_projection;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying mat4 v_model;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_attenuation;\nvarying float v_light1_ambient_coefficient;\n\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\nvarying vec4 v_shadow_pos;\n\nstruct Light {\n  vec3 position;\n  vec3 intensities;\n  float ambientCoefficient;\n  float attenuation;\n};\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n    m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n    m[0][1], m[1][1], m[2][1],\n    m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n    m[0][1], m[1][1], m[2][1], m[3][1],\n    m[0][2], m[1][2], m[2][2], m[3][2],\n    m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1], -m[0][1],\n    -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n  a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n    a11 * b11 - a12 * b10 + a13 * b09,\n    a02 * b10 - a01 * b11 - a03 * b09,\n    a31 * b05 - a32 * b04 + a33 * b03,\n    a22 * b04 - a21 * b05 - a23 * b03,\n    a12 * b08 - a10 * b11 - a13 * b07,\n    a00 * b11 - a02 * b08 + a03 * b07,\n    a32 * b02 - a30 * b05 - a33 * b01,\n    a20 * b05 - a22 * b02 + a23 * b01,\n    a10 * b10 - a11 * b08 + a13 * b06,\n    a01 * b08 - a00 * b10 - a03 * b06,\n    a30 * b04 - a31 * b02 + a33 * b00,\n    a21 * b02 - a20 * b04 - a23 * b00,\n    a11 * b07 - a10 * b09 - a12 * b06,\n    a00 * b09 - a01 * b07 + a02 * b06,\n    a31 * b01 - a30 * b03 - a32 * b00,\n    a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nconst mat4 norm_shadow_coords = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);\n\nvoid main(void) {\n\n  v_texture_coords = a_texture_coords;\n  v_position = a_position;\n  v_normal = a_normal;\n  v_model = u_model;\n\n  v_light1_pos = u_light1_pos;\n  v_light1_intensities = u_light1_intensities;\n  v_light1_attenuation = u_light1_attenuation;\n  v_light1_ambient_coefficient = u_light1_ambient_coefficient;\n\n  Light light1;\n  light1.intensities = v_light1_intensities;\n  light1.position = v_light1_pos;\n  light1.attenuation = v_light1_attenuation;\n  light1.ambientCoefficient = v_light1_ambient_coefficient;\n\n  vec3 surfacePos = vec3(v_model * vec4(v_position, 1));\n\n  mat3 normalMatrix = transpose(inverse(mat3(v_model)));\n  vec3 normal = normalize(normalMatrix * v_normal);\n\n  vec3 fragPosition = vec3(v_model * vec4(v_position, 1));\n\n  vec3 surfaceToLight = light1.position - fragPosition;\n\n  float brightness = dot(normal, surfaceToLight) / (length(surfaceToLight) * length(normal));\n  if (brightness > 1.0) {\n    brightness = 1.0;\n  } else if (brightness < 0.0) {\n    brightness = 0.0;\n  }\n\n  float distanceToLight = length(light1.position - surfacePos);\n\n  v_diffuseCoefficient = max(0.0, dot(normal, surfaceToLight));\n  v_attenuation = 1.0 / (1.0 + light1.attenuation * pow(distanceToLight, 2.0));\n  v_shadow_pos = norm_shadow_coords * u_light1_projection * u_light1_view * u_model * vec4(a_position, 1.0);\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);\n}\n\n"},2949:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this._start=Date.now()}return t.prototype.start=function(){return this._start=Date.now(),this},t.prototype.peak=function(){return Date.now()-this._start},t.prototype.stop=function(){this._end=Date.now();var t=this._end-this._start;return this._start=this._end,t},t}();e.default=n},3012:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(2667),i=function(){function t(){}return t.boundRect=function(t,e){var n=Math.max(t.x+e.width/2,Math.min(t.x+t.width-e.width/2,e.x)),i=Math.max(t.y+e.height/2,Math.min(t.y+t.height-e.height/2,e.y));return new r.default(n,i,e.z)},t.getLength=function(t,e,n,r){return Math.sqrt(Math.abs((t-n)*(t-n))+Math.abs((e-r)*(e-r)))},t}();e.default=i},3080:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(2224),i=n(3653),o=function(){function t(t){this.ctx=t,this.program=new i.default(t)}return t.prototype.delete=function(){this.program.arrayBuffer.delete(),this.program.delete()},t.prototype.updateBuffer=function(t,e){var n=t.getOpt();if(r.ShaderType.COLOUR===n.shaderType){var o=this.program.arrayBuffer.bufferReg[t.rendererBufferId];e&&e.length===o.verticesSize||console.error("New Buffer data does not match initial buffer data!",t,e,o.verticesSize),this.program.arrayBuffer.bufferSub(o.offset,e,i.default.DRAW_VERTEX_SIZE)}else console.error("Updating buffer for registered Colour Entity but with different shader type as RenderOptions",n)},t.prototype.bindBuffer=function(){this.program.arrayBuffer.bufferBind()},t.prototype.render=function(t,e){this.program.arrayBuffer.bind(),this.program.bindAttributePointers(),this.program.bindProgram(),this.program.glSetViewMatrix(e.viewMatrix),this.ctx.isEnabled(this.ctx.CULL_FACE)&&this.ctx.disable(this.ctx.CULL_FACE),this.ctx.isEnabled(this.ctx.DEPTH_TEST)&&this.ctx.disable(this.ctx.DEPTH_TEST);for(var n=0;n<t.length;n++){var r=t[n],i=r[0],o=r[1];if(!i.rendererBufferId)throw new Error("Unregistered entity buffer"+i);var a=this.program.arrayBuffer.bufferReg[i.rendererBufferId];this.program.glSetModelViewMatrix(o),this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,a.offset,a.size)}this.program.arrayBuffer.unbind(),this.program.unbindAttributePointers(),this.program.unbindProgram()},t.prototype.registerEntity=function(t,e){var n=e.length/i.default.DRAW_VERTEX_SIZE;this.program.arrayBuffer.bufferReg[this.program.arrayBuffer.bufferRegId]={offset:this.program.arrayBuffer.length(),size:n,verticesSize:e.length},this.program.arrayBuffer.push(e,n),t.rendererBufferId=this.program.arrayBuffer.bufferRegId,this.program.arrayBuffer.bufferRegId++},t.prototype.updatePerspective=function(t){this.program.bindProgram(),this.program.glSetProjectMatrix(t)},t}();e.default=o},3335:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PhysicsData=e.ParabolicSimulation=void 0;var r=n(2949),i=n(4315),o=function(){function t(){}return t.registerPhysics=function(e,n){void 0===n&&(n=void 0),e.$physicsId||(e.$physicsId=t.physicsEntityIdCount++,this.physicsEntities[e.$physicsId]={entity:e,enabled:!0,physics:n})},t.deregisterPhysics=function(t){void 0!==t.$physicsId&&this.physicsEntities[t.$physicsId]&&delete this.physicsEntities[t.$physicsId]},t.setEnabledPhysics=function(t,e){this.physicsEntities[t.$physicsId]&&(this.physicsEntities[t.$physicsId].enabled=e)},t.isCollidingOffset2d=function(e,n,r){var i=e.position.x+n,o=e.position.y+r;return t.isCollidingPos2d(e,i,o)},t.isCollidingPoint2d=function(e){var n=e.position.x,r=e.position.y;return t.isCollidingPos2d(e,n,r)},t.isCollidingResolve=function(e,n,r){var o,a=[],s=[],u=[];for(var c in this.physicsEntities)if(this.physicsEntities.hasOwnProperty(c)){var h=this.physicsEntities[c],f=h.entity;if(h.enabled&&f.$physicsId!==e.$physicsId){var l=(null===(o=h.physics)||void 0===o?void 0:o.collisionSize)||f.position,p=l.x,d=l.y,y=l.width,v=l.height;if(i.CollisionDetection.isCollidingRect(p,d,y,v,e.position.x+n,e.position.y+r,e.position.width,e.position.height)){a.push(h.entity);var m=i.CollisionDetection.isCollidingRect(p,d,y,v,e.position.x+n,e.position.y,e.position.width,e.position.height),b=i.CollisionDetection.isCollidingRect(p,d,y,v,e.position.x,e.position.y+r,e.position.width,e.position.height);m&&b?(s.push(-t.dxBoundary(e,p,y)),u.push(-t.dyBoundary(e,d,v))):m?s.push(t.dxBoundary(e,p,y)):b&&u.push(t.dyBoundary(e,d,v))}}}return s.length>0&&(n=Math.min.apply(Math,s)),u.length>0&&(r=Math.min.apply(Math,u)),Math.abs(n)<1e-5&&(n=0),Math.abs(r)<1e-5&&(r=0),[n,r,a]},t.dyBoundary=function(t,e,n){return Math.abs(i.CollisionDetection.getLength(t.position.y,0,e,0)-t.position.height/2-n/2)*(.9999999*Math.sign(e-t.position.y))},t.dxBoundary=function(t,e,n){return Math.abs(i.CollisionDetection.getLength(t.position.x,0,e,0)-t.position.width/2-n/2)*(.9999999*Math.sign(e-t.position.x))},t.isCollidingPos2d=function(t,e,n){var r=[];for(var o in this.physicsEntities)if(this.physicsEntities.hasOwnProperty(o)){var a=this.physicsEntities[o],s=a.entity;a.enabled&&s.$physicsId!==t.$physicsId&&i.CollisionDetection.isCollidingRect(s.position.x,s.position.y,s.position.width,s.position.height,e,n,t.position.width,t.position.height)&&r.push(a.entity)}return r},t.generateSimulationId=function(){var t=this.simulationIdCurrent;return this.simulationIdCurrent+=1,t},t.pauseSimulation=function(t){var e=this.simulations[t];e&&(e.pause=!0)},t.resumeSimulation=function(t){var e=this.simulations[t];e&&(e.pause=!1)},t.cancelSimulation=function(t,e){void 0===e&&(e=!1);var n=this.simulations[t];n&&(n.cancelled=!0,n.totalIterations=0,!e&&n.completeSimulation&&n.completeSimulation())},t.physicsLoop=function(){for(var t in this.simulations)if(this.simulations.hasOwnProperty(t)){var e=this.simulations[t];if(!e)continue;if(e.cancelled)continue;if(e){if(e.pause){e.timer.start();continue}var n=e.timer.peak();0===e.totalIterations||e.runTime<e.totalRunTime?(e.simulation(+t,n,e.totalRunTime,e.totalIterations),e.runTime+=n,e.timer.start(),e.totalIterations+=1):this.cancelSimulation(t)}}},t.runSimulation=function(t,e,n,i){var o=i||this.generateSimulationId(),a=this.simulations[o];return a?(a.cancelled&&(a.pause=!1,a.timer.start(),a.simulation=e,a.totalRunTime=t,a.completeSimulation=n,a.cancelled=!1),a.totalIterations=0,a.runTime=0):this.simulations[o]={pause:!1,timer:(new r.default).start(),simulation:e,totalRunTime:t,completeSimulation:n,totalIterations:0,runTime:0,cancelled:!1},void 0===this.simulationLoop&&(this.simulationLoop=setInterval(this.physicsLoop.bind(this),this.TIME_STEP_MILLIS)),o},t.parabolicSimulation=function(t,e,n){var r=this;return this.runSimulation(t.totalRunTime,function(n,i){var o=r.simulations[n];if(o){var a=o.runTime,s=t.height,u=t.width,c=t.totalRunTime,h=(1/3+1)*s/u/u,f=h*u,l=s/2/(c/2),p=(Math.sqrt(4*h*l*a+f*f)-f)/(2*h),d=-u/c,y=-(h*d*a*d*a+f*d*a),v=p-t.px,m=y-t.py;t.px=p,t.py=y,e(n,i,v,m)}},n)},t.TIME_STEP_MILLIS=10,t.simulations={},t.simulationIdCurrent=1,t.physicsEntities={},t.physicsEntityIdCount=1,t}();e.default=o;e.ParabolicSimulation=function(){};e.PhysicsData=function(){}},3345:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){if(!t.world)throw new Error("world not defined");this.world=t.world}return t.prototype.update=function(t,e){e.setTime(t),this.world.update(),e.updateFont()},t}();e.default=n},3480:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3335),a=n(1213),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$ref={},e.show=!1,e}return i(e,t),e.prototype.reset=function(){this.entities=[],this.$ref={}},e.prototype.beforeShow=function(){},e.prototype.updatePosition=function(t,e){this.$ref[t.$id]?this.$ref[t.$id].position=e:console.error("Trying to update position when entity not set",this)},e.prototype.setShow=function(t){this.show=t,this.show&&this.beforeShow(),this.entities.forEach(function(e){o.default.setEnabledPhysics(e,t),e.hidden=!t}),this.show&&this.restore()},e.prototype.restore=function(){for(var t in this.$ref)if(this.$ref.hasOwnProperty(t)){var e=this.$ref[t];e.entity.setPosition(e.position)}},e.prototype.addEntity=function(t){return this.$ref[t.$id]||(this.entities.push(t),this.$ref[t.$id]={entity:t,position:t.position}),this},e.prototype.update=function(t){this.show&&(this.entities.forEach(function(e){return e.update(t)}),this.configBuilder&&this.configBuilder.texts.forEach(function(e){return t.writeFont(e)}))},e.prototype.render=function(t){this.show&&this.entities.forEach(function(e){return e.render(t)})},e.prototype.event=function(t,e){if(this.show){for(var n=0,r=this.entities;n<r.length;n++)if(!(a=r[n]).isLastEvent&&!1===a.event(t,e))return!1;for(var i=0,o=this.entities;i<o.length;i++){var a;if((a=o[i]).isLastEvent&&!1===a.event(t,e))return!1}}},e.prototype.init=function(t){this.engineHelper=t,this.entities.forEach(function(e){return e.init(t)})},e.prototype.parseMap=function(t,e){this.configBuilder=new a.default(t),this.configBuilder.build(e),this.addEntities()},e.prototype.addEntities=function(){var t=this;this.configBuilder&&this.configBuilder.objects&&this.configBuilder.objects.forEach(function(e){return t.addEntity(e)})},e}(n(8446).default);e.default=s},3637:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4323),a=n(5259),s=function(t){function e(e,n){var r=t.call(this,e,n)||this;if(!(n instanceof a.default)){var i="Vertex model must of be type TextureVertexModel";throw console.error(i,n),new Error(i)}if(!n.renderUnits||4!==n.renderUnits.length)throw i="Plane3d requires 4 vertexes",console.error(i,n),new Error(i);return r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e}(o.default);e.default=s},3653:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(8745),a=n(8558),s=n(9996),u=n(2e3),c=n(2733),h=function(t){function e(e){var n=t.call(this,e)||this;return n.arrayBuffer=new u.default(e),n.program=n.compileShaders(s.default,a.default),n.bindProgram(),n.positionRef=new c.default("a_position",e,!0,n.program),n.colorRef=new c.default("a_color",e,!0,n.program),n.modelViewMatrixRef=new c.default("u_model",e,!1,n.program),n.viewMtrx=new c.default("u_view",e,!1,n.program),n.projMtrx=new c.default("u_projection",e,!1,n.program),n}return i(e,t),e.prototype.bindProgram=function(){this._bindProgram(this.program)},e.prototype.unbindProgram=function(){this._unbindProgram()},e.prototype.enableAttribPointers=function(){var t=this.ctx;t.enableVertexAttribArray(this.positionRef.ref),t.enableVertexAttribArray(this.colorRef.ref)},e.prototype.bindAttributePointers=function(){this.enableAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.positionRef.ref,2,t.FLOAT,!1,28,0),t.vertexAttribPointer(this.colorRef.ref,4,t.FLOAT,!1,28,12)},e.prototype.unbindAttributePointers=function(){var t=this.ctx;t.disableVertexAttribArray(this.positionRef.ref),t.disableVertexAttribArray(this.colorRef.ref)},e.prototype.glSetProjectMatrix=function(t){this.ctx.uniformMatrix4fv(this.projMtrx.ref,!1,t)},e.prototype.glSetModelViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.modelViewMatrixRef.ref,!1,t)},e.prototype.glSetViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.viewMtrx.ref,!1,t)},e.DRAW_VERTEX_SIZE=7,e}(o.default);e.default=h},3962:function(t,e){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,r,i){var o=this;this.SOURCE_KEY="$source =",this.map=t.split("\n").map(function(t){return o.processLine(e,r,i,t)}).filter(function(t){return!!t}).reduce(function(t,e){return n(n({},t),e)}),this.raw=t.split("\n").map(function(t){return o.processRawLine(t)}).filter(function(t){return!!t}).reduce(function(t,e){return n(n({},t),e)})}return t.prototype.processRawLine=function(t){return t.startsWith(this.SOURCE_KEY)?(this.source=t.substr(t.indexOf(this.SOURCE_KEY)+this.SOURCE_KEY.length).trim().replace("\r","").replace("\n",""),void("file://"===window.location.origin&&console.info("file based loading should not have ./ in front of the source"))):this.processTextureLine(t)},t.prototype.processTextureLine=function(t){var e,n=" ",r=t.indexOf(n),i=t.substr(0,r),o=t.substr(r+1),a=(o=o.substr(o.indexOf(n)+1)).indexOf(n),s=parseFloat(o.substr(0,a+1)),u=(o=o.substr(a+1)).indexOf(n),c=parseFloat(o.substr(0,u)),h=(o=o.substr(u+1)).indexOf(n),f=parseFloat(o.substr(0,h));o=o.substr(h);var l=parseFloat(o);return(e={})[i]=[s,c,f,l],e},t.prototype.processLine=function(t,e,n,r){var i,o=" ",a=r.indexOf(o),s=r.substr(0,a),u=r.substr(a+1),c=(u=u.substr(u.indexOf(o)+1)).indexOf(o),h=parseFloat(u.substr(0,c+1)),f=(u=u.substr(c+1)).indexOf(o),l=parseFloat(u.substr(0,f)),p=(u=u.substr(f+1)).indexOf(o),d=parseFloat(u.substr(0,p));u=u.substr(p);var y=parseFloat(u);return(i={})[s]=[(h+d)/t-n,(y+l)/e-n,(h+d)/t-n,l/e+n,h/t+n,l/e+n,h/t+n,(l+y)/e-n],i},t.prototype.getMap=function(){return this.map},t.prototype.getTextureSource=function(){return this.source},t}();e.default=r},3985:t=>{t.exports="\nprecision mediump int;\nprecision mediump float;\n\nattribute vec3 a_position;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_model;\nvoid main(void) {\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);\n}\n\n"},4160:function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(e,n){var r=t.call(this)||this;return r.isLoaded=!1,r.isError=!1,r.load=r.loadImage(e).then(function(){return r.onLoad(n)}).catch(function(t){return r.onError(t)}),r}return r(e,t),e.prototype.onError=function(t){throw this.isError=!0,this.isLoaded=!1,t},e.prototype.onLoad=function(t){return this.handleTextureLoaded(this.image,t),this.isLoaded=!0,this.width=this.image.width,this.height=this.image.height,!0},e.prototype.newTextureUnit=function(){return e.textureCount++},e.prototype.bindTexture=function(t,e){this.isLoaded&&t.uniform1i(e,this.texUnit)},e.prototype.handleTextureLoaded=function(t,e){this.texUnit=this.newTextureUnit(),e.activeTexture(e.TEXTURE0+this.texUnit),this.texture=this.createTextureFromImage(t,e)},e.prototype.createTextureFromImage=function(t,e){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),n},e.textureCount=0,e}(function(){function t(){}return t.prototype.loadImage=function(t){var e=this;return new Promise(function(n,r){e.image=document.createElement("img"),"file://"!==window.location.origin&&(e.image.crossOrigin="anonymous"),e.image.onload=function(){return n()},e.image.onerror=function(t){return r(t)},e.image.src=t})},t}());e.default=i},4315:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Polygon=e.CollisionDetection=e.Collision=void 0;var r=n(372),i=n(1355),o=function(){};e.Collision=o;var a=function(){function t(){}return t.rotate=function(t,e,n){var r=i.vec2.fromValues(t,e);return i.vec2.rotate(r,r,i.vec2.fromValues(n.originX,n.originY),Math.PI*(2-n.az/180)),{x:r[0],y:r[1]}},t.getLength=function(t,e,n,r){return Math.sqrt(Math.abs((t-n)*(t-n))+Math.abs((e-r)*(e-r)))},t.isCollidingRect=function(e,n,r,i,o,a,s,u){return t.getLength(e,0,o,0)<r/2+s/2&&t.getLength(n,0,a,0)<i/2+u/2},t.isRectInRect=function(t,e){return!(t.x+t.width/2<e.x-e.width/2||t.y+t.height/2<e.y-e.height/2||t.x-t.width/2>e.x+e.width/2||t.y-t.height/2>e.y+e.height/2)},t.isPointInRect=function(t,e){return this.isCollidingRect(t.x,t.y,t.width,t.height,e.x,e.y,.01,.01)},t.isPointInPlane3d=function(t,e,n,r){var o=i.mat4.multiply(i.mat4.create(),t.frustum,i.mat4.multiply(i.mat4.create(),t.viewMatrix,e.getModel())),a=this.toClipSpace(e.vertexModel.renderUnits[0].vertex,o);if(a[2]>1)return!1;var s=this.toClipSpace(e.vertexModel.renderUnits[1].vertex,o);if(s[2]>1)return!1;var u=this.toClipSpace(e.vertexModel.renderUnits[2].vertex,o);if(u[2]>1)return!1;var c=this.toClipSpace(e.vertexModel.renderUnits[3].vertex,o);if(c[2]>1)return!1;var h=[[a[0],a[1]],[s[0],s[1]],[c[0],c[1]],[u[0],u[1]]];return this.pointInPolygon([n,r],h)},t.toClipSpace=function(t,e){var n=i.vec4.transformMat4(i.vec4.create(),i.vec4.set(i.vec4.create(),t.x,t.y,t.z,1),e),r=i.vec4.scale(i.vec4.create(),n,1/n[3]);return i.vec4.set(i.vec4.create(),(r[0]+1)/2,(r[1]+1)/2,r[2],1)},t.pointInPolygon=function(t,e){for(var n=t[0],r=t[1],i=!1,o=0,a=e.length-1;o<e.length;a=o++){var s=e[o][0],u=e[o][1],c=e[a][0],h=e[a][1];u>r!=h>r&&n<(c-s)*(r-u)/(h-u)+s&&(i=!i)}return i},t}();e.CollisionDetection=a;var s=function(){function t(){this.max=0,this.min=0}return t.prototype.subtractCenter=function(t){return this.center.subtract(t.center)},t.prototype.offset=function(t){this.points.forEach(function(e){return e.add(t)})},t.prototype.area=function(t,e){return t.x*e.y-e.x*t.y},t.prototype.calculateCentre=function(){for(var t=r.default.newVector(0,0),e=0,n=this.points.length,i=0;i<n;++i){var o,a=this.points[i];o=i==n-1?this.points[0]:this.points[i+1];var s=this.area(a,o);e+=s,t.x+=(a.x+o.x)*s,t.y+=(a.y+o.y)*s}return t.x/=3*e,t.y/=3*e,t},t.prototype.polygonProjection=function(t,e){var n=t.dot(e.points[0]);e.min=n,e.max=n;for(var r=0;r<e.points.length;r++)(n=e.points[r].dot(t))<e.min?e.min=n:n>e.max&&(e.max=n)},t.prototype.boundaryDistance=function(t,e,n,r){return t<n?n-e:t-r},t.prototype.isCollision=function(t,e){var n=new o;n.isIntersect=!0,n.willIntersect=!0;for(var i,a=this.edges.length,s=t.edges.length,u=1/0,c=new r.default,h=0;h<a+s;h++){i=h<a?this.edges[h]:t.edges[h-a];var f=r.default.newVector(-i.y,i.x).normalise();if(this.polygonProjection(f,this),this.polygonProjection(f,t),this.boundaryDistance(this.min,this.max,t.min,t.max)>0&&(n.isIntersect=!1),e){var l=f.dot(e);l<0?this.min+=l:this.max+=l}var p=this.boundaryDistance(this.min,this.max,t.min,t.max);if(p>0&&(n.willIntersect=!1),!n.isIntersect&&!n.willIntersect)break;(p=Math.abs(p))<u&&(u=p,c=f,this.subtractCenter(t).dot(c)<0&&(c=c.negate()))}return n.willIntersect&&(n.minDeintersectDistance=c.scale(u)),n},t}();e.Polygon=s},4323:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5673),a=n(2224),s=function(t){function e(e,n){var r=t.call(this)||this;return r.vertexModel=n,r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.init=function(t){var e=new a.default;e.renderType=a.RenderType.RECTANGLE,e.shaderType=a.ShaderType.THREE_DIMENSION,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).createTexture(this.vertexModel.textureSource).build(this,e)},e}(n(5103).default);e.default=s},4515:t=>{t.exports="precision mediump int;\nprecision mediump float;\n\nattribute vec3 a_position;\nattribute vec2 a_texture_coords;\nattribute vec3 a_normal;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_model;\n\nuniform vec3 u_light1_pos;\nuniform vec3 u_light1_intensities;\nuniform float u_light1_attenuation;\nuniform float u_light1_ambient_coefficient;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_normal;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_ambient_coefficient;\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n    m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n    m[0][1], m[1][1], m[2][1],\n    m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n    m[0][1], m[1][1], m[2][1], m[3][1],\n    m[0][2], m[1][2], m[2][2], m[3][2],\n    m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1], -m[0][1],\n    -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n  a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n    a11 * b11 - a12 * b10 + a13 * b09,\n    a02 * b10 - a01 * b11 - a03 * b09,\n    a31 * b05 - a32 * b04 + a33 * b03,\n    a22 * b04 - a21 * b05 - a23 * b03,\n    a12 * b08 - a10 * b11 - a13 * b07,\n    a00 * b11 - a02 * b08 + a03 * b07,\n    a32 * b02 - a30 * b05 - a33 * b01,\n    a20 * b05 - a22 * b02 + a23 * b01,\n    a10 * b10 - a11 * b08 + a13 * b06,\n    a01 * b08 - a00 * b10 - a03 * b06,\n    a30 * b04 - a31 * b02 + a33 * b00,\n    a21 * b02 - a20 * b04 - a23 * b00,\n    a11 * b07 - a10 * b09 - a12 * b06,\n    a00 * b09 - a01 * b07 + a02 * b06,\n    a31 * b01 - a30 * b03 - a32 * b00,\n    a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nfloat pow3(float x, float y) {\n  return exp2(y * log2(x));\n}\n\nvec3 pow2(vec3 x, vec3 y) {\n  return vec3(pow3(x.x, y.x), pow3(x.y, y.y), pow3(x.z, y.z));\n}\n\nvoid main(void) {\n\n  v_texture_coords = a_texture_coords;\n  v_normal = a_normal;\n\n  v_light1_pos = u_light1_pos;\n  v_light1_intensities = u_light1_intensities;\n  v_light1_ambient_coefficient = u_light1_ambient_coefficient;\n\n  vec3 surfacePos = vec3(u_model * vec4(a_position, 1));\n\n  mat3 normalMatrix = transpose(inverse(mat3(u_model)));\n  vec3 normal = normalize(normalMatrix * a_normal);\n\n  vec3 surfaceToLight = u_light1_pos - surfacePos;\n\n  v_diffuseCoefficient = max(0.0, dot(normal, surfaceToLight));\n  v_attenuation = 1.0 / (1.0 + u_light1_attenuation * pow3(1.0, 2.0));\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);\n}\n"},4648:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(8372),a=n(5259),s=function(t){function e(e,n){var r=t.call(this,e,new a.default)||this;return r.textureReference=n,r}return i(e,t),e.prototype.setLayer=function(t){this.position.z=-t},e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(e){this.vertexModel=e.newVertexModel2d(this.textureReference),t.prototype.init.call(this,e)},e}(o.default);e.default=s},4724:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7806),a=n(7515),s=function(t){function e(){return t.call(this)||this}return i(e,t),e.prototype.render=function(){var t=this;this.entities.forEach(function(e){e&&e.render(t.engineHelper)})},e.prototype.update=function(){var t=this;this.entities.forEach(function(e){e&&e.update(t.engineHelper)});var e=this.engineHelper.camera.camera3d.position,n=e.x,r=e.y,i=e.z;this.sky&&this.sky.center(n,r,i)},e.prototype.event=function(e){t.prototype.event.call(this,e),e.eventType===o.Events.DRAG&&(this.engineHelper.camera.camera3d.angleY(-e.dxRaw),this.engineHelper.camera.camera3d.angleX(e.dyRaw),this.engineHelper.camera.camera3d.updateProjectionView())},e.prototype.loadResources=function(){this.engineHelper.getResource("assets/sphere.txt").then(o.ResourceResolver.objResolverMultiple(this.engineHelper,[{textureSource:"assets/background.jpg",name:"background"},{textureSource:"assets/sun.png",name:"sun"}])),this.engineHelper.getResource("assets/low_poly_tree.txt").then(o.ResourceResolver.objResolver(this.engineHelper,"assets/low_poly_tree.png","low_poly_tree")),this.engineHelper.getResource("assets/low_poly_girl.txt").then(o.ResourceResolver.objResolver(this.engineHelper,"assets/low_poly_girl.png","low_poly_girl")),this.engineHelper.getResource("assets/racing_car.txt").then(o.ResourceResolver.objResolver(this.engineHelper,"assets/racing_car.png","racing_car")),this.engineHelper.getResource("assets/paprika.fnt").then(o.ResourceResolver.bmFontResolver(this.engineHelper)),this.engineHelper.getResource("assets/atlas.txt").then(o.ResourceResolver.bitmapResolver(this.engineHelper,1024,1024,.02)),this.engineHelper.getResource("/assets/missing-texture.txt").then(o.ResourceResolver.bitmapResolver(this.engineHelper,1184,1184,0))},e.prototype.init=function(){var e=this;this.engineHelper.camera.camera3d.center(0,2,11),this.engineHelper.camera.camera3d.updateProjectionView(),this.sky=new a.default(new o.Rect3d(0,2,0,30,32,30),"background"),this.sky.setRenderType(o.RenderType.TRIANGLE),this.sky.init(this.engineHelper),this.addEntity(this.sky),this.lowPolyGirl=new o.Object3d(new o.Rect3d(-4,.95,5,1,1,1),"low_poly_girl"),this.lowPolyGirl.angleY(240),this.lowPolyGirl.scale(.7,.7,.7),this.lowPolyGirl.setRenderType(o.RenderType.TRIANGLE),this.lowPolyGirl.init(this.engineHelper),this.addEntity(this.lowPolyGirl),this.racingCar=new o.Object3d(new o.Rect3d(0,-.25,0,1.5,1.5,1.5),"racing_car"),this.racingCar.angleY(135),this.racingCar.setRenderType(o.RenderType.TRIANGLE),this.racingCar.init(this.engineHelper),this.addEntity(this.racingCar),this.sun=new a.default(new o.Rect3d(0,10,-15,1,1,1),"sun"),this.sun.setRenderType(o.RenderType.TRIANGLE),this.sun.init(this.engineHelper),this.addEntity(this.sun),this.lowPolyTree=[];for(var n=function(t,n){var r=new o.Object3d(new o.Rect3d(t,0,n,1,1,1),"low_poly_tree"),i=.8*Math.random()-.8+3.5;r.scale(i,i,i),r.setRenderType(o.RenderType.TRIANGLE),r.init(e.engineHelper),e.lowPolyTree.push(r),e.addEntity(r)},r=0;r<30;r+=4)n(-10,r-15),n(9,r-15);for(var i=1;i<19;i+=4)n(i-10,-15),n(i-10,14);var s=this.engineHelper.newVertexModel("road",o.PlaneType.XZ);this.road=new o.Plane3d(new o.Rect3d(0,.01,0,1,1,1),s),this.road.scale(3,1,40/Math.sqrt(2)),this.road.angleY(-45),this.road.center(-2,.01,-15),this.road.init(this.engineHelper),this.addEntity(this.road),t.prototype.init.call(this),this.engineHelper.setLighting(new o.Light({pos:[-20,15,-20],in:[1,1,1],attenuation:.015,ambientCoeff:.3,at:[0,0,0]}))},e}(o.ObjectManager);e.default=s},5025:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(1355),i=function(){function t(t){this.pos=t.pos,this.in=t.in,this.attenuation=t.attenuation,this.ambientCoeff=t.ambientCoeff,this.at=t.at}return t.prototype.vecZero=function(t){return r.vec3.equals(t,r.vec3.fromValues(0,0,0))},t.prototype.parellelVec=function(t,e){return!0!==this.vecZero(t)&&!0!==this.vecZero(e)&&!0===r.vec3.equals(r.vec3.normalize(r.vec3.create(),t),r.vec3.normalize(r.vec3.create(),e))},t.prototype.perpVec=function(t){var e=r.vec3.fromValues(1,0,0);return!0===this.parellelVec(t,e)&&(e=r.vec3.fromValues(0,0,1)),e},t.prototype.posVec=function(){return r.vec3.fromValues(this.pos[0],this.pos[1],this.pos[2])},t.prototype.atVec=function(){return r.vec3.fromValues(this.at[0],this.at[1],this.at[2])},t.prototype.lookAt=function(){var t=this.posVec(),e=this.atVec(),n=e,i=t;return!0===this.parellelVec(t,e)?n=this.perpVec(t):(!0===this.vecZero(t)&&(i=this.perpVec(e)),!0===this.vecZero(e)&&(n=this.perpVec(t))),this.up=r.vec3.cross(r.vec3.create(),i,n),r.mat4.lookAt(r.mat4.create(),t,e,this.up)},t}();e.default=i},5063:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.event=void 0;var r=n(2667),i=function(){function t(){var e=this;this.eventDown=!1,this.touchDown=!1,this.eventDownX=0,this.eventDownY=0,this.eventDownDx=0,this.eventDownDy=0,this.keyDownMap={},this.prevEvent=0,this.timeStamp=0,this.prevTimeStamp=0,this.motionTimeStamp=0,this.orientationQuaternion=[0,0,0,0],this.NULL_EVENT={x:0,y:0,dx:0,dy:0,dxRaw:0,dyRaw:0,eventType:-1,prevEventType:-1,timeStamp:0,prevTimeStamp:0,orientationQuaternion:[0,0,0,0],rawEvent:void 0,isDown:!1,isUp:!1},this.boundedWindow=!1,this.callback=[],this.throttle=40,this.setThrottle=function(t){t&&(e.throttle=t)},this.bind=function(t,n){e.callback.push(t),e.webGLContainer=n,e.bindCanvas(),e.bindWindow()},this.handleOrientationChange=function(){e.orientation=window.orientation||0},this.handleMotion=function(n){if(e.motionTimeStamp||(e.motionTimeStamp=n.timeStamp),e.incrementQuaternion(n),n&&n.timeStamp-e.motionTimeStamp>e.throttle){var r=e.eventDownX,i=e.eventDownY;e.eventDownX=e.orientationQuaternion[0],e.eventDownY=e.orientationQuaternion[1],e.handleEvent(n,t.ORIENTATION),e.eventDownX=r,e.eventDownY=i,e.prevEvent=t.ORIENTATION,e.motionTimeStamp=n.timeStamp,e.orientationQuaternion=[0,0,0,1]}},this.incrementQuaternion=function(t){var n=t.rotationRate?t.rotationRate:{beta:0,gamma:0,alpha:0},r=e.getQuaternion(n.alpha,n.beta,n.gamma);e.orientationQuaternion[0]+=r[0],e.orientationQuaternion[1]+=r[1],e.orientationQuaternion[2]+=r[2]},this.buildEvent=function(n,r){return e.webGLContainer.canvas?{x:e.eventDownX/e.webGLContainer.canvas.offsetWidth,y:1-e.eventDownY/e.webGLContainer.canvas.offsetHeight,dx:2*e.eventDownDx/e.webGLContainer.canvas.offsetWidth,dy:2*e.eventDownDy/e.webGLContainer.canvas.offsetHeight,dxRaw:e.eventDownDx,dyRaw:e.eventDownDy,eventType:r,prevEventType:e.prevEvent,timeStamp:e.timeStamp,prevTimeStamp:e.prevTimeStamp,orientationQuaternion:e.orientationQuaternion,rawEvent:n,isDown:r===t.DOWN,isUp:r===t.UP}:e.NULL_EVENT},this.resize=function(n){e.handleEvent(n,t.RESIZE)},this.buildEventKey=function(n,r){return{eventType:r,keyCode:n.key,code:n.code,event:n,keyDown:e.keyDownMap,isDown:r===t.DOWN,isUp:r===t.UP}},this.keyDown=function(n){switch(e.keyDownMap[n.code]=!0,e.handleEvent(n,t.KEY_DOWN),n.keyCode){case 37:case 39:case 38:case 40:n.preventDefault()}},this.keyUp=function(n){e.keyDownMap[n.code]=!1,e.handleEvent(n,t.KEY_UP)},this.handleMouseUp=function(n){e.eventDown=!1,e.timeStamp=n.timeStamp,e.eventDownX=n.offsetX,e.eventDownY=n.offsetY,e.handleEvent(n,t.UP),e.prevEvent=t.UP,e.prevTimeStamp=n.timeStamp},this.handleEventDown=function(n){e.eventDown=!0,e.eventDownX=n.offsetX,e.eventDownY=n.offsetY,e.timeStamp=n.timeStamp,e.handleEvent(n,t.DOWN),e.prevEvent=t.DOWN,e.prevTimeStamp=n.timeStamp},this.handleEventMove=function(n){if(e.eventDown&&n.timeStamp-e.timeStamp>e.throttle){var r=n.offsetX,i=n.offsetY;e.eventDownDx=e.eventDownX-r,e.eventDownDy=e.eventDownY-i,e.eventDownX=r,e.eventDownY=i,e.timeStamp=n.timeStamp,e.handleEvent(n,t.DRAG),e.prevEvent=t.DRAG,e.prevTimeStamp=n.timeStamp}},this.handleTouchEnd=function(n){e.touchDown=!1,e.timeStamp=n.timeStamp,e.handleEvent(n,t.UP),e.prevEvent=t.UP,e.prevTimeStamp=n.timeStamp},this.handleTouchStart=function(n){if(e.touchDown=!0,e.timeStamp=n.timeStamp,n.target instanceof HTMLElement){var r=n.target.getBoundingClientRect();e.eventDownX=n.touches[0].clientX-r.left,e.eventDownY=n.touches[0].clientY-r.top}e.handleEvent(n,t.DOWN),e.prevEvent=t.DOWN,e.prevTimeStamp=n.timeStamp,n.cancelable&&n.preventDefault()},this.handleTouchMove=function(n){if(e.touchDown&&n.timeStamp-e.timeStamp>e.throttle&&n.target instanceof HTMLElement){var r=n.target.getBoundingClientRect(),i=n.touches[0].clientX-r.left,o=n.touches[0].clientY-r.top;e.eventDownDx=(e.eventDownX-i)/2,e.eventDownDy=(e.eventDownY-o)/2,e.eventDownX=i,e.eventDownY=o,e.timeStamp=n.timeStamp,e.handleEvent(n,t.DRAG),e.prevEvent=t.DRAG,e.prevTimeStamp=n.timeStamp}n.cancelable&&n.preventDefault()},this.handleEvent=function(t,n){for(var r=e.buildEvent(t,n),i=0;i<e.callback.length&&!1!==e.callback[i](r);i++);}}return t.prototype.delete=function(t){this.callback=this.callback.filter(function(e){return e!==t})},t.prototype.bindWindow=function(){this.boundedWindow||(window.addEventListener("mouseup",this.isBodyFocus(this.handleMouseUp),!0),window.addEventListener("touchend",this.isBodyFocus(this.handleTouchEnd),!0),window.addEventListener("resize",this.resize,!0),window.addEventListener("keydown",this.isBodyFocus(this.keyDown),!0),window.addEventListener("keyup",this.isBodyFocus(this.keyUp),!0),window.hasOwnProperty("DeviceMotionEvent")&&window.addEventListener("devicemotion",this.handleMotion,!0),window.hasOwnProperty("DeviceOrientationEvent")&&window.addEventListener("orientationchange",this.handleOrientationChange,!0),this.boundedWindow=!0)},t.prototype.bindCanvas=function(){this.webGLContainer.canvas.addEventListener("mousedown",this.handleEventDown,!0),this.webGLContainer.canvas.addEventListener("mousemove",this.handleEventMove,!0),this.webGLContainer.canvas.addEventListener("touchstart",this.handleTouchStart,!0),this.webGLContainer.canvas.addEventListener("touchmove",this.handleTouchMove,!0)},t.prototype.isBodyFocus=function(t){return function(e){window.document.activeElement===window.document.body&&t(e)}},t.prototype.getQuaternion=function(t,e,n){var i=Math.PI/180,o=180/Math.PI,a=e?e*i:0,s=n?n*i:0,u=t?t*i:0,c=Math.cos(a/2),h=Math.cos(s/2),f=Math.cos(u/2),l=Math.sin(a/2),p=Math.sin(s/2),d=Math.sin(u/2),y=c*h*f-l*p*d,v=l*h*f-c*p*d,m=c*p*f+l*h*d,b=c*h*d+l*p*f,g=new r.default(0,0,0);switch(this.orientation){case 90:g.x=-v,g.y=b;break;case 180:g.x=-b,g.y=-v;break;case 270:case-90:g.x=v,g.y=-b;break;default:g.x=b,g.y=v}return[g.x*o/y,-1*g.y*o/y,m*o/y,1]},t.DOWN=1,t.DRAG=2,t.UP=3,t.RESIZE=4,t.ORIENTATION=5,t.KEY_DOWN=6,t.KEY_UP=7,t.SYSTEM_EVENTS=8,t}();e.default=i,e.event=new i},5103:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(566),a=n(1854),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$hidden=!1,e.$id=(0,a.generateId)(),e.clone=!1,e.isTop=!1,e.isLastEvent=!1,e}return i(e,t),e.prototype.copyTexture=function(t){this.shaderEntity.rendererTextureRef=t.shaderEntity.rendererTextureRef,this.shaderEntity.vertexModel=t.shaderEntity.vertexModel,this.shaderEntity.rendererBufferId=t.shaderEntity.rendererBufferId},Object.defineProperty(e.prototype,"shaderEntity",{get:function(){return void 0!==this._shaderEntity&&this._shaderEntity.hidden!==this.$hidden&&(this._shaderEntity.hidden=this.$hidden),this._shaderEntity},set:function(t){this._shaderEntity=t,this._shaderEntity.isTop=this.isTop,this._shaderEntity.clone=this.clone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.$hidden},set:function(t){this.setHidden(t)},enumerable:!1,configurable:!0}),e.prototype.setHidden=function(t){this.$hidden=t,this.shaderEntity&&(this.shaderEntity.hidden=t)},e.prototype.setTop=function(t){this.isTop=t,this.shaderEntity&&(this.shaderEntity.isTop=t)},e.prototype.setClone=function(t){this.clone=t,this.shaderEntity&&(this.shaderEntity.clone=t)},e.prototype.update=function(t){},e.prototype.render=function(t){},e.prototype.event=function(t,e){},e.prototype.init=function(t){},e}(o.default);e.default=s},5201:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontCharacter=e.FontMeta=void 0;e.FontMeta=function(){this.fonts={}};e.FontCharacter=function(){};e.default=function(){}},5259:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(9095),a=n(6750),s=n(5572),u=n(9463),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.createRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t;e++)this.renderUnits.push(new o.TextureRenderUnit);return this},e.prototype.fillRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t.length;e+=8){var n=new o.TextureRenderUnit;n.vertex.x=t[e],n.vertex.y=t[e+1],n.vertex.z=t[e+2],n.normal.x=t[e+3],n.normal.y=t[e+4],n.normal.z=t[e+5],n.texture.u=t[e+6],n.texture.v=t[e+7],this.renderUnits.push(n)}return this},e.prototype.createModel=function(){var t=new s.default;return t.vertices=u.default.vertex.toTextureArray(this.renderUnits),t},e}(a.default);e.default=c},5425:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e,n,r){this.r=t,this.g=e,this.b=n,this.a=r}},5572:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.$id=t._$ID++}return t._$ID=1,t}();e.default=n},5642:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(9095),a=n(6750),s=n(5572),u=n(9463),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.createRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t;e++)this.renderUnits.push(new o.ColourRenderUnit);return this},e.prototype.fillRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t.length;e+=7){var n=new o.ColourRenderUnit;n.vertex.x=t[e],n.vertex.y=t[e+1],n.vertex.z=t[e+2],n.colour.r=t[e+3],n.colour.g=t[e+4],n.colour.b=t[e+5],n.colour.a=t[e+6],this.renderUnits.push(n)}return this},e.prototype.createModel=function(){var t=new s.default;return t.vertices=u.default.vertex.toColourArray(this.renderUnits),t},e}(a.default);e.default=c},5673:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(2184),i=function(){function t(t){this.engineHelper=t}return t.prototype.createTexture=function(t){return this.textureSource=t,this.hasTexture=!0,this},t.prototype.addBuffer=function(t){return this.vertexModel=t,this},t.prototype.build=function(t,e){this.vertexModel||console.error("VertexModel is undefined",this);var n=new r.ShaderEntity,i=n.getOpt();return i.renderType=e.renderType,i.shaderType=e.shaderType,n.model=t.getModel,n.modelPosition=function(){return t.position},n.vertexModel=this.vertexModel,n.vertexModel.registerModel(this.engineHelper),this.engineHelper.registerEntity(n),this.hasTexture&&(n.src=this.textureSource,this.engineHelper.createTexture(n)),n},t.clone=function(t){return Object.assign(new r.ShaderEntity,t)},t}();e.default=i},5835:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(566),a=n(3335),s=n(1816),u=n(2667),c=n(3012),h=n(5881),f=function(t){function e(){var e=t.call(this)||this;return e.dampenReduction=0,e.completeSimulation=function(){e.resetPhysics()},e.resetPhysics=function(){e.physics.t.x=e.position.x,e.physics.t.y=e.position.y,e.physics.t.z=e.position.z,e.physics.d.x=0,e.physics.d.y=0,e.physics.d.z=0,e.physics.isMoving=!1,e.physics.collisionIteration=0},e.physicSimulation=function(t,n,r){var i=e.physics;i.isMoving=!0;var o=i.v.x*n,a=i.v.y*n,s=e;i.collisionSize&&(i.modelPos.setRect(i.collisionSize),i.modelPos.$physicsId=e.$physicsId,s=i.modelPos);var u=e.resolveCollision(s,o,a),c=u[0],h=u[1],f=u[2];e.shouldTranslate(f)?i.collisionIteration=0:(e.addDampener(n),o=c,a=h,i.collisionIteration++,i.collisionIteration>i.collisionStopItThres&&e.cancelSimulation(t)),e.movementRotation(i.v.x),e.translate(o,a,0),i.collisionSize&&(i.modelPos.translate(o,a,0),i.collisionSize.x+=o,i.collisionSize.y+=a),e.isBounded&&e.updateLocBoundToBoundary(),e.completePhysicsIteration(n)},e.physics={t:new u.default(0,0,0),d:new u.default(0,0,0),v:new u.default(0,0,0),a:new u.default(0,0,0),modelPos:new o.default,isMoving:!1,collisionSize:void 0,bound:new h.default(0,0,1,1),simulationId:void 0,jumpSimulationId:void 0,gravitySimulationId:void 0,collisionIteration:0,collisionStopItThres:5},e.isMoveable=!0,e.isBounded=!0,e.hasCollision=!0,e}return i(e,t),e.prototype.updatePhysicsPosition=function(){this.physics.t.x=this.position.x,this.physics.t.y=this.position.y,this.physics.t.z=this.position.z},e.prototype.updateDeltaDistance=function(t,e,n){void 0!==t?(this.physics.d.x=t-this.position.x,this.physics.t.x=t):this.physics.d.x=this.physics.t.x-this.position.x,void 0!==e?(this.physics.d.y=e-this.position.y,this.physics.t.y=e):this.physics.d.y=this.physics.t.y-this.position.y,void 0!==n?(this.physics.d.z=n-this.position.z,this.physics.t.z=n):this.physics.d.z=this.physics.t.z-this.position.z},e.prototype.updateLocBoundToBoundary=function(){var t,e=this.physics.collisionSize?this.physics.modelPos.position:this.position,n=null!==(t=this.physics.bound)&&void 0!==t?t:new h.default(0,0,1,1,0),r=c.default.boundRect(n,this.physics.collisionSize?this.physics.modelPos.position:this.position),i=0,o=0;e.x!==r.x&&(this.physics.v.x=0,i=r.x-e.x),e.y!==r.y&&(this.physics.v.y=0,o=r.y-e.y),this.center(this.position.x+i,this.position.y+o,this.position.z)},e.prototype.calcTotalDeltaDistance=function(){return Math.sqrt(this.physics.d.x*this.physics.d.x+this.physics.d.y*this.physics.d.y+this.physics.d.z*this.physics.d.z)},e.prototype.translateTo=function(t,e,n,r,i){var o=0!==e?1e-5*(this.physics.d.x<0?-1:1):0;this.physics.t.x+=(e||0)+o,this.physics.t.y+=n||0,this.physics.t.z+=r||0,this.moveTo(t,this.physics.t.x,this.physics.t.y,this.physics.t.z,i)},e.prototype.shouldTranslate=function(t){return 0===t.length},e.prototype.moveToTime=function(t,e,n,r,i){var o,s=this;if(a.default.cancelSimulation(null!==(o=this.physics.simulationId)&&void 0!==o?o:0,!0),this.isMoveable){var u=this.physics;this.updateDeltaDistance(e,n,r);var c=Math.max(t,1e-5);this.movementRotation(u.d.x);var h=this.completeSimulation;i&&(h=function(){s.completeSimulation(),i()}),u.simulationId=a.default.runSimulation(c,this.moveSimulation.bind(this),h,u.simulationId)}},e.prototype.movementRotation=function(t){this.isRotateMove&&(t>0?this.rotateY(0):t<0&&this.rotateY(180))},e.prototype.moveTo=function(t,e,n,r,i){var o,s=this;if(a.default.cancelSimulation(null!==(o=this.physics.simulationId)&&void 0!==o?o:0,!0),this.isMoveable){var u=this.physics;this.updateDeltaDistance(e,n,r);var c=this.calcTotalDeltaDistance()/t;this.movementRotation(u.d.x);var h=this.completeSimulation;i&&(h=function(){s.completeSimulation(),i()}),u.simulationId=a.default.runSimulation(c,this.moveSimulation.bind(this),h,u.simulationId)}},e.prototype.addDampener=function(t){var e=t/1e3,n=Math.sign(this.physics.v.x);this.physics.v.x-=n*this.dampenReduction*e,n!==Math.sign(this.physics.v.x)&&(this.physics.v.x=0);var r=Math.sign(this.physics.v.y);this.physics.v.y-=r*this.dampenReduction*e,r!==Math.sign(this.physics.v.y)&&(this.physics.v.y=0),Math.abs(this.physics.v.x)<1e-5&&(this.physics.v.x=0),Math.abs(this.physics.v.y)<1e-5&&(this.physics.v.y=0)},e.prototype.addImpulse=function(t,e){this.physics.v.x+=t.x*e,this.physics.v.y+=t.y*e},e.prototype.setVelocity=function(t){this.physics.v.x=t.x,this.physics.v.y=t.y},e.prototype.runPhysicsSimulation=function(t,e){void 0===e&&(e=2*a.default.TIME_STEP_MILLIS),a.default.runSimulation(e,this.physicSimulation,this.completeSimulation,t)},e.prototype.completePhysicsIteration=function(t){},e.prototype.resolveCollision=function(t,e,n){return this.hasCollision?a.default.isCollidingResolve(t,e,n):[e,n,[]]},e.prototype.cancelSimulation=function(t){var e=a.default.simulations[t];(null==e?void 0:e.completeSimulation)&&e.completeSimulation(),a.default.cancelSimulation(t)},e.prototype.moveSimulation=function(t,e,n){if(!(Math.abs(n)<1e-5)){var r=this.physics;r.isMoving=!0;var i=Math.min(1,e/n),o=r.d.x*i,a=r.d.y*i,s=r.d.z*i;this.translateCollision(t,o,a,s),this.completePhysicsIteration(e)}},e.prototype.translateCollision=function(t,e,n,r){var i=this.physics,o=this;i.collisionSize&&(i.modelPos.setRect(i.collisionSize),i.modelPos.$physicsId=this.$physicsId,o=i.modelPos);var s=a.default.isCollidingOffset2d(o,e,n);this.shouldTranslate(s)?(this.translate(e,n,r),i.collisionSize&&(i.modelPos.translate(e,n,0),i.collisionSize.x+=e,i.collisionSize.y+=n),this.isBounded&&this.updateLocBoundToBoundary(),this.physics.collisionIteration=0):(this.physics.collisionIteration++,this.physics.collisionIteration>this.physics.collisionStopItThres&&this.cancelSimulation(t))},e.prototype.setMoveable=function(t){this.isMoveable=t},e.prototype.copyTexture=function(e){this.shaderEntity&&t.prototype.copyTexture.call(this,e),this.entities.forEach(function(t){return t.copyTexture(e)})},e}(s.default);e.default=f},5863:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.setEngineHelper=function(t){this.engineHelper=t},t.prototype.loadResources=function(t){throw new Error("unimplemented method")},t.prototype.update=function(){throw new Error("unimplemented method")},t.prototype.render=function(){throw new Error("unimplemented method")},t.prototype.event=function(t){throw new Error("unimplemented method")},t.prototype.pause=function(){throw new Error("unimplemented method")},t.prototype.resume=function(){throw new Error("unimplemented method")},t.prototype.init=function(t){throw new Error("unimplemented method")},t.prototype.destroy=function(){throw new Error("unimplemented method")},t.prototype.reset=function(){},t}();e.default=n},5880:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(6079),i=n(9619),o=n(2224),a=n(5259),s=n(9463),u=n(2067),c=n(8101),h=n(4315),f=function(){function t(t,e,n){var i=this;this.resourcesLoading=[],this.bufferCache={},this.fontCache={},this.fontNameKeyReverse={},this.uvCache={},this.vertexUVCache={},this.cacheId=0,this.camera=n,this.notificationQueue=t,this.subscriberPool=e,e.listen(r.AppSubscription.GET_FPS,function(t){return i.fps=t})}return t.prototype.startIteration=function(){this.subscriberPool.publish(r.AppSubscription.START_ITERATION)},t.prototype.render=function(t){var e=t.opt.shaderType;if(e!==o.ShaderType.TWO_DIMENSION&&e!==o.ShaderType.COLOUR||!this.camera.camera3d.isOutOfBound(t.modelPosition())){var n=t.getModel();t.clone&&(n=n.slice(0)),this.notificationQueue.pushPayload(c.RendererNotification.renderEntity(t,n))}},t.prototype.renderCopy=function(t,e){this.render(t.shaderEntity.renderCopy(e))},t.prototype.setLighting=function(t){this.notificationQueue.pushPayload(c.RendererNotification.setLighting(t))},t.prototype.createTexture=function(t){this.subscriberPool.publish(c.RendererSubscription.CREATE_TEXTURE,c.RendererSubscription.createTexturePayload(t,this.resourcesLoading))},t.prototype.getFPS=function(){return this.fps},t.prototype.getTotalPixelHeight=function(){return window.screen.height},t.prototype.getTotalPixelWidth=function(){return window.screen.width},t.prototype.getScreenHeight=function(){return this.camera.height},t.prototype.getScreenWidth=function(){return this.camera.width},t.prototype.setTime=function(t){t&&(this.time=t)},t.prototype.getTime=function(){return this.time},t.prototype.getVerticesById=function(t){if(this.bufferCache[t])return this.bufferCache[t].vertices;throw console.error("Unable to find src in cache",t,this),new Error("unable to find src in cache")},t.prototype.updateBufferCache=function(t,e){return t.cacheId=e,this.bufferCache[e]=t,e},t.prototype.addBufferCache=function(t){var e=this.cacheId++;return this.bufferCache[e]=t,t.cacheId=e,e},t.prototype.getResource=function(t){var e=this,n=new Promise(function(n,r){var i=new XMLHttpRequest;console.log("Loading resource ".concat(t)),i.open("GET",t),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0===i.status){var o=e.cacheId++;n({data:i.responseText,engineHelper:e,cacheId:o,registerBuffer:function(t){e.bufferCache[o]=t},registerFont:function(n){var r=new u.default(n);e.fontCache[o]={meta:n,font:r},e.fontNameKeyReverse[t]=o}})}else r(i.responseText)},i.send()});return this.resourcesLoading.push(n),n},t.prototype.getAllResourcesLoading=function(){return Promise.all(this.resourcesLoading)},t.prototype.updateBuffer=function(t){this.updateBufferCache(t.vertexModel.createModel(),t.vertexModel.vertexBufferId);var e=c.RendererNotification.updateBuffer(t,this.getBuffer(t));this.notificationQueue.pushPayload(e)},t.prototype.getBufferModelData=function(t){return this.bufferCache[t.getVertexBufferId()]},t.prototype.getBuffer=function(t){var e=this.getBufferModelData(t).vertices;if(!e)throw new Error("No buffer was found for this entity");return e},t.prototype.registerEntity=function(t){this.subscriberPool.publish(c.RendererSubscription.REGISTER_ENTITY,c.RendererSubscription.registerEntityPayload(t,this.getBufferModelData(t)))},t.prototype.initFont=function(){for(var t in this.fontCache)this.fontCache.hasOwnProperty(t)&&this.fontCache[t].font.init(this)},t.prototype.renderFont=function(){for(var t in this.fontCache)this.fontCache.hasOwnProperty(t)&&this.fontCache[t].font.render(this)},t.prototype.updateFont=function(){for(var t in this.fontCache)this.fontCache.hasOwnProperty(t)&&this.fontCache[t].font.update(this)},t.prototype.newVertexModel2d=function(t){return this.newVertexModel(t,i.default.YX)},t.prototype.newVertexModelUv3d=function(t){var e=this.vertexUVCache[t],n=(new a.default).fillRenderUnits(e.uv);return n.textureSource=e.source,n},t.prototype.createPlaneVertexModel=function(t,e,n){var r=(new a.default).createRenderUnits(4);return r.textureSource=t,s.default.vertex.plane(r.renderUnits,n),s.default.vertex.planeUV(r.renderUnits,e),r},t.prototype.getUVCache=function(t){return this.uvCache[t].uv},t.prototype.addUVCache=function(t,e,n){this.uvCache[e]={source:t,uv:n}},t.prototype.getVertexUvCache=function(t){return this.vertexUVCache[t].uv},t.prototype.newVertexModel=function(t,e){var n=this.uvCache[t];if(!n){var r=this.uvCache.missing;return console.warn("texture ".concat(t," has not been loaded - loading default texture")),this.createPlaneVertexModel(r.source,r.uv,e)}return this.createPlaneVertexModel(n.source,n.uv,e)},t.prototype.addVertexUvCache=function(t,e,n){this.vertexUVCache[e]={source:t,uv:n}},t.prototype.writeFont=function(t){var e=void 0;if("string"==typeof t.$cacheId)e=this.fontNameKeyReverse[t.$cacheId];else if("number"==typeof t.$cacheId)e=t.$cacheId;else if(void 0!==t.$cacheId)throw new Error("fontId is not a number or string");return(void 0===e?u.default.DefaultFont:this.fontCache[e].font).writeRef(t)},t.prototype.isClickedObject=function(t,e){return this.isClicked(t,e.getRect2())},t.prototype.isClicked=function(t,e){var n=this.camera.camera3d.distanceEvent(t);return h.CollisionDetection.isPointInRect(e,n)},t.prototype.rotate=function(t,e){var n=this.camera.camera3d.position,r=n.x,i=n.y;return h.CollisionDetection.rotate(r+t.x,i+t.y,e)},t.prototype.updateProjectionMatrix=function(){this.notificationQueue.pushPayload(c.RendererNotification.UPDATE_PROJECTION_MATRIX)},t}();e.default=f},5881:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n,r,i,o){return t.call(this,e,n,o||0,r,i,1)||this}return i(e,t),e.create=function(){return new e(0,0,0,0,0)},e.prototype.newCenter=function(){return new e(this.x+this.width/2,this.y+this.height/2,this.width,this.height,this.z)},e}(n(684).default);e.default=o},6058:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4648),a=n(2949),s=function(t){function e(e,n,r){var i=t.call(this)||this;return i.spriteIdx=0,i.timer=new a.default,i.setRect(e),i.ticks=n,i.textures=r,i}return i(e,t),e.prototype.update=function(t){},e.prototype.render=function(t){var e;null===(e=this.entities[this.spriteIdx])||void 0===e||e.render(t),this.calcSpriteIdx()},e.prototype.calcSpriteIdx=function(){if(this.timer.peak()>this.ticks){var t=this.entities.length;if(this.spriteIdx+=Math.round(this.timer.peak()/this.ticks),this.spriteIdx>=t){var e=this.spriteIdx/t;this.spriteIdx=Math.round((e-Math.floor(e))*t),this.spriteIdx>=t&&(console.error("index out of bound after shaping",this.spriteIdx),this.spriteIdx=0)}this.timer.start()}},e.prototype.init=function(e){var n=this;if(this.textures){for(var r=0;r<this.textures.length;r++)this.entities.push(new o.default(this.getRect(),this.textures[r]));this.entities.forEach(function(t){t.setTop(n.isTop),t.hidden=n.hidden}),this.center(this.position.x,this.position.y,this.position.z),this.rotateOrigin(this.position.x,this.position.y,this.position.z),this.rotateZ(180),t.prototype.init.call(this,e),this.timer.start()}},e}(n(8446).default);e.default=s},6079:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AppSubscription=e.WebGLContainer=void 0;var r=n(7253),i=n(3345),o=n(8101),a=n(5880),s=n(5063),u=n(2949),c=n(6266),h=n(978),f=function(){function t(t,e,n,r,i){this.isFullScreen=r,this.aspectRatio=n,this.canvas=document.createElement("canvas"),this.canvas.id=t||"app",this.canvas.addEventListener("webglcontextlost",function(t){return t.preventDefault()},!1),this.canvas.addEventListener("webglcontextrestored",i,!1),e.appendChild(this.canvas)}return t.prototype.delete=function(){this.canvas.style.display="none",this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},t.prototype.resize=function(t){var e=t.offsetWidth,n=e/this.getAspectRatio();this.isFullScreen&&(e=window.innerWidth,n=window.innerHeight),this.canvas.width=e*window.devicePixelRatio,this.canvas.height=n*window.devicePixelRatio,this.canvas.style.height="".concat(n,"px"),this.canvas.style.width="".concat(e,"px")},t.prototype.getAspectRatio=function(){var t=this.aspectRatio;return t||(t=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)/(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)),t},t.prototype.getCtx=function(){var t=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");if(!t)throw new Error("WebGL not avaliable");return t},t}();e.WebGLContainer=f;var l=function(){function t(){}return t.START_ITERATION=new h.Subscription("App#StartIteration"),t.GET_FPS=new h.Subscription("App#GetFPS"),t}();e.AppSubscription=l;var p=function(){function t(t){var e=this;if(this.ready=!1,this.isPaused=!0,this.frameTime=0,this.framesElapsed=0,this.setup=function(){var t=e.args;e.timer=new u.default,e.camera=new r.default,e.updater=new i.default(t),e.renderer=new o.default(t,e.webGLContainer,e.camera,e.notificationQueue,e.subscriberPool),e.camera.setupCamera(t.camera,t.aspectRatio,e.webGLContainer.canvas),e.engineHelper=new a.default(e.notificationQueue,e.subscriberPool,e.camera),e.world=e.args.world,e.world.setEngineHelper(e.engineHelper)},this.onEvent=function(t){return t.eventType===s.default.RESIZE&&e.resizeScreen(),e.world&&e.world.event(t),!0},this.destroy=function(){clearInterval(e.interval),e.renderer.delete(),s.event.delete(e.onEvent),e.webGLContainer.delete(),console.log("destroying",e)},this.animationFrame=function(){if(e.ready)try{e.updater.update(e.timer.peak(),e.engineHelper),e.renderer.render(e.timer.peak(),e.engineHelper),e.notifyFrames(),e.timer.start()}catch(t){console.error(t),clearInterval(e.interval),e.errorCallback&&e.errorCallback(t)}},this.startIteration=function(){return requestAnimationFrame(e.animationFrame)},this.notifyFrames=function(){e.frameTime+=e.timer.peak(),e.framesElapsed++,60===e.framesElapsed&&(e.args.subscribe&&e.args.subscribe({fps:1e3/e.frameTime*e.framesElapsed}),e.framesElapsed=0,e.frameTime=0)},this.startRunLoop=function(){e.timer.start();var t=e.fps;e.interval=setInterval(function(){e.isPaused||e.animationFrame(),e.isStepRender&&(clearInterval(e.interval),e.interval=void 0),e.fps!==t&&(clearInterval(e.interval),e.interval=void 0,e.startRunLoop())},t)},this.initSystem=function(){return e.initFont(),e.world.init(e.engineHelper),e.renderer.init(),e.engineHelper.getAllResourcesLoading()},this.loadResources=function(t){return e.world.loadResources(t),e.engineHelper.getAllResourcesLoading()},this.runApp=function(){e.ready=!0,e.isStepRender?e.animationFrame():e.startRunLoop()},this.onRunError=function(t){throw clearInterval(e.interval),console.error(t),t},this.run=function(){console.log("Running",e);var t=new Date;return e.loadResources(e.args.resources).then(e.initSystem).then(e.renderer.bindBuffer).then(e.runApp).then(function(){return console.log("startup time: ".concat((new Date).getTime()-t.getTime()))}).then(function(){return new Promise(function(t){setTimeout(t,1)})}).catch(e.onRunError)},this.resizeCanvas=function(t){e.webGLContainer.resize(t)},this.resizeScreen=function(){var t=document.getElementById(e.args.elementId);e.resizeCanvas(t),e.camera.setupCamera(e.args.camera,e.args.aspectRatio,e.webGLContainer.canvas),e.notificationQueue.push(o.RendererNotification.RESIZE_SCREEN),e.isStepRender&&e.ready&&e.animationFrame()},this.buildCanvas=function(t){if(!e.webGLContainer){var n=document.body;t.elementId&&(n=document.getElementById(t.elementId)),e.webGLContainer=new f(t.canvasId,n,t.aspectRatio,t.isFullScreen,e.setup),e.resizeCanvas(n)}},this.reset=function(){e.world?e.world.reset():console.error("Game Delegate not ready to call reset")},this.toggleShow=function(){e.isVisible?e.hide():e.show()},this.show=function(){e.webGLContainer.canvas.style.display="initial",e.resizeScreen(),e.isVisible=!0},this.hide=function(){e.webGLContainer.canvas.style.display="none",e.isVisible=!1},this.togglePause=function(){e.isPaused=!e.isPaused},this.pause=function(){e.isPaused=!0},this.unpause=function(){e.isPaused=!1},!t)throw new Error("no args passed into App");this.notificationQueue=new c.default,this.subscriberPool=new h.default,this.subscriberPool.listen(l.START_ITERATION,this.startIteration),this.args=t,this.buildCanvas(t),this.isStepRender=t.isStepRender||!1,s.event.bind(this.onEvent,this.webGLContainer),s.event.setThrottle(t.eventThrottle||40),this.errorCallback=t.error,this.setup(),t.clearColour&&this.renderer.glContext.setClearColor(t.clearColour),this.setFPS(t.fps)}return t.prototype.setFPS=function(t){this.fps=1e3/t||1e3/30,this.subscriberPool.publish(l.GET_FPS,this.fps)},t.prototype.toggleStepRender=function(t){void 0===t&&(t=!this.isStepRender),this.isStepRender=t,this.isStepRender||this.interval||this.startRunLoop()},t.prototype.initFont=function(){this.engineHelper.initFont()},t}();e.default=p},6266:function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.NotificationPayload=e.Notification=void 0;var i=function(t,e){this.key=t,this.action=e};e.Notification=i;var o=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.data=r,i}return r(e,t),e.from=function(t,n){return new e(t.key,t.action,n)},e}(i);e.NotificationPayload=o;var a=function(t){this.data=t},s=function(){function t(){this.queueMap={}}return t.prototype.clearQueue=function(){this.queueMap={}},t.prototype.pushPayload=function(t){var e=t.key,n=this.queueMap[e];if(n||(this.queueMap[e]={bottom:void 0,top:void 0},n=this.queueMap[e]),n.bottom){if(!n.top)throw new Error("Unexpected state for notification push payload");n.top.next=new a(t),n.top=n.top.next}else n.bottom=new a(t),n.top=n.bottom},t.prototype.push=function(t,e){t instanceof o&&console.error("Please use pushPayload"),this.pushPayload(new o(t.key,t.action,e))},t.prototype.pushNotification=function(t,e){this.push(new i(t,e))},t.prototype.take=function(t){if(this.getBottom(t)){var e=this.peak(t);if(!e)throw new Error("Expected data to appear when reading data from notification");return this.shiftQueue(t),e}},t.prototype.shiftQueue=function(t){var e=this.queueMap[t],n=e.bottom;if(!n)throw new Error("Trying to shift queue with bottom undefined");e.bottom=n.next,e.bottom||(e.top=void 0)},t.prototype.getBottom=function(t){return this.queueMap[t]?this.queueMap[t].bottom:void 0},t.prototype.peak=function(t){var e=this.getBottom(t);return e&&e.data||void 0},t}();e.default=s},6368:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(5425),i=function(){function t(t){this.clearColour=new r.default(1,1,1,1),this.ctx=t}return t.prototype.setClearColor=function(t){this.clearColour=t,this.ctx.clearColor(t.r,t.g,t.b,t.a)},t.prototype.setupDefault=function(){this.setClearColor(this.clearColour),this.ctx.enable(this.ctx.BLEND),this.ctx.blendFunc(this.ctx.SRC_ALPHA,this.ctx.ONE_MINUS_SRC_ALPHA),this.ctx.enable(this.ctx.CULL_FACE),this.ctx.frontFace(this.ctx.CCW),this.ctx.cullFace(this.ctx.BACK),this.ctx.clearDepth(1),this.ctx.enable(this.ctx.DEPTH_TEST),this.ctx.depthFunc(this.ctx.LEQUAL)},t.prototype.clear=function(){this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT)},t.prototype.deleteTexture=function(t){this.ctx.deleteTexture(t)},t.prototype.resizeViewPort=function(t){this.ctx.viewport(0,0,t.width,t.height)},t.prototype.getWebGL2RenderingContext=function(){return this.ctx},t.prototype.destroyWebGL=function(){var t=this.ctx,e=this.getWebGL2RenderingContext(),n=!!e.createTransformFeedback;n&&e.bindVertexArray(null);var r=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var o=0;o<r;++o)t.disableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(o,0),n&&e.vertexAttribDivisor(o,0);t.deleteBuffer(i);var a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(o=0;o<a;++o)t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null),n&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(o,null));if(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),n){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);var s=t.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(o=0;o<s;++o)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,null);var u=t.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(o=0;o<u;++o)e.bindBufferBase(e.UNIFORM_BUFFER,o,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}},t.prototype.programInfo=function(t){for(var e=this.ctx.getProgramParameter(t,this.ctx.ACTIVE_ATTRIBUTES),n=0;n<e;++n){var r=this.ctx.getActiveAttrib(t,n);if(!r)break;console.log(this.ctx.getAttribLocation(t,r.name),r.name)}},t}();e.default=i},6750:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.registerModel=function(t){this.vertexBufferId||(this.vertexBufferId=t.addBufferCache(this.createModel()))},t}();e.default=n},7253:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.BaseCamera=void 0;var o=n(1355),a=n(566),s=n(2667),u=n(2949),c=n(5881),h=n(4315),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.zoomScale={x:2,y:2,z:2},e.baseTranslate={x:-1,y:-1,z:0},e._isUpdateView=!0,e.timer=new u.default,e.updateProjectionView=function(){e._isUpdateView=!0},e.commitProjectionView=function(){e._isUpdateView=!1;var t=o.quat.create();t=o.quat.rotateX(t,t,e.degreesToRadians(e.position.ax)),t=o.quat.rotateY(t,t,e.degreesToRadians(e.position.ay)),t=o.quat.rotateZ(t,t,e.degreesToRadians(e.position.az)),t=o.quat.normalize(t,t);var n=o.mat4.create(),r=o.mat4.create();o.mat4.fromQuat(r,t),o.mat4.multiply(n,n,r);var i=o.vec3.fromValues(-e.position.x,-e.position.y,-e.position.z);o.mat4.translate(n,n,i),e.viewMatrix=n},e.perspective=function(){return o.mat4.perspective(o.mat4.create(),e.degreesToRadians(e.fov),e.aspect,e.near,e.far)},e.updateProjectionMatrix=function(){e.frustum=e.perspective()},e}return i(e,t),e.prototype.clearPan=function(){this.interval&&(clearInterval(this.interval),this.interval=void 0)},e.prototype.pan=function(t,e,n,r,i){var o=this;this.interval&&(clearInterval(this.interval),this.interval=void 0),this.steps=t,this._moveTime=t,void 0!==n?(this.dx=n-this.position.x,this.tx=n):(this.dx=0,this.tx=this.position.x),void 0!==r?(this.dy=r-this.position.y,this.ty=r):(this.dy=0,this.ty=this.position.y),void 0!==i?(this.dz=i-this.position.z,this.tz=i):(this.dz=0,this.tz=this.position.z),this.timer.start(),this.interval=setInterval(function(){var t=o.timer.peak();o.steps>0?(o.steps-=t,o.steps<=0?(o.position.x=o.tx,o.position.y=o.ty,o.position.z=o.tz,o.interval&&(clearInterval(o.interval),o.interval=void 0)):(o.position.x+=o.dx*t/o._moveTime,o.position.y+=o.dy*t/o._moveTime,o.position.z+=o.dz*t/o._moveTime),o.updateProjectionView()):(o.position.x=o.tx,o.position.y=o.ty,o.position.z=o.tz,o.interval&&(clearInterval(o.interval),o.interval=void 0),o.updateProjectionView()),o.timer.start()},e)},e.prototype.isOutOfBound=function(t,e){return!1},e.prototype.isUpdateView=function(){return this._isUpdateView},e.prototype.angleX=function(t){if(this.position.ax-=t,this.position.ax>90){var e=90;this.position.ax=e}else this.position.ax<-90&&(e=-90,this.position.ax=e)},e.prototype.angleZ=function(t){if(this.position.az+=t,this.position.az>360){var e=this.position.az-360;this.position.az=e}else this.position.az<0&&(e=this.position.az+360,this.position.az=e)},e.prototype.angleY=function(t){var e,n;if((null===(n=null===(e=this.cameraOptions)||void 0===e?void 0:e.experimental)||void 0===n?void 0:n.inverseAngleY)&&t&&(t*=-1),this.position.ay+=t,this.position.ay>360){var r=this.position.ay-360;this.position.ay=r}else this.position.ay<0&&(r=this.position.ay+360,this.position.ay=r)},e.prototype.zoomIn=function(t){this.fov-=t,this.fov=Math.max(t,this.fov),this.updateProjectionMatrix()},e.prototype.zoomOut=function(t){var e=360*Math.atan(1/this.aspect)/Math.PI;this.fov+=t,this.fov=Math.min(Math.min(this.cameraOptions.maxFov||e,e),this.fov),this.updateProjectionMatrix()},e.prototype.setupCamera=function(t,e,n){var r;this.cameraOptions=t||{};var i=this.near||t.near||1,o=this.far||t.far||4,a=t.aspect||n.width/n.height;if(null===(r=this.cameraOptions.experimental)||void 0===r?void 0:r.enabled){var s=n.offsetWidth,u=n.offsetHeight,c={x:s<=u?2:2*e/(s/u),y:u<=s?2:2*e/(s/u),z:1};this.setZoom(c),this.setBaseTranslate({x:(2-c.x)/2-1,y:(2-c.y)/2-1,z:0})}var h=this.fov||t.fov||45;t.isFovMax&&(h=360*Math.atan(1/a)/Math.PI),this.aspect=a,this.fov=h,this.near=i,this.far=o,this.updateProjectionMatrix(),this.updateProjectionView()},e.prototype.setZoom=function(t){this.zoomScale=t},e.prototype.setBaseTranslate=function(t){this.baseTranslate=t},e}(a.default);e.BaseCamera=f;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.INTERVAL_TIME=10,e.bound=new c.default(0,0,1,1),e.perspective=function(){var t=o.mat4.create();return o.mat4.translate(t,t,o.vec3.fromValues(e.baseTranslate.x,e.baseTranslate.y,e.baseTranslate.z)),o.mat4.scale(t,t,o.vec3.fromValues(e.zoomScale.x,e.zoomScale.y,1)),t},e}return i(e,t),e.prototype.distanceEvent=function(t){return new s.default(t.x+this.position.x,this.position.y+t.y)},e.prototype.zoomIn=function(t){this.zoomScale.x+=t,this.zoomScale.y+=t,this.updateProjectionMatrix()},e.prototype.zoomOut=function(t){this.zoomScale.x=Math.max(.1,this.zoomScale.x-t),this.zoomScale.y=Math.max(.1,this.zoomScale.y-t),this.updateProjectionMatrix()},e.prototype.isOutOfBound=function(t){return this.bound.x=this.position.x+this.bound.width/2,this.bound.y=this.position.y+this.bound.height/2,!h.CollisionDetection.isRectInRect(this.bound,t)},e.prototype.pan2d=function(e,n,r){t.prototype.pan.call(this,e,this.INTERVAL_TIME,n,r)},e.prototype.pan2dDif=function(e,n,r){var i=this.position,o=i.x,a=i.y;t.prototype.pan.call(this,e,this.INTERVAL_TIME,o+(null!=n?n:0),a+(null!=r?r:0))},e}(f),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.pan3d=function(e,n,r,i){t.prototype.pan.call(this,e,this.INTERVAL_TIME,n,r,i)},e}(l),d=function(){function t(){this.camera3d=new p}return t.prototype.setupCamera=function(t,e,n){this.camera3d.setupCamera(t,e||1,n),this.height=n.height,this.width=n.width},t.prototype.commitProjectionView=function(){this.camera3d.isUpdateView()&&this.camera3d.commitProjectionView()},t}();e.default=d},7515:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7806),a=function(t){function e(e,n){var r=t.call(this,e,new o.TextureVertexModel)||this;return r.vertexUvCacheId=n,r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(e){this.vertexModel=e.newVertexModelUv3d(this.vertexUvCacheId),t.prototype.init.call(this,e)},e}(o.ModelObject3d);e.default=a},7613:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=t.call(this,0,0,0,0,0)||this;return e.x=0,e.y=0,e.z=0,e.ax=0,e.ay=0,e.az=0,e.nx=0,e.ny=0,e.nz=0,e.width=0,e.height=0,e.length=0,e.scaleX=1,e.scaleY=1,e.scaleZ=1,e.originX=0,e.originY=0,e.originZ=0,e.maxHeight=0,e.maxWidth=0,e}return i(e,t),e}(n(5881).default);e.default=o},7806:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextureVertexModel=e.RenderType=e.Object3d=e.ModelObject3d=e.BitmapConfigParser=e.Plane3d=e.Coordinate=e.Camera=e.Polygon=e.CollisionDetection=e.Collision=e.Events=e.ConfigEntity=e.generateId=e.Timer=e.Position=e.Physics=e.ModelPosition=e.Rect2d=e.Rect3d=e.Moveable=e.Colour=e.PlaneType=e.Light=e.Resource=e.ResourceResolver=e.LineColour=e.FontReference=e.Font=e.EntityManager2d=e.EntityManager=e.ObjectManager=e.EngineMap=e.EngineHelper=e.EngineObject=e.App=void 0;var r=n(6079);e.App=r.default;var i=n(5103);Object.defineProperty(e,"EngineObject",{enumerable:!0,get:function(){return i.default}});var o=n(5880);Object.defineProperty(e,"EngineHelper",{enumerable:!0,get:function(){return o.default}});var a=n(3480);Object.defineProperty(e,"EngineMap",{enumerable:!0,get:function(){return a.default}});var s=n(2812);Object.defineProperty(e,"ObjectManager",{enumerable:!0,get:function(){return s.default}});var u=n(1816);Object.defineProperty(e,"EntityManager",{enumerable:!0,get:function(){return u.default}});var c=n(8446);Object.defineProperty(e,"EntityManager2d",{enumerable:!0,get:function(){return c.default}});var h=n(2067);Object.defineProperty(e,"Font",{enumerable:!0,get:function(){return h.default}});var f=n(2067);Object.defineProperty(e,"FontReference",{enumerable:!0,get:function(){return f.FontReference}});var l=n(8148);Object.defineProperty(e,"LineColour",{enumerable:!0,get:function(){return l.default}});var p=n(8762);Object.defineProperty(e,"ResourceResolver",{enumerable:!0,get:function(){return p.default}});var d=n(7821);Object.defineProperty(e,"Resource",{enumerable:!0,get:function(){return d.default}});var y=n(5025);Object.defineProperty(e,"Light",{enumerable:!0,get:function(){return y.default}});var v=n(9619);Object.defineProperty(e,"PlaneType",{enumerable:!0,get:function(){return v.default}});var m=n(5425);Object.defineProperty(e,"Colour",{enumerable:!0,get:function(){return m.default}});var b=n(5835);Object.defineProperty(e,"Moveable",{enumerable:!0,get:function(){return b.default}});var g=n(684);Object.defineProperty(e,"Rect3d",{enumerable:!0,get:function(){return g.default}});var _=n(5881);Object.defineProperty(e,"Rect2d",{enumerable:!0,get:function(){return _.default}});var x=n(566);Object.defineProperty(e,"ModelPosition",{enumerable:!0,get:function(){return x.default}});var w=n(3335);Object.defineProperty(e,"Physics",{enumerable:!0,get:function(){return w.default}});var E=n(7613);Object.defineProperty(e,"Position",{enumerable:!0,get:function(){return E.default}});var M=n(2949);Object.defineProperty(e,"Timer",{enumerable:!0,get:function(){return M.default}});var T=n(1854);Object.defineProperty(e,"generateId",{enumerable:!0,get:function(){return T.generateId}});var P=n(1213);Object.defineProperty(e,"ConfigEntity",{enumerable:!0,get:function(){return P.ConfigEntity}});var R=n(5063);Object.defineProperty(e,"Events",{enumerable:!0,get:function(){return R.default}});var O=n(4315);Object.defineProperty(e,"Collision",{enumerable:!0,get:function(){return O.Collision}}),Object.defineProperty(e,"CollisionDetection",{enumerable:!0,get:function(){return O.CollisionDetection}}),Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return O.Polygon}});var S=n(7253);Object.defineProperty(e,"Camera",{enumerable:!0,get:function(){return S.default}});var I=n(2667);Object.defineProperty(e,"Coordinate",{enumerable:!0,get:function(){return I.default}});var C=n(3637);Object.defineProperty(e,"Plane3d",{enumerable:!0,get:function(){return C.default}});var A=n(3962);Object.defineProperty(e,"BitmapConfigParser",{enumerable:!0,get:function(){return A.default}});var D=n(993);Object.defineProperty(e,"ModelObject3d",{enumerable:!0,get:function(){return D.default}});var N=n(9414);Object.defineProperty(e,"Object3d",{enumerable:!0,get:function(){return N.default}});var L=n(2224);Object.defineProperty(e,"RenderType",{enumerable:!0,get:function(){return L.RenderType}});var j=n(5259);Object.defineProperty(e,"TextureVertexModel",{enumerable:!0,get:function(){return j.default}})},7821:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(){}},7823:(t,e,n)=>{n.r(e),n.d(e,{ARRAY_TYPE:()=>i,EPSILON:()=>r,RANDOM:()=>o,equals:()=>c,setMatrixArrayType:()=>a,toRadian:()=>u});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;function a(t){i=t}var s=Math.PI/180;function u(t){return t*s}function c(t,e){return Math.abs(t-e)<=r*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},7857:t=>{t.exports="\nprecision mediump float;\nprecision mediump int;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_normal;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_ambient_coefficient;\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\n\nuniform sampler2D texture;\nuniform sampler2D shadowMap;\n\nvoid main(void) {\n  vec3 n = normalize(v_normal);\n  vec3 l = normalize(v_light1_pos);\n  float cosTheta = clamp(dot(n, l), 0.0, 1.0);\n\n  vec4 surfaceColor = texture2D(texture, v_texture_coords);\n  vec3 diffuse = v_diffuseCoefficient * surfaceColor.rgb * v_light1_intensities;\n  vec3 ambient = v_light1_ambient_coefficient * surfaceColor.rgb * v_light1_intensities;\n\n  vec3 linearColor = ambient + v_attenuation * diffuse * cosTheta;\n\n  gl_FragColor = vec4(linearColor, surfaceColor.a);\n}\n\n"},8043:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n){var r=t.call(this)||this;return r.spriteModel=n,r.spriteModel.setRect(e),r.entities.push(r.spriteModel),r}return i(e,t),e.prototype.render=function(t){this.spriteModel.render(t)},e.prototype.update=function(t){this.spriteModel.update(t)},e.prototype.init=function(e){t.prototype.init.call(this,e),this.setRect(this.spriteModel.getRect()),this.updatePhysicsPosition()},e}(n(5835).default);e.default=o},8101:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RendererNotification=e.RendererSubscription=void 0;var r=n(2224),i=n(368),o=n(3080),a=n(6368),s=n(4160),u=n(6266),c=n(978),h=function(){function t(){}return t.CREATE_TEXTURE=new c.Subscription("Renderer#CreateTexture"),t.REGISTER_ENTITY=new c.Subscription("Renderer#RegisterEntity"),t.createTexturePayload=function(t,e){return[t,e]},t.registerEntityPayload=function(t,e){return[t,e]},t}();e.RendererSubscription=h;var f=function(){function t(){}return t.NOTIFICATION_PRE_RENDER_KEY="Renderer#Prerender",t.NOTIFICATION_RENDER_KEY="Renderer#Render",t.NOTIFICATION_INIT_KEY="Renderer#Init",t.UPDATE_PROJECTION_MATRIX=new u.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"UPDATE_PROJECTION_MATRIX"),t.RESIZE_SCREEN=new u.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"RESIZE_SCREEN"),t.CREATE_TEXTURE=new u.Notification(t.NOTIFICATION_INIT_KEY,"CREATE_TEXTURE"),t.REGISTER_ENTITY=new u.Notification(t.NOTIFICATION_INIT_KEY,"REGISTER_ENTITY"),t.registerEntity=function(e,n){return u.NotificationPayload.from(t.REGISTER_ENTITY,[e,n])},t.UPDATE_BUFFER=new u.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"UPDATE_BUFFER"),t.updateBuffer=function(e,n){return u.NotificationPayload.from(t.UPDATE_BUFFER,[e,n])},t.createTexture=function(e,n){return u.NotificationPayload.from(t.CREATE_TEXTURE,[e,n])},t.SET_LIGHTING=new u.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"SET_LIGHTING"),t.setLighting=function(e){return u.NotificationPayload.from(t.SET_LIGHTING,[e])},t.RENDER_ENTITY=new u.Notification(t.NOTIFICATION_RENDER_KEY,"RENDER_ENTITY"),t.renderEntity=function(e,n){return u.NotificationPayload.from(t.RENDER_ENTITY,[e,n])},t}();e.RendererNotification=f;var l=function(){function t(t,e,n,i,o){var u=this;if(this.textureReg={},this._renderEntities={},this.cachedModelData={},this.resizeViewPort=function(){u.glContext.resizeViewPort(u.webGLContainer.canvas)},this.updatePerspective=function(){u.shader3DProgram&&u.shader3DProgram.updatePerspective(u.camera.camera3d.frustum),u.shaderColourProgram&&u.shaderColourProgram.updatePerspective(u.camera.camera3d.frustum)},this.delete=function(){Object.values(u.textureReg).forEach(function(t){var e=t.texture;e.texture&&u.glContext.deleteTexture(e.texture),e.texture=void 0,e.texUnit=void 0}),s.default.textureCount=0,u.shader3DProgram&&u.shader3DProgram.delete(),u.shaderColourProgram&&u.shaderColourProgram.delete(),u.glContext.destroyWebGL()},this.setLighting=function(t){if(!u.shader3DProgram)throw new Error("Lighting is set without any 3D entities");u.shader3DProgram.setLight(t,u.camera.camera3d)},this.updateBuffer=function(t,e){var n=t.getOpt();u._getProgramOpt(n).updateBuffer(t,e)},this._getProgram3D=function(t){if(u._isPlain(t))throw new Error("Plain no longer supported");return u.shader3DProgram},this._getProgramOpt=function(t){var e;if(r.ShaderType.COLOUR===t.shaderType)e=u.shaderColourProgram;else{if(r.ShaderType.THREE_DIMENSION!==t.shaderType&&r.ShaderType.TWO_DIMENSION!==t.shaderType)throw new Error("unsupported opt shader type");e=u._getProgram3D(t)}return e},this._defRender=function(){u._defRenderTop(!1),u._defRenderTop(!0)},this._render=function(t,e){if(!t.hidden){var n=t.getOpt(),i=[t,e];r.ShaderType.COLOUR===n.shaderType?u._renderEntities[r.ShaderType.COLOUR].push(i):r.ShaderType.THREE_DIMENSION===n.shaderType?u._renderEntities[r.ShaderType.THREE_DIMENSION].push(i):r.ShaderType.TWO_DIMENSION===n.shaderType&&u._renderEntities[r.ShaderType.TWO_DIMENSION].push(i)}},this.bindBuffer=function(){u.shader3DProgram&&u.shader3DProgram.bindBuffer(),u.shaderColourProgram&&u.shaderColourProgram.bindBuffer()},this._resetDefferred=function(){var t;u._renderEntities=((t={})[r.ShaderType.COLOUR]=[],t[r.ShaderType.THREE_DIMENSION]=[],t[r.ShaderType.TWO_DIMENSION]=[],t)},this.handleNotification=function(t){var e=!1;switch(t.action){case f.RENDER_ENTITY.action:u._render(t.data[0],t.data[1]);break;case f.UPDATE_PROJECTION_MATRIX.action:e=!0;break;case f.RESIZE_SCREEN.action:u.resizeViewPort(),e=!0;break;case f.CREATE_TEXTURE.action:u.createTexture(t.data[0],t.data[1]);break;case f.UPDATE_BUFFER.action:u.updateBuffer(t.data[0],t.data[1]);break;case f.REGISTER_ENTITY.action:u.registerEntity(t.data[0],t.data[1]);break;case f.SET_LIGHTING.action:u.setLighting(t.data[0]);break;default:console.error("unhandled notification: ",t)}e&&u.updatePerspective()},!t.world)throw new Error("world not defined");this.notificationQueue=i,this.subscriberPool=o,this.camera=n,this.world=t.world,this.webGLContainer=e,this.ctx=this.webGLContainer.getCtx(),this.glContext=new a.default(this.ctx),this.glContext.setupDefault(),this.subscriberPool.listen(h.CREATE_TEXTURE,function(t){var e=t[0],n=t[1];u.createTexture(e,n)}),this.subscriberPool.listen(h.REGISTER_ENTITY,function(t){var e=t[0],n=t[1];u.registerEntity(e,n)})}return t.prototype._isPlain=function(t){return t.renderType===r.RenderType.PLAIN},t.prototype._defRenderTop=function(t){var e=this._renderEntities[r.ShaderType.COLOUR].filter(function(e){return!!e[0].isTop===t});e.length>0&&this.shaderColourProgram.render(e,this.camera.camera3d);var n=this._renderEntities[r.ShaderType.THREE_DIMENSION].filter(function(e){return!!e[0].isTop===t});n.length>0&&(this.shader3DProgram.render3DShadowMap(n,this.resizeViewPort),this.shader3DProgram.render(n,this.camera.camera3d,this.textureReg,!1));var i=this._renderEntities[r.ShaderType.TWO_DIMENSION].filter(function(e){return!!e[0].isTop===t});i.length>0&&this.shader3DProgram.render(i,this.camera.camera3d,this.textureReg,!0)},t.prototype.init=function(){this.readMessages(f.NOTIFICATION_INIT_KEY)},t.prototype.readMessages=function(t,e){var n;void 0===e&&(e=!1);for(var r={};n=this.notificationQueue.take(t);)e&&void 0!==r[n.action]||(this.handleNotification(n),e&&(r[n.action]=!0))},t.prototype._lazyLoadProgram=function(t){if(r.ShaderType.COLOUR===t.shaderType)this.shaderColourProgram||(this.shaderColourProgram=new o.default(this.ctx));else{if(r.ShaderType.THREE_DIMENSION!==t.shaderType&&r.ShaderType.TWO_DIMENSION!==t.shaderType)throw console.error(this,t),new Error("unsupported opt shader type");this.shader3DProgram||(this.shader3DProgram=new i.default(this.ctx))}this.updatePerspective()},t.prototype.registerEntity=function(t,e){var n=t.getOpt();this._lazyLoadProgram(n);var r=this._getProgramOpt(n);this.cachedModelData[e.$id]?t.rendererBufferId=this.cachedModelData[e.$id]:(r.registerEntity(t,e.vertices),this.cachedModelData[e.$id]=t.rendererBufferId)},t.prototype.render=function(t,e){this.glContext.clear(),this.readMessages(f.NOTIFICATION_PRE_RENDER_KEY,!0),this.camera.commitProjectionView(),e.setTime(t),this._resetDefferred(),this.world.render(),e.renderFont(),this.readMessages(f.NOTIFICATION_RENDER_KEY),this._defRender()},t.prototype.createTexture=function(t,e){var n=t.getTextureSource();if(void 0===n)throw console.error("src is undefined when trying to create texture",t),new Error("src is undefined when trying to create texture");t.rendererTextureRef=n;var r=this.textureReg[n];if(r){if(r.texture&&r.texture.error)throw console.error("there was an error while trying to load texture",r),new Error("there was an error while trying to load texture")}else{var i=new s.default(n,this.ctx);this.textureReg[n]={texture:i},e.push(i.load)}},t}();e.default=l},8148:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5673),a=n(5425),s=n(5642),u=n(2224),c=n(5103),h=n(9463),f=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.point1=e,o.point2=n,o.thickness=r,o.rgba=i,o}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.updatePosition=function(t,e){this.point1=t,this.point2=e;var n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r),o=Math.atan2(r,n)*(180/Math.PI),a=(t.x+e.x)/2,s=(t.y+e.y)/2;this.center(a,s,0),this.rotateOrigin(a,s,0),this.angleZ(o),this.scale(i,this.thickness,1)},e.prototype.init=function(t){this.vertexModel=(new s.default).fillRenderUnits(h.default.vertex.planeXYColour(this.rgba||new a.default(0,0,0,0))),this.updatePosition(this.point1,this.point2);var e=new u.default;e.renderType=u.RenderType.TRIANGLE,e.shaderType=u.ShaderType.COLOUR,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).build(this,e)},e}(c.default);e.default=f},8184:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5673),a=n(5642),s=n(2224),u=n(5103),c=n(9463),h=function(t){function e(e,n){var r=t.call(this)||this;return r.vertexModel=(new a.default).fillRenderUnits(c.default.vertex.triangleXYColour(n)),r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(t){var e=new s.default;e.renderType=s.RenderType.TRIANGLE,e.shaderType=s.ShaderType.COLOUR,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).build(this,e)},e}(u.default);e.default=h},8372:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5673),a=n(2224),s=function(t){function e(e,n){var r=t.call(this)||this;return r.vertexModel=n,r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.init=function(t){var e=new a.default;e.renderType=a.RenderType.RECTANGLE,e.shaderType=a.ShaderType.TWO_DIMENSION,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).createTexture(this.vertexModel.textureSource).build(this,e)},e}(n(5103).default);e.default=s},8446:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(1816),a=n(4648),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.setLayer=function(t){return this.entities.forEach(function(e){e instanceof a.default&&e.setLayer(t)}),this.position.z=-1*t,this},e.prototype.init=function(e){t.prototype.init.call(this,e),this.setLayer(-this.position.z)},e}(o.default);e.default=s},8558:t=>{t.exports="\nprecision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\n  gl_FragColor = v_color;\n}\n\n"},8589:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){"string"==typeof t?this.vertices=t.split(",").map(parseFloat):t instanceof Array?this.vertices=t:console.error("Unexpected obj type")}},8745:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.ctx=t}return t.prototype.compileShaders=function(t,e){var n=this.ctx,r=n.createShader(n.VERTEX_SHADER),i=n.createShader(n.FRAGMENT_SHADER);if(!r||!i)throw new Error("Unable to create vertex or fragment shader");var o=e,a=t;if(n.shaderSource(r,a),n.compileShader(r),n.shaderSource(i,o),n.compileShader(i),!n.getShaderParameter(r,n.COMPILE_STATUS))throw new Error("could not compile vertex shader:"+n.getShaderInfoLog(r));if(!n.getShaderParameter(i,n.COMPILE_STATUS))throw new Error("could not compile fragment shader:"+n.getShaderInfoLog(i));var s=n.createProgram();if(n.attachShader(s,r),n.attachShader(s,i),n.linkProgram(s),n.validateProgram(s),!n.getProgramParameter(s,n.LINK_STATUS))throw new Error("Link failed: "+n.getProgramInfoLog(s));return s},t.prototype.delete=function(){this.ctx.deleteProgram(this.program)},t.prototype._bindProgram=function(t){this.ctx.useProgram(t)},t.prototype._unbindProgram=function(){},t}();e.default=n},8762:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(8968),i=n(3962),o=n(8589),a=function(){function t(){}return t.bmFontResolver=function(t){return function(t){return t.registerFont(new r.default(t.data)),t}},t.bitmapResolver=function(t,e,n,r){return function(o){var a=new i.default(o.data,e,n,r),s=a.getTextureSource();for(var u in a.getMap())if(a.map.hasOwnProperty(u)){var c=a.map[u];t.addUVCache(s,u,c)}return o}},t.objResolverMultiple=function(t,e){return function(n){e.map(function(e){var r=e.textureSource,i=e.name;return t.addVertexUvCache(r,i,new o.default(n.data).vertices)})}},t.objResolver=function(t,e,n){return function(r){t.addVertexUvCache(e,n,new o.default(r.data).vertices)}},t}();e.default=a},8968:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5201),a=function(t){function e(e){var n=t.call(this)||this,r=e.split("\n");for(var i in n.context=new o.FontMeta,r)if(r.hasOwnProperty(i)){var a=r[i];n.parseWidth(n.context,a),n.parseHeight(n.context,a),n.parseFilename(n.context,a),n.parseLineHeight(n.context,a),n.parseChar(n.context,a)}return n}return i(e,t),e.prototype.parseChar=function(t,n){var r=n.match(e.FONT_CHAR);if(r){var i=new o.FontCharacter;i.charCode=parseFloat(r[1]),i.x=parseFloat(r[2]),i.y=parseFloat(r[3]),i.width=parseFloat(r[4]),i.height=parseFloat(r[5]),i.xOffset=parseFloat(r[6])/t.width,i.yOffset=parseFloat(r[7])/t.height,i.char=String.fromCharCode(i.charCode),t.fonts[i.char]=i}},e.prototype.parseHeight=function(t,n){if(!t.height){var r=n.match(e.HEIGHT);r&&(t.height=parseFloat(r[1]))}},e.prototype.parseLineHeight=function(t,n){if(!t.lineHeight){var r=n.match(e.LINE_HEIGHT);r&&(t.lineHeight=parseFloat(r[1]))}},e.prototype.parseWidth=function(t,n){if(!t.width){var r=n.match(e.WIDTH);r&&(t.width=parseFloat(r[1]))}},e.prototype.parseFilename=function(t,n){if(!t.filename){var r=n.match(e.FILENAME);r&&(t.filename=r[1])}},e.FILENAME=/file="([\w\d\W\D]+)"/,e.WIDTH=/scaleW=([\d]+)/,e.HEIGHT=/scaleH=([\d]+)/,e.LINE_HEIGHT=/lineHeight=([\d]+)/,e.FONT_CHAR=new RegExp("char[\\s]+"+["id","x","y","width","height","xoffset","yoffset"].map(function(t){return"".concat(t,"=([-\\d]+)[\\s]+")}).reduce(function(t,e){return t+e})),e}(o.default);e.default=a},9095:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.ColourRenderUnit=e.TextureRenderUnit=e.RenderUnit=e.Colour=e.TextureUnit=void 0;var o=n(2667),a=function(){this.u=0,this.v=0};e.TextureUnit=a;var s=function(){this.r=0,this.g=0,this.b=0,this.a=0};e.Colour=s;var u=function(){this.vertex=new o.default(0,0,0)};e.RenderUnit=u;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.texture=new a,e.normal=new o.default(0,0,0),e}return i(e,t),e}(u);e.TextureRenderUnit=c;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colour=new s,e}return i(e,t),e}(u);e.ColourRenderUnit=h},9414:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5259),a=function(t){function e(e,n){var r=t.call(this,e,new o.default)||this;return r.vertexUvCacheId=n,r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(e){this.vertexModel=e.newVertexModelUv3d(this.vertexUvCacheId),t.prototype.init.call(this,e)},e}(n(993).default);e.default=a},9463:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(4315),i=n(9709),o=function(){function t(){}return t.vertex=new i.VertexBuilder,t.collision=new r.CollisionDetection,t}();e.default=o},9619:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r,i){this.name=t,this.width=e,this.height=n,this.length=r,this.normalDirection=i}return t.XY=new t("XY",0,0,0,0),t.YX=new t("YX",0,0,0,0),t.XZ=new t("XZ",0,0,0,0),t.ZX=new t("ZX",0,0,0,0),t.YZ=new t("YZ",0,0,0,0),t.ZY=new t("ZY",0,0,0,0),t.BACKWARDS=-1,t.FORWARD=1,t}();e.default=n},9709:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VertexBuilder=void 0;var r=n(9619),i=function(){function t(){}return t.prototype.toArray2D=function(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.push(r.vertex.x),e.push(r.vertex.y),e.push(r.vertex.z),e.push(r.normal.x),e.push(r.normal.y),e.push(r.normal.z),e.push(r.texture.u),e.push(r.texture.v)}return e},t.prototype.toTextureArray=function(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.push(r.vertex.x),e.push(r.vertex.y),e.push(r.vertex.z),e.push(r.normal.x),e.push(r.normal.y),e.push(r.normal.z),e.push(r.texture.u),e.push(r.texture.v)}return e},t.prototype.toColourArray=function(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.push(r.vertex.x),e.push(r.vertex.y),e.push(r.vertex.z),e.push(r.colour.r),e.push(r.colour.g),e.push(r.colour.b),e.push(r.colour.a)}return e},t.prototype.triangleXYColour=function(t){var e=t.r/255,n=t.g/255,r=t.b/255,i=t.a/255;return[1,1,0,e,n,r,i,0,1,0,e,n,r,i,0,0,0,e,n,r,i]},t.prototype.planeXYColour=function(t){var e=t.r/255,n=t.g/255,r=t.b/255,i=t.a/255;return[-.5,-.5,0,e,n,r,i,.5,-.5,0,e,n,r,i,-.5,.5,0,e,n,r,i,.5,.5,0,e,n,r,i]},t.prototype.planeCCW=function(t,e,n){var r=t[0],i=t[1],o=t[2],a=t[3];return[r/e,a/n,r/e,i/n,o/e,i/n,o/e,a/n]},t.prototype.planeCW=function(t,e,n){var r=t[0],i=t[1],o=t[2],a=t[3];return[o/e,a/n,o/e,i/n,r/e,i/n,r/e,a/n]},t.prototype.planeUV=function(t,e){t[0].texture.u=e[4],t[0].texture.v=e[1],t[2].texture.u=e[4],t[2].texture.v=e[3],t[1].texture.u=e[0],t[1].texture.v=e[1],t[3].texture.u=e[0],t[3].texture.v=e[3]},t.prototype.planeXY=function(t){this.plane(t,r.default.XY)},t.prototype.plane=function(t,e){switch(e){case r.default.XY:t[0].vertex.x=-.5,t[0].vertex.y=-.5,t[0].normal.z=-1,t[1].vertex.x=-.5,t[1].vertex.y=.5,t[1].normal.z=-1,t[2].vertex.x=.5,t[2].vertex.y=-.5,t[2].normal.z=-1,t[3].vertex.x=.5,t[3].vertex.y=.5,t[3].normal.z=-1;break;case r.default.YX:t[0].vertex.x=.5,t[0].vertex.y=.5,t[0].normal.z=1,t[2].vertex.x=.5,t[2].vertex.y=-.5,t[2].normal.z=1,t[1].vertex.x=-.5,t[1].vertex.y=.5,t[1].normal.z=1,t[3].vertex.x=-.5,t[3].vertex.y=-.5,t[3].normal.z=1;break;case r.default.XZ:t[0].vertex.x=-.5,t[0].vertex.z=-.5,t[0].normal.y=1,t[1].vertex.x=-.5,t[1].vertex.z=.5,t[1].normal.y=1,t[2].vertex.x=.5,t[2].vertex.z=-.5,t[2].normal.y=1,t[3].vertex.x=.5,t[3].vertex.z=.5,t[3].normal.y=1;break;case r.default.ZX:t[0].vertex.x=.5,t[0].vertex.z=.5,t[0].normal.y=-1,t[2].vertex.x=.5,t[2].vertex.z=-.5,t[2].normal.y=-1,t[1].vertex.x=-.5,t[1].vertex.z=.5,t[1].normal.y=-1,t[3].vertex.x=-.5,t[3].vertex.z=-.5,t[3].normal.y=-1;break;case r.default.YZ:t[0].vertex.y=-.5,t[0].vertex.z=-.5,t[0].normal.x=-1,t[1].vertex.y=-.5,t[1].vertex.z=.5,t[1].normal.x=-1,t[2].vertex.y=.5,t[2].vertex.z=-.5,t[2].normal.x=-1,t[3].vertex.y=.5,t[3].vertex.z=.5,t[3].normal.x=-1;break;case r.default.ZY:t[0].vertex.y=.5,t[0].vertex.z=.5,t[0].normal.x=1,t[2].vertex.y=.5,t[2].vertex.z=-.5,t[2].normal.x=1,t[1].vertex.y=-.5,t[1].vertex.z=.5,t[1].normal.x=1,t[3].vertex.y=-.5,t[3].vertex.z=-.5,t[3].normal.x=1}},t.prototype.circleXYColour=function(t,e){for(var n=e.r/255,r=e.g/255,i=e.b/255,o=e.a/255,a=2*Math.PI/t,s=[],u=-Math.PI/2;u<Math.PI/2;u+=a){var c=Math.sin(u),h=Math.cos(u);s.push(c,h,0),s.push(n,r,i,o),s.push(c,-h,0),s.push(n,r,i,o)}return s},t}();e.VertexBuilder=i},9996:t=>{t.exports="\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nuniform mat4 u_model;\nuniform mat4 u_view;\nuniform mat4 u_projection;\n\nvoid main(void) {\n  v_color = a_color;\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1);\n}\n\n"}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}return n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(4724)})());
//# sourceMappingURL=index.js.map