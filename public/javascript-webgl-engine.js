!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["javascript-webgl-engine"]=e():t["javascript-webgl-engine"]=e()}(this,()=>(()=>{"use strict";var t={39:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7435),a=n(5278),s=n(3968),u=n(1883),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.createRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t;e++)this.renderUnits.push(new o.TextureRenderUnit);return this},e.prototype.fillRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t.length;e+=8){var n=new o.TextureRenderUnit;n.vertex.x=t[e],n.vertex.y=t[e+1],n.vertex.z=t[e+2],n.normal.x=t[e+3],n.normal.y=t[e+4],n.normal.z=t[e+5],n.texture.u=t[e+6],n.texture.v=t[e+7],this.renderUnits.push(n)}return this},e.prototype.createModel=function(){var t=new s.default;return t.vertices=u.default.vertex.toTextureArray(this.renderUnits),t},e}(a.default);e.default=c},81:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nattribute vec3 a_position;\nattribute vec3 a_color;\nvarying vec3 v_color;\nuniform mat4 u_model;\nuniform mat4 u_view;\nuniform mat4 u_projection;\n\nvoid main(void) {\n  v_color = a_color;\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1);\n}\n"},757:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=t.call(this,0,0,0,0,0)||this;return e.x=0,e.y=0,e.z=0,e.ax=0,e.ay=0,e.az=0,e.nx=0,e.ny=0,e.nz=0,e.width=0,e.height=0,e.length=0,e.scaleX=1,e.scaleY=1,e.scaleZ=1,e.originX=0,e.originY=0,e.originZ=0,e.maxHeight=0,e.maxWidth=0,e}return i(e,t),e}(n(3765).default);e.default=o},875:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3893),a=n(8108),s=function(t){function e(e,n){var r=t.call(this)||this;return r.vertexModel=n,r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.init=function(t){var e=new a.default;e.renderType=a.RenderType.RECTANGLE,e.shaderType=a.ShaderType.THREE_DIMENSION,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).createTexture(this.vertexModel.textureSource).build(this,e)},e}(n(9727).default);e.default=s},1207:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(8251),i=n(8108),o=function(){function t(t){this.ctx=t,this.program=new r.default(t)}return t.prototype.updatePerspective=function(t){this.program.bindProgram(),this.program.glSetProjectMatrix(t)},t.prototype.delete=function(){this.program.arrayBuffer.delete(this.ctx),this.program.delete()},t.prototype.updateBuffer=function(t,e){var n=t.getOpt();if(i.ShaderType.THREE_DIMENSION===n.shaderType){var o=this.program.arrayBuffer.bufferReg[t.rendererBufferId];e&&e.length===o.verticesSize||console.error("New Buffer data does not match initial buffer data!",t,e,o.verticesSize),this.program.arrayBuffer.bufferSub(this.ctx,o.offset,o.size,e,r.default.DRAW_VERTEX_SIZE)}else console.error("Updating buffer for registered 3D Entity but with different shader type as RenderOptions",n)},t.prototype.render=function(t,e,n){this.program.arrayBuffer.bind(this.ctx),this.program.bindAttributePointers(),this.program.bindProgram(),this.program.glSetViewMatrix(e.viewMatrix),this.ctx.isEnabled(this.ctx.CULL_FACE)||this.ctx.enable(this.ctx.CULL_FACE),this.ctx.isEnabled(this.ctx.DEPTH_TEST)||this.ctx.enable(this.ctx.DEPTH_TEST);for(var r=0;r<t.length;r++){var o=t[r],a=o[0],s=o[1],u=a.getOpt();if(!a.rendererTextureRef)throw new Error("Unregistered entity texture"+a);var c=n[a.rendererTextureRef];if(this.program.bindTexture(c.texture),this.program.glSetModelViewMatrix(s),!a.rendererBufferId)throw new Error("Unregistered entity buffer"+a);var h=this.program.arrayBuffer.bufferReg[a.rendererBufferId];u.renderType===i.RenderType.TRIANGLE?this.ctx.drawArrays(this.ctx.TRIANGLES,h.offset,h.size):this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,h.offset,h.size)}this.program.arrayBuffer.unbind(this.ctx),this.program.unbindAttributePointers(),this.program.unbindProgram()},t.prototype.bindBuffer=function(){this.program.arrayBuffer.bufferBind(this.ctx)},t.prototype.registerEntity=function(e,n){var r=n.length/t.DRAW_VERTEX_SIZE;this.program.arrayBuffer.bufferReg[this.program.arrayBuffer.bufferRegId]={offset:this.program.arrayBuffer.length(),size:r,verticesSize:n.length},this.program.arrayBuffer.push(n,r),e.rendererBufferId=this.program.arrayBuffer.bufferRegId,this.program.arrayBuffer.bufferRegId++},t.DRAW_VERTEX_SIZE=8,t}();e.default=o},1406:function(t,e){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,r,i){var o=this;this.SOURCE_KEY="$source =",this.map=t.split("\n").map(function(t){return o.processLine(e,r,i,t)}).filter(function(t){return!!t}).reduce(function(t,e){return n(n({},t),e)}),this.raw=t.split("\n").map(function(t){return o.processRawLine(t)}).filter(function(t){return!!t}).reduce(function(t,e){return n(n({},t),e)})}return t.prototype.processRawLine=function(t){return t.startsWith(this.SOURCE_KEY)?void(this.source=t.substr(t.indexOf(this.SOURCE_KEY)+this.SOURCE_KEY.length)):this.processTextureLine(t)},t.prototype.processTextureLine=function(t){var e,n=" ",r=t.indexOf(n),i=t.substr(0,r),o=t.substr(r+1),a=(o=o.substr(o.indexOf(n)+1)).indexOf(n),s=parseFloat(o.substr(0,a+1)),u=(o=o.substr(a+1)).indexOf(n),c=parseFloat(o.substr(0,u)),h=(o=o.substr(u+1)).indexOf(n),f=parseFloat(o.substr(0,h));o=o.substr(h);var p=parseFloat(o);return(e={})[i]=[s,c,f,p],e},t.prototype.processLine=function(t,e,n,r){var i,o=" ",a=r.indexOf(o),s=r.substr(0,a),u=r.substr(a+1),c=(u=u.substr(u.indexOf(o)+1)).indexOf(o),h=parseFloat(u.substr(0,c+1)),f=(u=u.substr(c+1)).indexOf(o),p=parseFloat(u.substr(0,f)),l=(u=u.substr(f+1)).indexOf(o),d=parseFloat(u.substr(0,l));u=u.substr(l);var y=parseFloat(u);return(i={})[s]=[(h+d)/t-n,(y+p)/e-n,(h+d)/t-n,p/e+n,h/t+n,p/e+n,h/t+n,(p+y)/e-n],i},t.prototype.getMap=function(){return this.map},t.prototype.getTextureSource=function(){return this.source},t}();e.default=r},1442:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5282),a=function(t){function e(e,n){var r=t.call(this)||this;return r.cacheId=n,r.setRect(e),r}return i(e,t),e.prototype.render=function(t){this.entities.forEach(function(e){return e.render(t)})},e.prototype.isPointInGround=function(t){var e=null;for(var n in this.entities)if(this.entities.hasOwnProperty(n)){var r=this.entities[n];if(o.CollisionDetection.isPointInPlane3d(this.camera.camera3d,r,t.x,t.y)){e=r;break}}return e},e.prototype.init=function(t){this.camera=t.camera,this.createEntities(t),this.rotateOriginRect(this.getRect()),this.angleX(this.position.ax),this.angleY(this.position.ay),this.angleZ(this.position.az),this.initEntity(t)},e.prototype.createEntities=function(t){for(var e=this.position.width,n=this.position.length,r=this.position.x,i=this.position.y,a=this.position.z,s=t.newVertexModel(this.cacheId,o.PlaneType.XZ),u=0;u<e;u++)for(var c=0;c<n;c++){var h=new o.Rect3d(r+u-e/2,i,a+c-n/2,1,1,1),f=new o.Plane3d(h,s);this.entities.push(f)}},e.prototype.center=function(t,e,n){var r=this.position.x,i=this.position.z;if(Math.abs(r-t)>1e-5||Math.abs(i-n)>1e-5){for(var o=0;o<this.entities.length;o++)this.entities[o].translate(t-r,0,n-i);this.position.x=t,this.position.z=n}},e}(o.EntityManager);e.default=a},1513:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){"string"==typeof t?this.vertices=t.split(",").map(parseFloat):t instanceof Array?this.vertices=t:console.error("Unexpected obj type")}},1580:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(7103),i=n(3623),o=n(8108),a=n(39),s=n(1883),u=n(3215),c=n(7725),h=function(){function t(t,e,n){var i=this;this.resourcesLoading=[],this.bufferCache={},this.fontCache={},this.fontNameKeyReverse={},this.uvCache={},this.vertexUVCache={},this.cacheId=0,this.camera=n,this.notificationQueue=t,this.subscriberPool=e,e.listen(r.AppSubscription.GET_FPS,function(t){return i.fps=t})}return t.prototype.startIteration=function(){this.subscriberPool.publish(r.AppSubscription.START_ITERATION)},t.prototype.render=function(t){var e=t.opt.shaderType,n=this.camera.camera3d;if(e!==o.ShaderType.TWO_DIMENSION&&e!==o.ShaderType.COLOUR||!n||!n.isOutOfBound(t.modelPosition())){var r=t.getModel();t.clone&&(r=r.slice(0)),this.notificationQueue.pushPayload(c.RendererNotification.renderEntity(t,r))}},t.prototype.renderCopy=function(t,e){this.render(t.shaderEntity.renderCopy(e))},t.prototype.getTime=function(){return this.time},t.prototype.setLighting=function(t){this.notificationQueue.pushPayload(c.RendererNotification.setLighting(t))},t.prototype.createTexture=function(t){this.subscriberPool.publish(c.RendererSubscription.CREATE_TEXTURE,c.RendererSubscription.createTexturePayload(t,this.resourcesLoading))},t.prototype.getFPS=function(){return this.fps},t.prototype.getTotalPixelHeight=function(){return window.screen.height},t.prototype.getTotalPixelWidth=function(){return window.screen.width},t.prototype.getScreenHeight=function(){return this.camera.height},t.prototype.getScreenWidth=function(){return this.camera.width},t.prototype.setTime=function(t){t&&(this.time=t)},t.prototype.getVerticesById=function(t){if(this.bufferCache[t])return this.bufferCache[t].vertices;throw console.error("Unable to find src in cache",t,this),new Error("unable to find src in cache")},t.prototype.updateBufferCache=function(t,e){return t.cacheId=e,this.bufferCache[e]=t,e},t.prototype.addBufferCache=function(t){var e=this.cacheId++;return this.bufferCache[e]=t,t.cacheId=e,e},t.prototype.getResource=function(t){var e=this,n=new Promise(function(n,r){var i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status){var o=e.cacheId++;n({data:i.responseText,engineHelper:e,cacheId:o,registerBuffer:function(t){e.bufferCache[o]=t},registerFont:function(n){var r=new u.default(n);e.fontCache[o]={meta:n,font:r},e.fontNameKeyReverse[t]=o}})}else r(i.responseText)},i.send()});return this.resourcesLoading.push(n),n},t.prototype.getAllResourcesLoading=function(){return Promise.all(this.resourcesLoading)},t.prototype.updateBuffer=function(t){this.updateBufferCache(t.vertexModel.createModel(),t.vertexModel.vertexBufferId);var e=c.RendererNotification.updateBuffer(t,this.getBuffer(t));this.notificationQueue.pushPayload(e)},t.prototype.getBufferModelData=function(t){return this.bufferCache[t.getVertexBufferId()]},t.prototype.getBuffer=function(t){var e=this.getBufferModelData(t).vertices;if(!e)throw new Error("No buffer was found for this entity");return e},t.prototype.registerEntity=function(t){this.subscriberPool.publish(c.RendererSubscription.REGISTER_ENTITY,c.RendererSubscription.registerEntityPayload(t,this.getBufferModelData(t)))},t.prototype.initFont=function(){for(var t in this.fontCache)this.fontCache.hasOwnProperty(t)&&this.fontCache[t].font.init(this)},t.prototype.renderFont=function(){for(var t in this.fontCache)this.fontCache.hasOwnProperty(t)&&this.fontCache[t].font.render(this)},t.prototype.updateFont=function(){for(var t in this.fontCache)this.fontCache.hasOwnProperty(t)&&this.fontCache[t].font.update(this)},t.prototype.newVertexModel2d=function(t){return this.newVertexModel(t,i.default.YX)},t.prototype.newVertexModelUv3d=function(t){var e=this.vertexUVCache[t],n=(new a.default).fillRenderUnits(e.uv);return n.textureSource=e.source,n},t.prototype.createPlaneVertexModel=function(t,e,n){var r=(new a.default).createRenderUnits(4);return r.textureSource=t,s.default.vertex.plane(r.renderUnits,n),s.default.vertex.planeUV(r.renderUnits,e),r},t.prototype.getUVCache=function(t){return this.uvCache[t].uv},t.prototype.addUVCache=function(t,e,n){this.uvCache[e]={source:t,uv:n}},t.prototype.getVertexUvCache=function(t){return this.vertexUVCache[t].uv},t.prototype.newVertexModel=function(t,e){var n=this.uvCache[t];return this.createPlaneVertexModel(n.source,n.uv,e)},t.prototype.addVertexUvCache=function(t,e,n){this.vertexUVCache[e]={source:t,uv:n}},t.prototype.writeFont=function(t){var e=void 0;if("string"==typeof t.$cacheId)e=this.fontNameKeyReverse[t.$cacheId];else if("number"==typeof t.$cacheId)e=t.$cacheId;else if(void 0!==t.$cacheId)throw new Error("fontId is not a number or string");return(void 0===e?u.default.DefaultFont:this.fontCache[e].font).writeRef(t)},t.prototype.updateProjectionMatrix=function(){this.notificationQueue.pushPayload(c.RendererNotification.UPDATE_PROJECTION_MATRIX)},t}();e.default=h},1656:(t,e,n)=>{n.r(e),n.d(e,{glMatrix:()=>r,mat2:()=>i,mat2d:()=>o,mat3:()=>a,mat4:()=>s,quat:()=>h,quat2:()=>f,vec2:()=>p,vec3:()=>u,vec4:()=>c});var r={};n.r(r),n.d(r,{ARRAY_TYPE:()=>d,EPSILON:()=>l,RANDOM:()=>y,equals:()=>g,setMatrixArrayType:()=>v,toRadian:()=>b});var i={};n.r(i),n.d(i,{LDU:()=>N,add:()=>B,adjoint:()=>O,clone:()=>x,copy:()=>w,create:()=>_,determinant:()=>S,equals:()=>V,exactEquals:()=>z,frob:()=>L,fromRotation:()=>j,fromScaling:()=>D,fromValues:()=>E,identity:()=>M,invert:()=>R,mul:()=>H,multiply:()=>C,multiplyScalar:()=>X,multiplyScalarAndAdd:()=>Y,rotate:()=>I,scale:()=>A,set:()=>T,str:()=>F,sub:()=>G,subtract:()=>U,transpose:()=>P});var o={};n.r(o),n.d(o,{add:()=>ct,clone:()=>q,copy:()=>W,create:()=>k,determinant:()=>J,equals:()=>dt,exactEquals:()=>lt,frob:()=>ut,fromRotation:()=>it,fromScaling:()=>ot,fromTranslation:()=>at,fromValues:()=>K,identity:()=>Z,invert:()=>Q,mul:()=>yt,multiply:()=>tt,multiplyScalar:()=>ft,multiplyScalarAndAdd:()=>pt,rotate:()=>et,scale:()=>nt,set:()=>$,str:()=>st,sub:()=>vt,subtract:()=>ht,translate:()=>rt});var a={};n.r(a),n.d(a,{add:()=>Vt,adjoint:()=>Pt,clone:()=>gt,copy:()=>_t,create:()=>mt,determinant:()=>Rt,equals:()=>kt,exactEquals:()=>Gt,frob:()=>zt,fromMat2d:()=>Ft,fromMat4:()=>bt,fromQuat:()=>Lt,fromRotation:()=>jt,fromScaling:()=>Dt,fromTranslation:()=>At,fromValues:()=>xt,identity:()=>Mt,invert:()=>Tt,mul:()=>qt,multiply:()=>Ot,multiplyScalar:()=>Yt,multiplyScalarAndAdd:()=>Ht,normalFromMat4:()=>Nt,projection:()=>Bt,rotate:()=>Ct,scale:()=>It,set:()=>wt,str:()=>Ut,sub:()=>Wt,subtract:()=>Xt,translate:()=>St,transpose:()=>Et});var s={};n.r(s),n.d(s,{add:()=>Be,adjoint:()=>re,clone:()=>Kt,copy:()=>$t,create:()=>Zt,determinant:()=>ie,equals:()=>Ye,exactEquals:()=>Xe,frob:()=>Ne,fromQuat:()=>Te,fromQuat2:()=>ge,fromRotation:()=>de,fromRotationTranslation:()=>be,fromRotationTranslationScale:()=>Me,fromRotationTranslationScaleOrigin:()=>Ee,fromScaling:()=>le,fromTranslation:()=>pe,fromValues:()=>Qt,fromXRotation:()=>ye,fromYRotation:()=>ve,fromZRotation:()=>me,frustum:()=>Pe,getRotation:()=>we,getScaling:()=>xe,getTranslation:()=>_e,identity:()=>te,invert:()=>ne,lookAt:()=>De,mul:()=>He,multiply:()=>oe,multiplyScalar:()=>ze,multiplyScalarAndAdd:()=>Ve,ortho:()=>Ae,orthoNO:()=>Ie,orthoZO:()=>je,perspective:()=>Oe,perspectiveFromFieldOfView:()=>Ce,perspectiveNO:()=>Re,perspectiveZO:()=>Se,rotate:()=>ue,rotateX:()=>ce,rotateY:()=>he,rotateZ:()=>fe,scale:()=>se,set:()=>Jt,str:()=>Le,sub:()=>Ge,subtract:()=>Ue,targetTo:()=>Fe,translate:()=>ae,transpose:()=>ee});var u={};n.r(u),n.d(u,{add:()=>Qe,angle:()=>On,bezier:()=>_n,ceil:()=>nn,clone:()=>qe,copy:()=>Ke,create:()=>ke,cross:()=>mn,dist:()=>Nn,distance:()=>hn,div:()=>Ln,divide:()=>en,dot:()=>vn,equals:()=>An,exactEquals:()=>In,floor:()=>rn,forEach:()=>Vn,fromValues:()=>Ze,hermite:()=>gn,inverse:()=>dn,len:()=>Un,length:()=>We,lerp:()=>bn,max:()=>an,min:()=>on,mul:()=>Fn,multiply:()=>tn,negate:()=>ln,normalize:()=>yn,random:()=>xn,rotateX:()=>Tn,rotateY:()=>Pn,rotateZ:()=>Rn,round:()=>sn,scale:()=>un,scaleAndAdd:()=>cn,set:()=>$e,sqrDist:()=>Bn,sqrLen:()=>zn,squaredDistance:()=>fn,squaredLength:()=>pn,str:()=>Cn,sub:()=>Dn,subtract:()=>Je,transformMat3:()=>Mn,transformMat4:()=>wn,transformQuat:()=>En,zero:()=>Sn});var c={};n.r(c),n.d(c,{add:()=>qn,ceil:()=>$n,clone:()=>Yn,copy:()=>Gn,create:()=>Xn,cross:()=>pr,dist:()=>Er,distance:()=>ir,div:()=>Mr,divide:()=>Kn,dot:()=>fr,equals:()=>_r,exactEquals:()=>gr,floor:()=>Qn,forEach:()=>Or,fromValues:()=>Hn,inverse:()=>cr,len:()=>Pr,length:()=>ar,lerp:()=>lr,max:()=>tr,min:()=>Jn,mul:()=>wr,multiply:()=>Zn,negate:()=>ur,normalize:()=>hr,random:()=>dr,round:()=>er,scale:()=>nr,scaleAndAdd:()=>rr,set:()=>kn,sqrDist:()=>Tr,sqrLen:()=>Rr,squaredDistance:()=>or,squaredLength:()=>sr,str:()=>br,sub:()=>xr,subtract:()=>Wn,transformMat4:()=>yr,transformQuat:()=>vr,zero:()=>mr});var h={};n.r(h),n.d(h,{add:()=>oi,calculateW:()=>Br,clone:()=>ei,conjugate:()=>Gr,copy:()=>ri,create:()=>Sr,dot:()=>ui,equals:()=>vi,exactEquals:()=>yi,exp:()=>Ur,fromEuler:()=>qr,fromMat3:()=>kr,fromValues:()=>ni,getAngle:()=>jr,getAxisAngle:()=>Ar,identity:()=>Cr,invert:()=>Hr,len:()=>fi,length:()=>hi,lerp:()=>ci,ln:()=>zr,mul:()=>ai,multiply:()=>Dr,normalize:()=>di,pow:()=>Vr,random:()=>Yr,rotateX:()=>Fr,rotateY:()=>Lr,rotateZ:()=>Nr,rotationTo:()=>mi,scale:()=>si,set:()=>ii,setAxes:()=>gi,setAxisAngle:()=>Ir,slerp:()=>Xr,sqlerp:()=>bi,sqrLen:()=>li,squaredLength:()=>pi,str:()=>Wr});var f={};n.r(f),n.d(f,{add:()=>Yi,clone:()=>xi,conjugate:()=>Ki,copy:()=>Oi,create:()=>_i,dot:()=>qi,equals:()=>io,exactEquals:()=>ro,fromMat4:()=>Ri,fromRotation:()=>Pi,fromRotationTranslation:()=>Ei,fromRotationTranslationValues:()=>Mi,fromTranslation:()=>Ti,fromValues:()=>wi,getDual:()=>Ai,getReal:()=>Ii,getTranslation:()=>Fi,identity:()=>Si,invert:()=>Zi,len:()=>Qi,length:()=>$i,lerp:()=>Wi,mul:()=>Gi,multiply:()=>Hi,normalize:()=>eo,rotateAroundAxis:()=>Xi,rotateByQuatAppend:()=>zi,rotateByQuatPrepend:()=>Vi,rotateX:()=>Ni,rotateY:()=>Bi,rotateZ:()=>Ui,scale:()=>ki,set:()=>Ci,setDual:()=>Di,setReal:()=>ji,sqrLen:()=>to,squaredLength:()=>Ji,str:()=>no,translate:()=>Li});var p={};n.r(p),n.d(p,{add:()=>ho,angle:()=>Bo,ceil:()=>yo,clone:()=>ao,copy:()=>uo,create:()=>oo,cross:()=>Co,dist:()=>qo,distance:()=>wo,div:()=>ko,divide:()=>lo,dot:()=>So,equals:()=>Xo,exactEquals:()=>Vo,floor:()=>vo,forEach:()=>Ko,fromValues:()=>so,inverse:()=>Ro,len:()=>Yo,length:()=>Eo,lerp:()=>Io,max:()=>bo,min:()=>mo,mul:()=>Go,multiply:()=>po,negate:()=>Po,normalize:()=>Oo,random:()=>Ao,rotate:()=>No,round:()=>go,scale:()=>_o,scaleAndAdd:()=>xo,set:()=>co,sqrDist:()=>Wo,sqrLen:()=>Zo,squaredDistance:()=>Mo,squaredLength:()=>To,str:()=>zo,sub:()=>Ho,subtract:()=>fo,transformMat2:()=>jo,transformMat2d:()=>Do,transformMat3:()=>Fo,transformMat4:()=>Lo,zero:()=>Uo});var l=1e-6,d="undefined"!=typeof Float32Array?Float32Array:Array,y=Math.random;function v(t){d=t}var m=Math.PI/180;function b(t){return t*m}function g(t,e){return Math.abs(t-e)<=l*Math.max(1,Math.abs(t),Math.abs(e))}function _(){var t=new d(4);return d!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function x(t){var e=new d(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function w(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function M(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function E(t,e,n,r){var i=new d(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function T(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function P(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function R(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*o-i*r;return a?(a=1/a,t[0]=o*a,t[1]=-r*a,t[2]=-i*a,t[3]=n*a,t):null}function O(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function S(t){return t[0]*t[3]-t[2]*t[1]}function C(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*s+o*u,t[1]=i*s+a*u,t[2]=r*c+o*h,t[3]=i*c+a*h,t}function I(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t}function A(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1];return t[0]=r*s,t[1]=i*s,t[2]=o*u,t[3]=a*u,t}function j(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function D(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function F(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function L(t){return Math.hypot(t[0],t[1],t[2],t[3])}function N(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function B(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function U(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function z(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function V(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=l*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=l*Math.max(1,Math.abs(o),Math.abs(c))}function X(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Y(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var H=C,G=U;function k(){var t=new d(6);return d!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function q(t){var e=new d(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function W(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Z(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function K(t,e,n,r,i,o){var a=new d(6);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a[4]=i,a[5]=o,a}function $(t,e,n,r,i,o,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t}function Q(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=n*o-r*i;return u?(u=1/u,t[0]=o*u,t[1]=-r*u,t[2]=-i*u,t[3]=n*u,t[4]=(i*s-o*a)*u,t[5]=(r*a-n*s)*u,t):null}function J(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=n[0],h=n[1],f=n[2],p=n[3],l=n[4],d=n[5];return t[0]=r*c+o*h,t[1]=i*c+a*h,t[2]=r*f+o*p,t[3]=i*f+a*p,t[4]=r*l+o*d+s,t[5]=i*l+a*d+u,t}function et(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=Math.sin(n),h=Math.cos(n);return t[0]=r*h+o*c,t[1]=i*h+a*c,t[2]=r*-c+o*h,t[3]=i*-c+a*h,t[4]=s,t[5]=u,t}function nt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r*c,t[1]=i*c,t[2]=o*h,t[3]=a*h,t[4]=s,t[5]=u,t}function rt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*c+o*h+s,t[5]=i*c+a*h+u,t}function it(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function ot(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function at(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ct(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function ht(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function ft(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function pt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function lt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function dt(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=e[0],c=e[1],h=e[2],f=e[3],p=e[4],d=e[5];return Math.abs(n-u)<=l*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=l*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-h)<=l*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=l*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-p)<=l*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-d)<=l*Math.max(1,Math.abs(s),Math.abs(d))}var yt=tt,vt=ht;function mt(){var t=new d(9);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function gt(t){var e=new d(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function _t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function xt(t,e,n,r,i,o,a,s,u){var c=new d(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=i,c[5]=o,c[6]=a,c[7]=s,c[8]=u,c}function wt(t,e,n,r,i,o,a,s,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t}function Mt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Et(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Tt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=h*a-s*c,p=-h*o+s*u,l=c*o-a*u,d=n*f+r*p+i*l;return d?(d=1/d,t[0]=f*d,t[1]=(-h*r+i*c)*d,t[2]=(s*r-i*a)*d,t[3]=p*d,t[4]=(h*n-i*u)*d,t[5]=(-s*n+i*o)*d,t[6]=l*d,t[7]=(-c*n+r*u)*d,t[8]=(a*n-r*o)*d,t):null}function Pt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8];return t[0]=a*h-s*c,t[1]=i*c-r*h,t[2]=r*s-i*a,t[3]=s*u-o*h,t[4]=n*h-i*u,t[5]=i*o-n*s,t[6]=o*c-a*u,t[7]=r*u-n*c,t[8]=n*a-r*o,t}function Rt(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*o-a*u)+n*(-c*i+a*s)+r*(u*i-o*s)}function Ot(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],p=n[0],l=n[1],d=n[2],y=n[3],v=n[4],m=n[5],b=n[6],g=n[7],_=n[8];return t[0]=p*r+l*a+d*c,t[1]=p*i+l*s+d*h,t[2]=p*o+l*u+d*f,t[3]=y*r+v*a+m*c,t[4]=y*i+v*s+m*h,t[5]=y*o+v*u+m*f,t[6]=b*r+g*a+_*c,t[7]=b*i+g*s+_*h,t[8]=b*o+g*u+_*f,t}function St(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],p=n[0],l=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=p*r+l*a+c,t[7]=p*i+l*s+h,t[8]=p*o+l*u+f,t}function Ct(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],p=Math.sin(n),l=Math.cos(n);return t[0]=l*r+p*a,t[1]=l*i+p*s,t[2]=l*o+p*u,t[3]=l*a-p*r,t[4]=l*s-p*i,t[5]=l*u-p*o,t[6]=c,t[7]=h,t[8]=f,t}function It(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function At(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function jt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Dt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ft(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Lt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,h=r*a,f=r*s,p=i*a,l=i*s,d=i*u,y=o*a,v=o*s,m=o*u;return t[0]=1-f-d,t[3]=h-m,t[6]=p+v,t[1]=h+m,t[4]=1-c-d,t[7]=l-y,t[2]=p-v,t[5]=l+y,t[8]=1-c-f,t}function Nt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],p=e[10],l=e[11],d=e[12],y=e[13],v=e[14],m=e[15],b=n*s-r*a,g=n*u-i*a,_=n*c-o*a,x=r*u-i*s,w=r*c-o*s,M=i*c-o*u,E=h*y-f*d,T=h*v-p*d,P=h*m-l*d,R=f*v-p*y,O=f*m-l*y,S=p*m-l*v,C=b*S-g*O+_*R+x*P-w*T+M*E;return C?(C=1/C,t[0]=(s*S-u*O+c*R)*C,t[1]=(u*P-a*S-c*T)*C,t[2]=(a*O-s*P+c*E)*C,t[3]=(i*O-r*S-o*R)*C,t[4]=(n*S-i*P+o*T)*C,t[5]=(r*P-n*O-o*E)*C,t[6]=(y*M-v*w+m*x)*C,t[7]=(v*_-d*M-m*g)*C,t[8]=(d*w-y*_+m*b)*C,t):null}function Bt(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ut(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function zt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Vt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function Xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Yt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Ht(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Gt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function kt(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=e[0],p=e[1],d=e[2],y=e[3],v=e[4],m=e[5],b=e[6],g=e[7],_=e[8];return Math.abs(n-f)<=l*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-p)<=l*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-d)<=l*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-y)<=l*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=l*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-m)<=l*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-b)<=l*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(c-g)<=l*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(h-_)<=l*Math.max(1,Math.abs(h),Math.abs(_))}var qt=Ot,Wt=Xt;function Zt(){var t=new d(16);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Kt(t){var e=new d(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function $t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qt(t,e,n,r,i,o,a,s,u,c,h,f,p,l,y,v){var m=new d(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=c,m[10]=h,m[11]=f,m[12]=p,m[13]=l,m[14]=y,m[15]=v,m}function Jt(t,e,n,r,i,o,a,s,u,c,h,f,p,l,d,y,v){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=h,t[10]=f,t[11]=p,t[12]=l,t[13]=d,t[14]=y,t[15]=v,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ne(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],p=e[10],l=e[11],d=e[12],y=e[13],v=e[14],m=e[15],b=n*s-r*a,g=n*u-i*a,_=n*c-o*a,x=r*u-i*s,w=r*c-o*s,M=i*c-o*u,E=h*y-f*d,T=h*v-p*d,P=h*m-l*d,R=f*v-p*y,O=f*m-l*y,S=p*m-l*v,C=b*S-g*O+_*R+x*P-w*T+M*E;return C?(C=1/C,t[0]=(s*S-u*O+c*R)*C,t[1]=(i*O-r*S-o*R)*C,t[2]=(y*M-v*w+m*x)*C,t[3]=(p*w-f*M-l*x)*C,t[4]=(u*P-a*S-c*T)*C,t[5]=(n*S-i*P+o*T)*C,t[6]=(v*_-d*M-m*g)*C,t[7]=(h*M-p*_+l*g)*C,t[8]=(a*O-s*P+c*E)*C,t[9]=(r*P-n*O-o*E)*C,t[10]=(d*w-y*_+m*b)*C,t[11]=(f*_-h*w-l*b)*C,t[12]=(s*T-a*R-u*E)*C,t[13]=(n*R-r*T+i*E)*C,t[14]=(y*g-d*x-v*b)*C,t[15]=(h*x-f*g+p*b)*C,t):null}function re(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],p=e[10],l=e[11],d=e[12],y=e[13],v=e[14],m=e[15];return t[0]=s*(p*m-l*v)-f*(u*m-c*v)+y*(u*l-c*p),t[1]=-(r*(p*m-l*v)-f*(i*m-o*v)+y*(i*l-o*p)),t[2]=r*(u*m-c*v)-s*(i*m-o*v)+y*(i*c-o*u),t[3]=-(r*(u*l-c*p)-s*(i*l-o*p)+f*(i*c-o*u)),t[4]=-(a*(p*m-l*v)-h*(u*m-c*v)+d*(u*l-c*p)),t[5]=n*(p*m-l*v)-h*(i*m-o*v)+d*(i*l-o*p),t[6]=-(n*(u*m-c*v)-a*(i*m-o*v)+d*(i*c-o*u)),t[7]=n*(u*l-c*p)-a*(i*l-o*p)+h*(i*c-o*u),t[8]=a*(f*m-l*y)-h*(s*m-c*y)+d*(s*l-c*f),t[9]=-(n*(f*m-l*y)-h*(r*m-o*y)+d*(r*l-o*f)),t[10]=n*(s*m-c*y)-a*(r*m-o*y)+d*(r*c-o*s),t[11]=-(n*(s*l-c*f)-a*(r*l-o*f)+h*(r*c-o*s)),t[12]=-(a*(f*v-p*y)-h*(s*v-u*y)+d*(s*p-u*f)),t[13]=n*(f*v-p*y)-h*(r*v-i*y)+d*(r*p-i*f),t[14]=-(n*(s*v-u*y)-a*(r*v-i*y)+d*(r*u-i*s)),t[15]=n*(s*p-u*f)-a*(r*p-i*f)+h*(r*u-i*s),t}function ie(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],h=t[9],f=t[10],p=t[11],l=t[12],d=t[13],y=t[14],v=t[15];return(e*a-n*o)*(f*v-p*y)-(e*s-r*o)*(h*v-p*d)+(e*u-i*o)*(h*y-f*d)+(n*s-r*a)*(c*v-p*l)-(n*u-i*a)*(c*y-f*l)+(r*u-i*s)*(c*d-h*l)}function oe(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],p=e[9],l=e[10],d=e[11],y=e[12],v=e[13],m=e[14],b=e[15],g=n[0],_=n[1],x=n[2],w=n[3];return t[0]=g*r+_*s+x*f+w*y,t[1]=g*i+_*u+x*p+w*v,t[2]=g*o+_*c+x*l+w*m,t[3]=g*a+_*h+x*d+w*b,g=n[4],_=n[5],x=n[6],w=n[7],t[4]=g*r+_*s+x*f+w*y,t[5]=g*i+_*u+x*p+w*v,t[6]=g*o+_*c+x*l+w*m,t[7]=g*a+_*h+x*d+w*b,g=n[8],_=n[9],x=n[10],w=n[11],t[8]=g*r+_*s+x*f+w*y,t[9]=g*i+_*u+x*p+w*v,t[10]=g*o+_*c+x*l+w*m,t[11]=g*a+_*h+x*d+w*b,g=n[12],_=n[13],x=n[14],w=n[15],t[12]=g*r+_*s+x*f+w*y,t[13]=g*i+_*u+x*p+w*v,t[14]=g*o+_*c+x*l+w*m,t[15]=g*a+_*h+x*d+w*b,t}function ae(t,e,n){var r,i,o,a,s,u,c,h,f,p,l,d,y=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*y+e[4]*v+e[8]*m+e[12],t[13]=e[1]*y+e[5]*v+e[9]*m+e[13],t[14]=e[2]*y+e[6]*v+e[10]*m+e[14],t[15]=e[3]*y+e[7]*v+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],p=e[9],l=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=f,t[9]=p,t[10]=l,t[11]=d,t[12]=r*y+s*v+f*m+e[12],t[13]=i*y+u*v+p*m+e[13],t[14]=o*y+c*v+l*m+e[14],t[15]=a*y+h*v+d*m+e[15]),t}function se(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ue(t,e,n,r){var i,o,a,s,u,c,h,f,p,d,y,v,m,b,g,_,x,w,M,E,T,P,R,O,S=r[0],C=r[1],I=r[2],A=Math.hypot(S,C,I);return A<l?null:(S*=A=1/A,C*=A,I*=A,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],c=e[2],h=e[3],f=e[4],p=e[5],d=e[6],y=e[7],v=e[8],m=e[9],b=e[10],g=e[11],_=S*S*a+o,x=C*S*a+I*i,w=I*S*a-C*i,M=S*C*a-I*i,E=C*C*a+o,T=I*C*a+S*i,P=S*I*a+C*i,R=C*I*a-S*i,O=I*I*a+o,t[0]=s*_+f*x+v*w,t[1]=u*_+p*x+m*w,t[2]=c*_+d*x+b*w,t[3]=h*_+y*x+g*w,t[4]=s*M+f*E+v*T,t[5]=u*M+p*E+m*T,t[6]=c*M+d*E+b*T,t[7]=h*M+y*E+g*T,t[8]=s*P+f*R+v*O,t[9]=u*P+p*R+m*O,t[10]=c*P+d*R+b*O,t[11]=h*P+y*R+g*O,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ce(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],h=e[9],f=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+h*r,t[6]=s*i+f*r,t[7]=u*i+p*r,t[8]=c*i-o*r,t[9]=h*i-a*r,t[10]=f*i-s*r,t[11]=p*i-u*r,t}function he(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],h=e[9],f=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-h*r,t[2]=s*i-f*r,t[3]=u*i-p*r,t[8]=o*r+c*i,t[9]=a*r+h*i,t[10]=s*r+f*i,t[11]=u*r+p*i,t}function fe(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],h=e[5],f=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+h*r,t[2]=s*i+f*r,t[3]=u*i+p*r,t[4]=c*i-o*r,t[5]=h*i-a*r,t[6]=f*i-s*r,t[7]=p*i-u*r,t}function pe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function le(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function de(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<l?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ye(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ve(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function me(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function be(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,c=o+o,h=r*s,f=r*u,p=r*c,l=i*u,d=i*c,y=o*c,v=a*s,m=a*u,b=a*c;return t[0]=1-(l+y),t[1]=f+b,t[2]=p-m,t[3]=0,t[4]=f-b,t[5]=1-(h+y),t[6]=d+v,t[7]=0,t[8]=p+m,t[9]=d-v,t[10]=1-(h+l),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ge(t,e){var n=new d(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=r*r+i*i+o*o+a*a;return f>0?(n[0]=2*(s*a+h*r+u*o-c*i)/f,n[1]=2*(u*a+h*i+c*r-s*o)/f,n[2]=2*(c*a+h*o+s*i-u*r)/f):(n[0]=2*(s*a+h*r+u*o-c*i),n[1]=2*(u*a+h*i+c*r-s*o),n[2]=2*(c*a+h*o+s*i-u*r)),be(t,e,n),t}function _e(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function xe(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,c,h),t}function we(t,e){var n=new d(3);xe(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,c=e[4]*r,h=e[5]*i,f=e[6]*o,p=e[8]*r,l=e[9]*i,y=e[10]*o,v=a+h+y,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(f-l)/m,t[1]=(p-u)/m,t[2]=(s-c)/m):a>h&&a>y?(m=2*Math.sqrt(1+a-h-y),t[3]=(f-l)/m,t[0]=.25*m,t[1]=(s+c)/m,t[2]=(p+u)/m):h>y?(m=2*Math.sqrt(1+h-a-y),t[3]=(p-u)/m,t[0]=(s+c)/m,t[1]=.25*m,t[2]=(f+l)/m):(m=2*Math.sqrt(1+y-a-h),t[3]=(s-c)/m,t[0]=(p+u)/m,t[1]=(f+l)/m,t[2]=.25*m),t}function Me(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,c=o+o,h=a+a,f=i*u,p=i*c,l=i*h,d=o*c,y=o*h,v=a*h,m=s*u,b=s*c,g=s*h,_=r[0],x=r[1],w=r[2];return t[0]=(1-(d+v))*_,t[1]=(p+g)*_,t[2]=(l-b)*_,t[3]=0,t[4]=(p-g)*x,t[5]=(1-(f+v))*x,t[6]=(y+m)*x,t[7]=0,t[8]=(l+b)*w,t[9]=(y-m)*w,t[10]=(1-(f+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ee(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],c=o+o,h=a+a,f=s+s,p=o*c,l=o*h,d=o*f,y=a*h,v=a*f,m=s*f,b=u*c,g=u*h,_=u*f,x=r[0],w=r[1],M=r[2],E=i[0],T=i[1],P=i[2],R=(1-(y+m))*x,O=(l+_)*x,S=(d-g)*x,C=(l-_)*w,I=(1-(p+m))*w,A=(v+b)*w,j=(d+g)*M,D=(v-b)*M,F=(1-(p+y))*M;return t[0]=R,t[1]=O,t[2]=S,t[3]=0,t[4]=C,t[5]=I,t[6]=A,t[7]=0,t[8]=j,t[9]=D,t[10]=F,t[11]=0,t[12]=n[0]+E-(R*E+C*T+j*P),t[13]=n[1]+T-(O*E+I*T+D*P),t[14]=n[2]+P-(S*E+A*T+F*P),t[15]=1,t}function Te(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,h=r*a,f=r*s,p=i*a,l=i*s,d=i*u,y=o*a,v=o*s,m=o*u;return t[0]=1-f-d,t[1]=h+m,t[2]=p-v,t[3]=0,t[4]=h-m,t[5]=1-c-d,t[6]=l+y,t[7]=0,t[8]=p+v,t[9]=l-y,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pe(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function Re(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Oe=Re;function Se(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function Ce(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Ie(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1,t}var Ae=Ie;function je(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*c,t[15]=1,t}function De(t,e,n,r){var i,o,a,s,u,c,h,f,p,d,y=e[0],v=e[1],m=e[2],b=r[0],g=r[1],_=r[2],x=n[0],w=n[1],M=n[2];return Math.abs(y-x)<l&&Math.abs(v-w)<l&&Math.abs(m-M)<l?te(t):(h=y-x,f=v-w,p=m-M,i=g*(p*=d=1/Math.hypot(h,f,p))-_*(f*=d),o=_*(h*=d)-b*p,a=b*f-g*h,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=f*a-p*o,u=p*i-h*a,c=h*o-f*i,(d=Math.hypot(s,u,c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=a,t[9]=c,t[10]=p,t[11]=0,t[12]=-(i*y+o*v+a*m),t[13]=-(s*y+u*v+c*m),t[14]=-(h*y+f*v+p*m),t[15]=1,t)}function Fe(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],c=r[2],h=i-n[0],f=o-n[1],p=a-n[2],l=h*h+f*f+p*p;l>0&&(h*=l=1/Math.sqrt(l),f*=l,p*=l);var d=u*p-c*f,y=c*h-s*p,v=s*f-u*h;return(l=d*d+y*y+v*v)>0&&(d*=l=1/Math.sqrt(l),y*=l,v*=l),t[0]=d,t[1]=y,t[2]=v,t[3]=0,t[4]=f*v-p*y,t[5]=p*d-h*v,t[6]=h*y-f*d,t[7]=0,t[8]=h,t[9]=f,t[10]=p,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function Le(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ne(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Be(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Ue(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function ze(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Ve(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Xe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Ye(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],y=t[12],v=t[13],m=t[14],b=t[15],g=e[0],_=e[1],x=e[2],w=e[3],M=e[4],E=e[5],T=e[6],P=e[7],R=e[8],O=e[9],S=e[10],C=e[11],I=e[12],A=e[13],j=e[14],D=e[15];return Math.abs(n-g)<=l*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-_)<=l*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=l*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-w)<=l*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-M)<=l*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-E)<=l*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-T)<=l*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-P)<=l*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(h-R)<=l*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(f-O)<=l*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(p-S)<=l*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(d-C)<=l*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(y-I)<=l*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(v-A)<=l*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(m-j)<=l*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(b-D)<=l*Math.max(1,Math.abs(b),Math.abs(D))}var He=oe,Ge=Ue;function ke(){var t=new d(3);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function qe(t){var e=new d(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function We(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ze(t,e,n){var r=new d(3);return r[0]=t,r[1]=e,r[2]=n,r}function Ke(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $e(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Qe(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Je(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function tn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function en(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function nn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function rn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function on(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function an(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function sn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function un(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function cn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function hn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function fn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function pn(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function ln(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function dn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function yn(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function vn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mn(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function bn(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function gn(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),h=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*c+i[0]*h,t[1]=e[1]*s+n[1]*u+r[1]*c+i[1]*h,t[2]=e[2]*s+n[2]*u+r[2]*c+i[2]*h,t}function _n(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,h=3*o*s,f=3*u*a,p=u*o;return t[0]=e[0]*c+n[0]*h+r[0]*f+i[0]*p,t[1]=e[1]*c+n[1]*h+r[1]*f+i[1]*p,t[2]=e[2]*c+n[2]*h+r[2]*f+i[2]*p,t}function xn(t,e){e=e||1;var n=2*y()*Math.PI,r=2*y()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function wn(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function Mn(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function En(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],h=i*c-o*u,f=o*s-r*c,p=r*u-i*s,l=i*p-o*f,d=o*h-r*p,y=r*f-i*h,v=2*a;return h*=v,f*=v,p*=v,l*=2,d*=2,y*=2,t[0]=s+h+l,t[1]=u+f+d,t[2]=c+p+y,t}function Tn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Pn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Rn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function On(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&vn(t,e)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function Sn(t){return t[0]=0,t[1]=0,t[2]=0,t}function Cn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function In(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function An(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=l*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=l*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=l*Math.max(1,Math.abs(i),Math.abs(s))}var jn,Dn=Je,Fn=tn,Ln=en,Nn=hn,Bn=fn,Un=We,zn=pn,Vn=(jn=ke(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)jn[0]=t[a],jn[1]=t[a+1],jn[2]=t[a+2],i(jn,jn,o),t[a]=jn[0],t[a+1]=jn[1],t[a+2]=jn[2];return t});function Xn(){var t=new d(4);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Yn(t){var e=new d(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Hn(t,e,n,r){var i=new d(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Gn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function kn(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function qn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Wn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Zn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Kn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function $n(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Qn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Jn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function tr(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function er(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function nr(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function rr(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function ir(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function or(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function ar(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function sr(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function ur(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function hr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t}function fr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function pr(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],h=e[0],f=e[1],p=e[2],l=e[3];return t[0]=f*c-p*u+l*s,t[1]=-h*c+p*a-l*o,t[2]=h*u-f*a+l*i,t[3]=-h*s+f*o-p*i,t}function lr(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function dr(t,e){var n,r,i,o,a,s;e=e||1;do{a=(n=2*y()-1)*n+(r=2*y()-1)*r}while(a>=1);do{s=(i=2*y()-1)*i+(o=2*y()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t}function yr(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function vr(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],c=n[3],h=c*r+s*o-u*i,f=c*i+u*r-a*o,p=c*o+a*i-s*r,l=-a*r-s*i-u*o;return t[0]=h*c+l*-a+f*-u-p*-s,t[1]=f*c+l*-s+p*-a-h*-u,t[2]=p*c+l*-u+h*-s-f*-a,t[3]=e[3],t}function mr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function br(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function gr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _r(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=l*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=l*Math.max(1,Math.abs(o),Math.abs(c))}var xr=Wn,wr=Zn,Mr=Kn,Er=ir,Tr=or,Pr=ar,Rr=sr,Or=function(){var t=Xn();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function Sr(){var t=new d(4);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Cr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ir(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Ar(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>l?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function jr(t,e){var n=ui(t,e);return Math.acos(2*n*n-1)}function Dr(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+a*s+i*c-o*u,t[1]=i*h+a*u+o*s-r*c,t[2]=o*h+a*c+r*u-i*s,t[3]=a*h-r*s-i*u-o*c,t}function Fr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t}function Lr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t}function Nr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t}function Br(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Ur(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=Math.exp(o),u=a>0?s*Math.sin(a)/a:0;return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=s*Math.cos(a),t}function zr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=a>0?Math.atan2(a,o)/a:0;return t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(n*n+r*r+i*i+o*o),t}function Vr(t,e,n){return zr(t,e),si(t,t,n),Ur(t,t),t}function Xr(t,e,n,r){var i,o,a,s,u,c=e[0],h=e[1],f=e[2],p=e[3],d=n[0],y=n[1],v=n[2],m=n[3];return(o=c*d+h*y+f*v+p*m)<0&&(o=-o,d=-d,y=-y,v=-v,m=-m),1-o>l?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*c+u*d,t[1]=s*h+u*y,t[2]=s*f+u*v,t[3]=s*p+u*m,t}function Yr(t){var e=y(),n=y(),r=y(),i=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Hr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}function Gr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function kr(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}function qr(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),h=Math.cos(r);return t[0]=o*u*h-a*s*c,t[1]=a*s*h+o*u*c,t[2]=a*u*c-o*s*h,t[3]=a*u*h+o*s*c,t}function Wr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Zr,Kr,$r,Qr,Jr,ti,ei=Yn,ni=Hn,ri=Gn,ii=kn,oi=qn,ai=Dr,si=nr,ui=fr,ci=lr,hi=ar,fi=hi,pi=sr,li=pi,di=hr,yi=gr,vi=_r,mi=(Zr=ke(),Kr=Ze(1,0,0),$r=Ze(0,1,0),function(t,e,n){var r=vn(e,n);return r<-.999999?(mn(Zr,Kr,e),Un(Zr)<1e-6&&mn(Zr,$r,e),yn(Zr,Zr),Ir(t,Zr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(mn(Zr,e,n),t[0]=Zr[0],t[1]=Zr[1],t[2]=Zr[2],t[3]=1+r,di(t,t))}),bi=(Qr=Sr(),Jr=Sr(),function(t,e,n,r,i,o){return Xr(Qr,e,i,o),Xr(Jr,n,r,o),Xr(t,Qr,Jr,2*o*(1-o)),t}),gi=(ti=mt(),function(t,e,n,r){return ti[0]=n[0],ti[3]=n[1],ti[6]=n[2],ti[1]=r[0],ti[4]=r[1],ti[7]=r[2],ti[2]=-e[0],ti[5]=-e[1],ti[8]=-e[2],di(t,kr(t,ti))});function _i(){var t=new d(8);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function xi(t){var e=new d(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function wi(t,e,n,r,i,o,a,s){var u=new d(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=i,u[5]=o,u[6]=a,u[7]=s,u}function Mi(t,e,n,r,i,o,a){var s=new d(8);s[0]=t,s[1]=e,s[2]=n,s[3]=r;var u=.5*i,c=.5*o,h=.5*a;return s[4]=u*r+c*n-h*e,s[5]=c*r+h*t-u*n,s[6]=h*r+u*e-c*t,s[7]=-u*t-c*e-h*n,s}function Ei(t,e,n){var r=.5*n[0],i=.5*n[1],o=.5*n[2],a=e[0],s=e[1],u=e[2],c=e[3];return t[0]=a,t[1]=s,t[2]=u,t[3]=c,t[4]=r*c+i*u-o*s,t[5]=i*c+o*a-r*u,t[6]=o*c+r*s-i*a,t[7]=-r*a-i*s-o*u,t}function Ti(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function Pi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ri(t,e){var n=Sr();we(n,e);var r=new d(3);return _e(r,e),Ei(t,n,r),t}function Oi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Si(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ci(t,e,n,r,i,o,a,s,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t}var Ii=ri;function Ai(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var ji=ri;function Di(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Fi(t,e){var n=e[4],r=e[5],i=e[6],o=e[7],a=-e[0],s=-e[1],u=-e[2],c=e[3];return t[0]=2*(n*c+o*a+r*u-i*s),t[1]=2*(r*c+o*s+i*a-n*u),t[2]=2*(i*c+o*u+n*s-r*a),t}function Li(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=.5*n[0],u=.5*n[1],c=.5*n[2],h=e[4],f=e[5],p=e[6],l=e[7];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=a*s+i*c-o*u+h,t[5]=a*u+o*s-r*c+f,t[6]=a*c+r*u-i*s+p,t[7]=-r*s-i*u-o*c+l,t}function Ni(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*a+h*r+u*o-c*i,p=u*a+h*i+c*r-s*o,l=c*a+h*o+s*i-u*r,d=h*a-s*r-u*i-c*o;return Fr(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+d*r+p*o-l*i,t[5]=p*a+d*i+l*r-f*o,t[6]=l*a+d*o+f*i-p*r,t[7]=d*a-f*r-p*i-l*o,t}function Bi(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*a+h*r+u*o-c*i,p=u*a+h*i+c*r-s*o,l=c*a+h*o+s*i-u*r,d=h*a-s*r-u*i-c*o;return Lr(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+d*r+p*o-l*i,t[5]=p*a+d*i+l*r-f*o,t[6]=l*a+d*o+f*i-p*r,t[7]=d*a-f*r-p*i-l*o,t}function Ui(t,e,n){var r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*a+h*r+u*o-c*i,p=u*a+h*i+c*r-s*o,l=c*a+h*o+s*i-u*r,d=h*a-s*r-u*i-c*o;return Nr(t,e,n),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+d*r+p*o-l*i,t[5]=p*a+d*i+l*r-f*o,t[6]=l*a+d*o+f*i-p*r,t[7]=d*a-f*r-p*i-l*o,t}function zi(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=s*a+h*r+u*o-c*i,t[1]=u*a+h*i+c*r-s*o,t[2]=c*a+h*o+s*i-u*r,t[3]=h*a-s*r-u*i-c*o,s=e[4],u=e[5],c=e[6],h=e[7],t[4]=s*a+h*r+u*o-c*i,t[5]=u*a+h*i+c*r-s*o,t[6]=c*a+h*o+s*i-u*r,t[7]=h*a-s*r-u*i-c*o,t}function Vi(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+a*s+i*c-o*u,t[1]=i*h+a*u+o*s-r*c,t[2]=o*h+a*c+r*u-i*s,t[3]=a*h-r*s-i*u-o*c,s=n[4],u=n[5],c=n[6],h=n[7],t[4]=r*h+a*s+i*c-o*u,t[5]=i*h+a*u+o*s-r*c,t[6]=o*h+a*c+r*u-i*s,t[7]=a*h-r*s-i*u-o*c,t}function Xi(t,e,n,r){if(Math.abs(r)<l)return Oi(t,e);var i=Math.hypot(n[0],n[1],n[2]);r*=.5;var o=Math.sin(r),a=o*n[0]/i,s=o*n[1]/i,u=o*n[2]/i,c=Math.cos(r),h=e[0],f=e[1],p=e[2],d=e[3];t[0]=h*c+d*a+f*u-p*s,t[1]=f*c+d*s+p*a-h*u,t[2]=p*c+d*u+h*s-f*a,t[3]=d*c-h*a-f*s-p*u;var y=e[4],v=e[5],m=e[6],b=e[7];return t[4]=y*c+b*a+v*u-m*s,t[5]=v*c+b*s+m*a-y*u,t[6]=m*c+b*u+y*s-v*a,t[7]=b*c-y*a-v*s-m*u,t}function Yi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function Hi(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[4],u=n[5],c=n[6],h=n[7],f=e[4],p=e[5],l=e[6],d=e[7],y=n[0],v=n[1],m=n[2],b=n[3];return t[0]=r*b+a*y+i*m-o*v,t[1]=i*b+a*v+o*y-r*m,t[2]=o*b+a*m+r*v-i*y,t[3]=a*b-r*y-i*v-o*m,t[4]=r*h+a*s+i*c-o*u+f*b+d*y+p*m-l*v,t[5]=i*h+a*u+o*s-r*c+p*b+d*v+l*y-f*m,t[6]=o*h+a*c+r*u-i*s+l*b+d*m+f*v-p*y,t[7]=a*h-r*s-i*u-o*c+d*b-f*y-p*v-l*m,t}var Gi=Hi;function ki(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var qi=ui;function Wi(t,e,n,r){var i=1-r;return qi(e,n)<0&&(r=-r),t[0]=e[0]*i+n[0]*r,t[1]=e[1]*i+n[1]*r,t[2]=e[2]*i+n[2]*r,t[3]=e[3]*i+n[3]*r,t[4]=e[4]*i+n[4]*r,t[5]=e[5]*i+n[5]*r,t[6]=e[6]*i+n[6]*r,t[7]=e[7]*i+n[7]*r,t}function Zi(t,e){var n=Ji(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Ki(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var $i=hi,Qi=$i,Ji=pi,to=Ji;function eo(t,e){var n=Ji(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,i=e[1]/n,o=e[2]/n,a=e[3]/n,s=e[4],u=e[5],c=e[6],h=e[7],f=r*s+i*u+o*c+a*h;t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=(s-r*f)/n,t[5]=(u-i*f)/n,t[6]=(c-o*f)/n,t[7]=(h-a*f)/n}return t}function no(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function ro(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function io(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=e[0],f=e[1],p=e[2],d=e[3],y=e[4],v=e[5],m=e[6],b=e[7];return Math.abs(n-h)<=l*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-f)<=l*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-p)<=l*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=l*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-y)<=l*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-v)<=l*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-m)<=l*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(c-b)<=l*Math.max(1,Math.abs(c),Math.abs(b))}function oo(){var t=new d(2);return d!=Float32Array&&(t[0]=0,t[1]=0),t}function ao(t){var e=new d(2);return e[0]=t[0],e[1]=t[1],e}function so(t,e){var n=new d(2);return n[0]=t,n[1]=e,n}function uo(t,e){return t[0]=e[0],t[1]=e[1],t}function co(t,e,n){return t[0]=e,t[1]=n,t}function ho(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function fo(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function po(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function lo(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function yo(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function vo(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function mo(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function bo(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function go(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function _o(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function xo(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function wo(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function Mo(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Eo(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function To(t){var e=t[0],n=t[1];return e*e+n*n}function Po(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Ro(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Oo(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function So(t,e){return t[0]*e[0]+t[1]*e[1]}function Co(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function Io(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function Ao(t,e){e=e||1;var n=2*y()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function jo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function Do(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function Fo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Lo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function No(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=i*s-o*a+n[0],t[1]=i*a+o*s+n[1],t}function Bo(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),s=a&&(n*i+r*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}function Uo(t){return t[0]=0,t[1]=0,t}function zo(t){return"vec2("+t[0]+", "+t[1]+")"}function Vo(t,e){return t[0]===e[0]&&t[1]===e[1]}function Xo(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=l*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))}var Yo=Eo,Ho=fo,Go=po,ko=lo,qo=wo,Wo=Mo,Zo=To,Ko=function(){var t=oo();return function(e,n,r,i,o,a){var s,u;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}()},1792:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(8495),a=n(3207),s=n(2104),u=n(3215),c=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.textMargin=.01,o.onClickEnd=r,o.onClickStart=i,o}return i(e,t),e.prototype.setText=function(t){return this.text=t,this.textRef||(this.textRef=u.FontReference.newFont(this.position.center(),void 0,0).setText(t).setWidth(this.position.width-this.textMargin)),this},e.prototype.setFont=function(t){var e;return null===(e=this.textRef)||void 0===e||e.setFontSize(t),this},e.prototype.getText=function(){return this.text},e.prototype.render=function(e){t.prototype.render.call(this,e),this.textRef&&(this.position.x===this.textRef.pos.x&&this.position.y===this.textRef.pos.y||this.textRef.setPosition(this.position.center()),this.textRef.render(e))},e.prototype.update=function(e){this.textRef&&this.textRef.setTop(this.isTop),t.prototype.update.call(this,e)},e.prototype.event=function(t,e){var n=e.camera.camera2d.distanceEvent(t);t.eventType===o.default.UP?a.CollisionDetection.isPointInRect(this.getRect(),n)&&this.onClickEnd&&this.onClickEnd(t):t.eventType===o.default.DOWN&&a.CollisionDetection.isPointInRect(this.getRect(),n)&&this.onClickStart&&this.onClickStart(t)},e}(s.default);e.default=c},1883:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(3207),i=n(2221),o=function(){function t(){}return t.vertex=new i.VertexBuilder,t.collision=new r.CollisionDetection,t}();e.default=o},1884:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3893),a=n(6050),s=n(8108),u=n(9727),c=n(1883),h=function(t){function e(e,n){var r=t.call(this)||this;return r.vertexModel=(new a.default).fillRenderUnits(c.default.vertex.triangleXYColour(n)),r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(t){var e=new s.default;e.renderType=s.RenderType.TRIANGLE,e.shaderType=s.ShaderType.COLOUR,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).build(this,e)},e}(u.default);e.default=h},2104:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3276),a=n(39),s=function(t){function e(e,n){var r=t.call(this,e,new a.default)||this;return r.textureReference=n,r}return i(e,t),e.prototype.setLayer=function(t){this.position.z=-t},e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(e){this.vertexModel=e.newVertexModel2d(this.textureReference),t.prototype.init.call(this,e)},e}(o.default);e.default=s},2167:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5282),a=function(t){function e(e,n){var r=t.call(this,e,new o.TextureVertexModel)||this;return r.vertexUvCacheId=n,r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(e){this.vertexModel=e.newVertexModelUv3d(this.vertexUvCacheId),t.prototype.init.call(this,e)},e}(o.ModelObject3d);e.default=a},2221:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VertexBuilder=void 0;var r=n(3623),i=function(){function t(){}return t.prototype.toArray2D=function(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.push(r.vertex.x),e.push(r.vertex.y),e.push(r.vertex.z),e.push(r.texture.u),e.push(r.texture.v)}return e},t.prototype.toTextureArray=function(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.push(r.vertex.x),e.push(r.vertex.y),e.push(r.vertex.z),e.push(r.normal.x),e.push(r.normal.y),e.push(r.normal.z),e.push(r.texture.u),e.push(r.texture.v)}return e},t.prototype.toColourArray=function(t){var e=[];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];e.push(r.vertex.x),e.push(r.vertex.y),e.push(r.vertex.z),e.push(r.colour.r),e.push(r.colour.g),e.push(r.colour.b),e.push(r.colour.a)}return e},t.prototype.triangleXYColour=function(t){var e=t.r/255,n=t.g/255,r=t.b/255,i=t.a/255;return[1,1,0,e,n,r,i,0,1,0,e,n,r,i,0,0,0,e,n,r,i]},t.prototype.planeXYColour=function(t){var e=t.r/255,n=t.g/255,r=t.b/255,i=t.a/255;return[0,0,0,e,n,r,i,1,0,0,e,n,r,i,0,1,0,e,n,r,i,1,1,0,e,n,r,i]},t.prototype.planeCCW=function(t,e,n){var r=t[0],i=t[1],o=t[2],a=t[3];return[r/e,a/n,r/e,i/n,o/e,i/n,o/e,a/n]},t.prototype.planeCW=function(t,e,n){var r=t[0],i=t[1],o=t[2],a=t[3];return[o/e,a/n,o/e,i/n,r/e,i/n,r/e,a/n]},t.prototype.planeUV=function(t,e){t[0].texture.u=e[4],t[0].texture.v=e[1],t[2].texture.u=e[4],t[2].texture.v=e[3],t[1].texture.u=e[0],t[1].texture.v=e[1],t[3].texture.u=e[0],t[3].texture.v=e[3]},t.prototype.planeXY=function(t){this.plane(t,r.default.XY)},t.prototype.plane=function(t,e){switch(e){case r.default.XY:t[0].vertex.x=0,t[0].vertex.y=0,t[0].normal.z=-1,t[1].vertex.x=0,t[1].vertex.y=1,t[1].normal.z=-1,t[2].vertex.x=1,t[2].vertex.y=0,t[2].normal.z=-1,t[3].vertex.x=1,t[3].vertex.y=1,t[3].normal.z=-1;break;case r.default.YX:t[0].vertex.x=1,t[0].vertex.y=1,t[0].normal.z=1,t[2].vertex.x=1,t[2].vertex.y=0,t[2].normal.z=1,t[1].vertex.x=0,t[1].vertex.y=1,t[1].normal.z=1,t[3].vertex.x=0,t[3].vertex.y=0,t[3].normal.z=1;break;case r.default.XZ:t[0].vertex.x=0,t[0].vertex.z=0,t[0].normal.y=1,t[1].vertex.x=0,t[1].vertex.z=1,t[1].normal.y=1,t[2].vertex.x=1,t[2].vertex.z=0,t[2].normal.y=1,t[3].vertex.x=1,t[3].vertex.z=1,t[3].normal.y=1;break;case r.default.ZX:t[0].vertex.x=1,t[0].vertex.z=1,t[0].normal.y=-1,t[2].vertex.x=1,t[2].vertex.z=0,t[2].normal.y=-1,t[1].vertex.x=0,t[1].vertex.z=1,t[1].normal.y=-1,t[3].vertex.x=0,t[3].vertex.z=0,t[3].normal.y=-1;break;case r.default.YZ:t[0].vertex.y=0,t[0].vertex.z=0,t[0].normal.x=-1,t[1].vertex.y=0,t[1].vertex.z=1,t[1].normal.x=-1,t[2].vertex.y=1,t[2].vertex.z=0,t[2].normal.x=-1,t[3].vertex.y=1,t[3].vertex.z=1,t[3].normal.x=-1;break;case r.default.ZY:t[0].vertex.y=1,t[0].vertex.z=1,t[0].normal.x=1,t[2].vertex.y=1,t[2].vertex.z=0,t[2].normal.x=1,t[1].vertex.y=0,t[1].vertex.z=1,t[1].normal.x=1,t[3].vertex.y=0,t[3].vertex.z=0,t[3].normal.x=1}},t.prototype.circleXYColour=function(t,e){for(var n=e.r/255,r=e.g/255,i=e.b/255,o=e.a/255,a=2*Math.PI/t,s=[],u=-Math.PI/2;u<Math.PI/2;u+=a){var c=Math.sin(u),h=Math.cos(u);s.push(c,h,0),s.push(n,r,i,o),s.push(c,-h,0),s.push(n,r,i,o)}return s},t}();e.VertexBuilder=i},2223:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.setEngineHelper=function(t){this.engineHelper=t},t.prototype.loadResources=function(){throw new Error("unimplemented method")},t.prototype.update=function(){throw new Error("unimplemented method")},t.prototype.render=function(){throw new Error("unimplemented method")},t.prototype.event=function(t){throw new Error("unimplemented method")},t.prototype.pause=function(){throw new Error("unimplemented method")},t.prototype.resume=function(){throw new Error("unimplemented method")},t.prototype.init=function(t){throw new Error("unimplemented method")},t.prototype.destroy=function(){throw new Error("unimplemented method")},t.prototype.reset=function(){},t}();e.default=n},2276:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(1656),a=function(t){function e(){return t.call(this)||this}return i(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this[0]},set:function(t){this[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this[1]},set:function(t){this[1]=t},enumerable:!1,configurable:!0}),e.prototype.normalise=function(){return o.vec2.normalize(e.newVector(0,0),this)},e.prototype.dot=function(t){return o.vec2.dot(this,t)},e.prototype.negate=function(){return o.vec2.negate(e.newVector(0,0),this)},e.prototype.scale=function(t){return o.vec2.scale(e.newVector(0,0),this,t)},e.prototype.subtract=function(t){return o.vec2.subtract(e.newVector(0,0),this,t)},e.prototype.add=function(t){return o.vec2.add(e.newVector(0,0),this,t)},e.newVector=function(t,n){var r=new e;return r.x=t,r.y=n,r},e}(o.vec2);e.default=a},2297:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(875),a=n(39),s=function(t){function e(e,n){var r=t.call(this,e,n)||this;if(!(n instanceof a.default)){var i="Vertex model must of be type TextureVertexModel";throw console.error(i,n),new Error(i)}if(!n.renderUnits||4!==n.renderUnits.length)throw i="Plane3d requires 4 vertexes",console.error(i,n),new Error(i);return r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e}(o.default);e.default=s},2344:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(8108),i=n(9522),o=function(){function t(t){this.ctx=t,this.program=new i.default(t)}return t.prototype.delete=function(){this.program.arrayBuffer.delete(this.ctx),this.program.delete()},t.prototype.updateBuffer=function(t,e){var n=t.getOpt();if(r.ShaderType.COLOUR===n.shaderType){var o=this.program.arrayBuffer.bufferReg[t.rendererBufferId];e&&e.length===o.verticesSize||console.error("New Buffer data does not match initial buffer data!",t,e,o.verticesSize),this.program.arrayBuffer.bufferSub(this.ctx,o.offset,o.size,e,i.default.DRAW_VERTEX_SIZE)}else console.error("Updating buffer for registered Colour Entity but with different shader type as RenderOptions",n)},t.prototype.bindBuffer=function(){this.program.arrayBuffer.bufferBind(this.ctx)},t.prototype.render=function(t,e){this.program.arrayBuffer.bind(this.ctx),this.program.bindAttributePointers(),this.program.bindProgram(),this.program.glSetViewMatrix(e.viewMatrix),this.ctx.isEnabled(this.ctx.CULL_FACE)&&this.ctx.disable(this.ctx.CULL_FACE),this.ctx.isEnabled(this.ctx.DEPTH_TEST)&&this.ctx.disable(this.ctx.DEPTH_TEST);for(var n=0;n<t.length;n++){var r=t[n],i=r[0],o=r[1];if(!i.rendererBufferId)throw new Error("Unregistered entity buffer"+i);var a=this.program.arrayBuffer.bufferReg[i.rendererBufferId];this.program.glSetModelViewMatrix(o),this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,a.offset,a.size)}this.program.arrayBuffer.unbind(this.ctx),this.program.unbindAttributePointers(),this.program.unbindProgram()},t.prototype.registerEntity=function(t,e){var n=e.length/i.default.DRAW_VERTEX_SIZE;this.program.arrayBuffer.bufferReg[this.program.arrayBuffer.bufferRegId]={offset:this.program.arrayBuffer.length(),size:n,verticesSize:e.length},this.program.arrayBuffer.push(e,n),t.rendererBufferId=this.program.arrayBuffer.bufferRegId,this.program.arrayBuffer.bufferRegId++},t.prototype.updatePerspective=function(t){this.program.bindProgram(),this.program.glSetProjectMatrix(t)},t}();e.default=o},2913:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e,n,r){this.r=t,this.g=e,this.b=n,this.a=r}},2922:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(5228),i=n(1406),o=n(1513),a=function(){function t(){}return t.bmFontResolver=function(t){return function(t){return t.registerFont(new r.default(t.data)),t}},t.bitmapResolver=function(t,e,n,r){return function(o){var a=new i.default(o.data,e,n,r),s=a.getTextureSource();for(var u in a.getMap())if(a.map.hasOwnProperty(u)){var c=a.map[u];t.addUVCache(s,u,c)}return o}},t.objResolverMultiple=function(t,e){return function(n){e.map(function(e){var r=e.textureSource,i=e.name;return t.addVertexUvCache(r,i,new o.default(n.data).vertices)})}},t.objResolver=function(t,e,n){return function(r){t.addVertexUvCache(e,n,new o.default(r.data).vertices)}},t}();e.default=a},3078:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump float;\nprecision mediump int;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying mat4 v_model;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_attenuation;\nvarying float v_light1_ambient_coefficient;\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\nvarying vec4 v_shadow_pos;\n\nuniform sampler2D texture;\nuniform sampler2D shadowMap;\nuniform float numLights;\n\nstruct Light {\n  vec3 position;\n  vec3 intensities;\n  float ambientCoefficient;\n  float attenuation;\n};\n\nfloat decodeFloat(vec4 color) {\n  const vec4 bitShift = vec4(\n    1.0 / (256.0 * 256.0 * 256.0),\n    1.0 / (256.0 * 256.0),\n    1.0 / 256.0,\n    1\n  );\n  return dot(color, bitShift);\n}\n\nfloat random(vec3 seed, int i) {\n  vec4 seed4 = vec4(seed, i);\n  float dot_product = dot(seed4, vec4(12.9898, 78.233, 45.164, 94.673));\n  return fract(sin(dot_product) * 43758.5453);\n}\n\nvec2 poisson(int index) {\n  if (index == 0)\n    return vec2(-0.94201624, -0.39906216);\n  if (index == 1)\n    return vec2(0.94558609, -0.76890725);\n  if (index == 2)\n    return vec2(-0.094184101, -0.92938870);\n  if (index == 3)\n    return vec2(0.34495938, 0.29387760);\n  if (index == 4)\n    return vec2(-0.91588581, 0.45771432);\n  if (index == 5)\n    return vec2(-0.81544232, -0.87912464);\n  if (index == 6)\n    return vec2(-0.38277543, 0.27676845);\n  if (index == 7)\n    return vec2(0.97484398, 0.75648379);\n  if (index == 8)\n    return vec2(0.44323325, -0.97511554);\n  if (index == 9)\n    return vec2(0.53742981, -0.47373420);\n  if (index == 10)\n    return vec2(-0.26496911, -0.41893023);\n  if (index == 11)\n    return vec2(0.79197514, 0.19090188);\n  if (index == 12)\n    return vec2(-0.24188840, 0.99706507);\n  if (index == 13)\n    return vec2(-0.81409955, 0.91437590);\n  if (index == 14)\n    return vec2(0.19984126, 0.78641367);\n  if (index == 15)\n    return vec2(0.14383161, -0.14100790);\n  return vec2(0, 0);\n}\n\nfloat unpackRGBAToDepth(const vec4 v) {\n  const float UnpackDownscale = 255. / 256.;\n  const vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n  const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.);\n  return dot(v, UnpackFactors);\n}\n\nvoid main(void) {\n  Light light1;\n  light1.intensities = v_light1_intensities;\n  light1.position = v_light1_pos;\n  light1.attenuation = v_light1_attenuation;\n  light1.ambientCoefficient = v_light1_ambient_coefficient;\n\n  vec4 surfaceColor = texture2D(texture, v_texture_coords);\n  vec3 diffuse = v_diffuseCoefficient * surfaceColor.rgb * light1.intensities;\n  vec3 ambient = light1.ambientCoefficient * surfaceColor.rgb * light1.intensities;\n  vec3 n = normalize(v_normal);\n  vec3 l = normalize(v_light1_pos);\n  float cosTheta = clamp(dot(n, l), 0.0, 1.0);\n\n  const float texelSize = 1.0 / 1024.0;\n\n  float amountInLight = 0.0;\n\n  vec3 fragmentDepth = v_shadow_pos.xyz / v_shadow_pos.w;\n  const float shadowAcneRemover = 0.001;\n  fragmentDepth.z -= shadowAcneRemover;\n\n  float soften = 0.0;\n  for (int x = -1; x <= 1; x++) {\n    for (int y = -1; y <= 1; y++) {\n      float texelDepth = unpackRGBAToDepth(texture2D(shadowMap, fragmentDepth.xy + vec2(x, y) * texelSize));\n      soften += 1.0;\n      if (fragmentDepth.z < texelDepth) {\n        amountInLight += 1.0;\n      }\n    }\n  }\n\n  amountInLight /= soften;\n\n  vec3 linearColor = ambient + amountInLight * v_attenuation * diffuse * cosTheta;\n  vec3 gamma = vec3(1.0 / 2.2);\n  gl_FragColor = vec4(pow(linearColor, gamma), surfaceColor.a);\n}"},3207:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Polygon=e.CollisionDetection=e.Collision=void 0;var r=n(2276),i=n(1656),o=function(){};e.Collision=o;var a=function(){function t(){}return t.getLength=function(t,e,n,r){return Math.sqrt(Math.abs((t-n)*(t-n))+Math.abs((e-r)*(e-r)))},t.isCollidingRect=function(e,n,r,i,o,a,s,u){return t.getLength(e+r/2,0,o+s/2,0)<=r/2+s/2&&t.getLength(n+i/2,0,a+u/2,0)<=i/2+u/2},t.isRectInRect=function(t,e){return!(t.x+t.width<e.x||t.y+t.height<e.y||t.x>e.x+e.width||t.y>e.y+e.height)},t.isPointInRect=function(t,e){return this.isCollidingRect(t.x,t.y,t.width,t.height,e.x,e.y,.01,.01)},t.isPointInPlane3d=function(t,e,n,r){var o=i.mat4.multiply(i.mat4.create(),t.frustum,i.mat4.multiply(i.mat4.create(),t.viewMatrix,e.getModel())),a=this.toClipSpace(e.vertexModel.renderUnits[0].vertex,o);if(a[2]>1)return!1;var s=this.toClipSpace(e.vertexModel.renderUnits[1].vertex,o);if(s[2]>1)return!1;var u=this.toClipSpace(e.vertexModel.renderUnits[2].vertex,o);if(u[2]>1)return!1;var c=this.toClipSpace(e.vertexModel.renderUnits[3].vertex,o);if(c[2]>1)return!1;var h=[[a[0],a[1]],[s[0],s[1]],[c[0],c[1]],[u[0],u[1]]];return this.pointInPolygon([n,r],h)},t.toClipSpace=function(t,e){var n=i.vec4.transformMat4(i.vec4.create(),i.vec4.set(i.vec4.create(),t.x,t.y,t.z,1),e),r=i.vec4.scale(i.vec4.create(),n,1/n[3]);return i.vec4.set(i.vec4.create(),(r[0]+1)/2,(r[1]+1)/2,r[2],1)},t.pointInPolygon=function(t,e){for(var n=t[0],r=t[1],i=!1,o=0,a=e.length-1;o<e.length;a=o++){var s=e[o][0],u=e[o][1],c=e[a][0],h=e[a][1];u>r!=h>r&&n<(c-s)*(r-u)/(h-u)+s&&(i=!i)}return i},t}();e.CollisionDetection=a;var s=function(){function t(){this.max=0,this.min=0}return t.prototype.subtractCenter=function(t){return this.center.subtract(t.center)},t.prototype.offset=function(t){this.points.forEach(function(e){return e.add(t)})},t.prototype.area=function(t,e){return t.x*e.y-e.x*t.y},t.prototype.calculateCentre=function(){for(var t=r.default.newVector(0,0),e=0,n=this.points.length,i=0;i<n;++i){var o,a=this.points[i];o=i==n-1?this.points[0]:this.points[i+1];var s=this.area(a,o);e+=s,t.x+=(a.x+o.x)*s,t.y+=(a.y+o.y)*s}return t.x/=3*e,t.y/=3*e,t},t.prototype.polygonProjection=function(t,e){var n=t.dot(e.points[0]);e.min=n,e.max=n;for(var r=0;r<e.points.length;r++)(n=e.points[r].dot(t))<e.min?e.min=n:n>e.max&&(e.max=n)},t.prototype.boundaryDistance=function(t,e,n,r){return t<n?n-e:t-r},t.prototype.isCollision=function(t,e){var n=new o;n.isIntersect=!0,n.willIntersect=!0;for(var i,a=this.edges.length,s=t.edges.length,u=1/0,c=new r.default,h=0;h<a+s;h++){i=h<a?this.edges[h]:t.edges[h-a];var f=r.default.newVector(-i.y,i.x).normalise();if(this.polygonProjection(f,this),this.polygonProjection(f,t),this.boundaryDistance(this.min,this.max,t.min,t.max)>0&&(n.isIntersect=!1),e){var p=f.dot(e);p<0?this.min+=p:this.max+=p}var l=this.boundaryDistance(this.min,this.max,t.min,t.max);if(l>0&&(n.willIntersect=!1),!n.isIntersect&&!n.willIntersect)break;(l=Math.abs(l))<u&&(u=l,c=f,this.subtractCenter(t).dot(c)<0&&(c=c.negate()))}return n.willIntersect&&(n.minDeintersectDistance=c.scale(u)),n},t}();e.Polygon=s},3215:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.FontReference=void 0;var o=n(9172),a=n(9661),s=n(9979),u=n(3623),c=n(3765),h=n(1883),f=n(3276),p=n(4686),l=n(7725),d=function(t){function e(e,n,r){var i=t.call(this,n,r)||this;return i.fontChar=e,i}return i(e,t),e}(f.default),y=function(){function t(t,e,n){this.repeat=!1,this.newFont(t,e,n)}return t.prototype.render=function(t){this.isRepeat()&&!this.repeat||(this.repeat=!1,this.shaderEntity&&t.render(this.shaderEntity))},t.prototype.expire=function(){this.displayTime=-1,this.shaderEntity=void 0,this.font=void 0},t.prototype.isExpired=function(){return void 0!==this.displayTime&&!this.isRepeat()&&this.displayTime<this.timer.peak()},t.prototype.refresh=function(){this.repeat=!0},t.prototype.isRepeat=function(){return 0===this.displayTime},t.prototype.newFont=function(e,n,r){this.font=e,this.displayTime=r,this.timer=this.timer?this.timer:new a.default,this.timer.start(),this.id=this.id?this.id:t.$id++,this.shaderEntity=e.shaderEntity.shallowCopy();var i=new p.default;i.centerRect(n),i.rotateOriginRect(n),i.rotateZ(180),i.scaleRect(n),this.shaderEntity.model=i.getModel,this.shaderEntity.modelPosition=function(){return i.position},this.modelPos=i},t.$id=0,t}(),v=function(t){function e(e){var n=t.call(this)||this;return n.metaData=e,n.fonts={},n.renderFontState={},n.renderFontPool=[],n.avgWidth=0,n.avgHeight=0,n.count=0,n}return i(e,t),e.prototype.getFont=function(t){return this.fonts[t]},e.prototype.createRender=function(t,e,n){var r;return this.renderFontPool.length>0?(r=this.renderFontPool.pop()).newFont(t,e,n):r=new y(t,e,n),this.renderFontState[r.id]=r,r},e.prototype.refreshExpired=function(){var t=this;Object.values(this.renderFontState).forEach(function(e){e.isExpired()&&(delete t.renderFontState[e.id],t.renderFontPool.push(e))})},e.prototype.update=function(e){this.refreshExpired(),t.prototype.update.call(this,e)},e.prototype.render=function(t){var e=Object.values(this.renderFontState);e.forEach(function(e){return e.render(t)}),this.count=e.length},e.prototype.init=function(t){var e=this.metaData.context,n=e.fonts,r=new c.default(.5,.5,1,1,1),i=0,o=0,a=0;for(var s in n){var f=n[s],p=[f.x,f.y,f.x+f.width,f.y+f.height],l=h.default.vertex.planeCW(p,e.width,e.height),y=t.createPlaneVertexModel(e.filename,l,u.default.YX),v=new d(f,r,y);this.fonts[f.charCode]=v,this.entities.push(v),i+=f.width,o+=f.height,a+=1}this.avgHeight=o/a,this.avgWidth=i/a,this.initEntity(t)},e}(o.default),m=function(){function t(){}return t.prototype.render=function(t){t.writeFont(this)},t.newFont=function(e,n,r){var i=new t;return i.displayRect=new c.default(0,0,0,0),i.pos=e,i.time=r,i.$cacheId=n,i.isDirtyPos=!1,i.isDirtyText=!1,i},t.prototype.setTop=function(t){return this.isTop=t,this},t.prototype.translate=function(t,e){return this.pos.x+=t,this.pos.y+=e,this.isDirtyPos=!0,this},t.prototype.center=function(t,e){return this.pos.x=t,this.pos.y=e,this.isDirtyPos=!0,this},t.prototype.setPosition=function(t){return this.pos=new s.default(t.x,t.y),this.isDirtyPos=!0,this},t.prototype.setWidth=function(t){return this.width=t,this.isDirtyPos=!0,this},t.prototype.setText=function(t){return this.text=t,this.isDirtyText=!0,this},t.prototype.setFontSize=function(t){return this.fontSize=t,this.isDirtyPos=!0,this},t}();e.FontReference=m;var b=function(){function t(e){var n=this;this.warningShown=!1,this.fontCacheId=1,this.pixelDensity=400,this.expireRenderFont=function(t){n.fontCache[t.$id].forEach(function(t){return t.expire()}),n.fontCache[t.$id]=[]},this.writeRef=function(e){if(n.fontManager.count>t.MAX_FONT&&(n.warningShown||(n.warningShown=!0,console.warn("Maximum font is being rendered",n.fontManager.count))),e.fontSize)e.width||(e.width=n.calcTotalTextWidth(e));else{if(!e.width)return console.warn("Either font size or width needs to be set in FontReference"),e;if(!e.text)return console.warn("Font text must be set to calculate font size to fit width"),e;e.fontSize=n.calculateFontSize(e.width,e.text.length)}if(e.isDirtyText&&e.$id&&n.expireRenderFont(e),!e.$id||e.isDirtyText){e.$id||(e.$id=n.fontCacheId++),e.isDirtyText=!1,e.isDirtyPos=!1,e.prevPos=new s.default(e.pos.x,e.pos.y);var r=n.createFonts(e);n.fontCache[e.$id]=r,n.fontRefCache[e.$id]=e}else if(e.isDirtyPos){r=n.fontCache[e.$id];var i=e.pos;e.prevPos||(e.prevPos=new s.default(e.pos.x,e.pos.y));var o=e.prevPos.x-i.x,a=e.prevPos.y-i.y;r.forEach(function(t){var e=t.modelPos;e.translate(-o,-a,0),e.rotateOrigin(e.position.x,e.position.y,e.position.z)}),e.isDirtyPos=!1,e.prevPos=new s.default(e.pos.x,e.pos.y)}return n.fontCache[e.$id].forEach(function(t){t.refresh(),t.shaderEntity.isTop=e.isTop}),e},this.fontManager=new v(e),this.fontCache={},this.fontRefCache={},t.DefaultFont||(t.DefaultFont=this)}return t.prototype.event=function(){},t.prototype.update=function(t){t.notificationQueue.peak(l.RendererNotification.RESIZE_SCREEN.key)&&(Object.values(this.fontRefCache).forEach(this.expireRenderFont),Object.values(this.fontRefCache).forEach(function(t){return t.isDirtyText=!0}),this.fontManager.refreshExpired(),Object.values(this.fontRefCache).forEach(this.writeRef)),this.fontManager.update(t)},t.prototype.render=function(t){this.fontManager.render(t)},t.prototype.init=function(t){this.fontManager.init(t)},t.prototype.calcTotalTextWidth=function(t){for(var e=t.text,n=t.fontSize/this.pixelDensity,r=0,i=0;i<e.length;i++){var o=e.charCodeAt(i),a=this.fontManager.getFont(o);r+=n*(Math.abs(a.fontChar.height)<1e-5?0:a.fontChar.width/a.fontChar.height)}return r},t.prototype.calculateFontSize=function(t,e){return t/(Math.abs(this.fontManager.avgHeight)<1e-5?0:this.fontManager.avgWidth/this.fontManager.avgHeight)*this.pixelDensity/e/3},t.prototype.createFonts=function(t){for(var e=t.pos,n=t.time,r=t.text,i=t.fontSize/this.pixelDensity,o=0,a=-this.calcTotalTextWidth(t)/2,s=[],u=0;u<r.length;u++){var h=r.charCodeAt(u),f=this.fontManager.getFont(h),p=f.fontChar,l=i;o=Math.max(o,l);var d=l*(Math.abs(p.height)<1e-5?0:p.width/p.height);a+=d;var y=new c.default(e.x+a-p.xOffset/2,e.y+l/2-p.yOffset/2,d,l,-1*e.z),v=this.fontManager.createRender(f,y,n);s.push(v)}return t.displayRect.x=e.x+a/2,t.displayRect.y=e.y+o/2,t.displayRect.width=a,t.displayRect.height=o,s},t.MAX_FONT=1e3,t}();e.default=b},3276:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3893),a=n(8108),s=function(t){function e(e,n){var r=t.call(this)||this;return r.vertexModel=n,r.centerRect(e),r.rotateOriginRect(e.center()),r.scaleRect(e),r}return i(e,t),e.prototype.init=function(t){var e=new a.default;e.renderType=a.RenderType.RECTANGLE,e.shaderType=a.ShaderType.TWO_DIMENSION,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).createTexture(this.vertexModel.textureSource).build(this,e)},e}(n(9727).default);e.default=s},3300:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(9979),i=function(){function t(){}return t.boundRect=function(t,e){var n=Math.max(t.x,Math.min(t.x+t.width-e.width,e.x)),i=Math.max(t.y,Math.min(t.y+t.height-e.height,e.y));return new r.default(n,i,e.z)},t.getLength=function(t,e,n,r){return Math.sqrt(Math.abs((t-n)*(t-n))+Math.abs((e-r)*(e-r)))},t}();e.default=i},3435:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7285),a=n(7226),s=n(5884),u=n(9232),c=n(5169),h=function(t){function e(e){var n=t.call(this,e)||this;return n.arrayBuffer=new u.default(e),n.program=n.compileShaders(a.default,s.default),n.bindProgram(),n.position=new c.default("a_position",e,!0,n.program),n.textureCoords=new c.default("a_texture_coords",e,!0,n.program),n.tex2DSampler=new c.default("texture",e,!1,n.program),n.viewMtrx=new c.default("u_view",e,!1,n.program),n.modelMtrx=new c.default("u_model",e,!1,n.program),n.projMtrx=new c.default("u_projection",e,!1,n.program),n}return i(e,t),e.prototype.bindProgram=function(){this._bindProgram(this.program)},e.prototype.unbindProgram=function(){this._unbindProgram()},e.prototype.enableAttribPointers=function(){var t=this.ctx;t.enableVertexAttribArray(this.position.ref),t.enableVertexAttribArray(this.textureCoords.ref)},e.prototype.bindAttributePointers=function(){this.enableAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.position.ref,3,t.FLOAT,!1,32,0),t.vertexAttribPointer(this.textureCoords.ref,2,t.FLOAT,!1,32,24)},e.prototype.unbindAttributePointers=function(){this.ctx.disableVertexAttribArray(this.position.ref),this.ctx.disableVertexAttribArray(this.textureCoords.ref)},e.prototype.bindTexture=function(t){t.bindTexture(this.ctx,this.tex2DSampler.ref)},e.prototype.glSetModelMatrix=function(t){this.ctx.uniformMatrix4fv(this.modelMtrx.ref,!1,t)},e.prototype.glSetProjectMatrix=function(t){this.ctx.uniformMatrix4fv(this.projMtrx.ref,!1,t)},e.prototype.glSetViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.viewMtrx.ref,!1,t)},e.DRAW_VERTEX_SIZE=8,e}(o.default);e.default=h},3463:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(1656),i=n(8108),o=n(3435),a=function(){function t(t){this.ctx=t,this.program=new o.default(t),this.updateViewModel(r.mat4.create())}return t.prototype.delete=function(){this.program.arrayBuffer.delete(this.ctx),this.program.delete()},t.prototype.updateBuffer=function(t,e){var n=t.getOpt();if(i.ShaderType.TWO_DIMENSION===n.shaderType){var r=this.program.arrayBuffer.bufferReg[t.rendererBufferId];e&&e.length===r.verticesSize||console.error("New Buffer data does not match initial buffer data!",t,e,r.verticesSize),this.program.arrayBuffer.bufferSub(this.ctx,r.offset,r.size,e,o.default.DRAW_VERTEX_SIZE)}else console.error("Updating buffer for registered 2D Entity but with different shader type as RenderOptions",n)},t.prototype.bindBuffer=function(){this.program.arrayBuffer.bufferBind(this.ctx)},t.prototype.render=function(t,e,n){this.program.arrayBuffer.bind(this.ctx),this.program.bindAttributePointers(),this.program.bindProgram(),this.program.glSetViewMatrix(e.viewMatrix),this.ctx.isEnabled(this.ctx.CULL_FACE)&&this.ctx.disable(this.ctx.CULL_FACE),this.ctx.isEnabled(this.ctx.DEPTH_TEST)&&this.ctx.disable(this.ctx.DEPTH_TEST);for(var r=0;r<t.length;r++){var o=t[r],a=o[0],s=o[1],u=a.getOpt();if(!a.rendererTextureRef)throw new Error("Unregistered entity texture"+a);var c=n[a.rendererTextureRef];if(this.program.bindTexture(c.texture),this.program.glSetModelMatrix(s),!a.rendererBufferId)throw new Error("Unregistered entity buffer"+a);var h=this.program.arrayBuffer.bufferReg[a.rendererBufferId];u.renderType===i.RenderType.TRIANGLE?this.ctx.drawArrays(this.ctx.TRIANGLES,h.offset,h.size):this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,h.offset,h.size)}this.program.arrayBuffer.unbind(this.ctx),this.program.unbindAttributePointers(),this.program.unbindProgram()},t.prototype.registerEntity=function(t,e){var n=e.length/o.default.DRAW_VERTEX_SIZE;this.program.arrayBuffer.bufferReg[this.program.arrayBuffer.bufferRegId]={offset:this.program.arrayBuffer.length(),size:n,verticesSize:e.length},this.program.arrayBuffer.push(e,n),t.rendererBufferId=this.program.arrayBuffer.bufferRegId,this.program.arrayBuffer.bufferRegId++},t.prototype.updateViewModel=function(t){this.program.bindProgram(),this.program.glSetViewMatrix(t)},t.prototype.updatePerspective=function(t){this.program.bindProgram(),this.program.glSetProjectMatrix(t)},t}();e.default=a},3575:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7970),a=n(3765),s=n(5854),u=n(1884),c=function(t){function e(e,n,r){void 0===r&&(r=1.2);var i=t.call(this)||this;return i.initialHeadRotation=135,i.setRect(e),i.headScale=r,i.arrowBar=new s.default(e,n),i.head=new u.default(e,n),i.head.rotateZ(i.initialHeadRotation),i.calculatePos(),i.entities.push(i.arrowBar),i.entities.push(i.head),i}return i(e,t),e.prototype.calculatePos=function(){var t=this.position,e=t.x,n=t.y,r=t.width,i=t.height,o=new a.default(e-r,n-i/2,r,i);this.arrowBar.setRect(o);var s=o.width*this.headScale,u=new a.default(e-s/2,n-s/2,s,s);this.head.setRect(u),this.head.rotateOriginRect(this.position),this.arrowBar.rotateOriginRect(this.position)},e.prototype.rotate=function(e){e!==this.position.az&&(t.prototype.angleZ.call(this,e),this.head.angleZ(this.position.az-this.initialHeadRotation),this.calculatePos())},e.prototype.setLocation=function(t){this.center(t.x,t.y,t.z),this.calculatePos()},e.prototype.init=function(e){t.prototype.initEntity.call(this,e)},e.prototype.render=function(e){t.prototype.render.call(this,e)},e.prototype.update=function(e){t.prototype.update.call(this,e)},e}(o.default);e.default=c},3623:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r){this.width=t,this.height=e,this.length=n,this.normalDirection=r}return t.XY=new t(0,0,0,0),t.YX=new t(0,0,0,0),t.XZ=new t(0,0,0,0),t.ZX=new t(0,0,0,0),t.YZ=new t(0,0,0,0),t.ZY=new t(0,0,0,0),t.BACKWARDS=-1,t.FORWARD=1,t}();e.default=n},3676:function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(e,n){var r=t.call(this)||this;return r.isLoaded=!1,r.isError=!1,r.load=r.loadImage(e).then(function(){return r.onLoad(n)}).catch(function(t){return r.onError(t)}),r}return r(e,t),e.prototype.onError=function(t){throw this.isError=!0,this.isLoaded=!1,t},e.prototype.onLoad=function(t){return this.handleTextureLoaded(this.image,t),this.isLoaded=!0,this.width=this.image.width,this.height=this.image.height,!0},e.prototype.newTextureUnit=function(){return e.textureCount++},e.prototype.bindTexture=function(t,e){this.isLoaded&&t.uniform1i(e,this.texUnit)},e.prototype.handleTextureLoaded=function(t,e){this.texUnit=this.newTextureUnit(),e.activeTexture(e.TEXTURE0+this.texUnit),this.texture=this.createTextureFromImage(t,e)},e.prototype.createTextureFromImage=function(t,e){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),n},e.textureCount=0,e}(function(){function t(){}return t.prototype.loadImage=function(t){var e=this;return new Promise(function(n,r){e.image=document.createElement("img"),e.image.crossOrigin="",e.image.onload=function(){return n()},e.image.onerror=function(t){return r(t)},e.image.src=t})},t}());e.default=i},3756:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(9515),a=n(9637),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$ref={},e.show=!1,e}return i(e,t),e.prototype.reset=function(){this.entities=[],this.$ref={}},e.prototype.beforeShow=function(){},e.prototype.updatePosition=function(t,e){this.$ref[t.$id]?this.$ref[t.$id].position=e:console.error("Trying to update position when entity not set",this)},e.prototype.setShow=function(t){this.show=t,this.show&&this.beforeShow(),this.entities.forEach(function(e){o.default.setEnabledPhysics(e,t),e.hidden=!t}),this.show&&this.restore()},e.prototype.restore=function(){for(var t in this.$ref)if(this.$ref.hasOwnProperty(t)){var e=this.$ref[t];e.entity.setPosition(e.position)}},e.prototype.addEntity=function(t){return this.$ref[t.$id]||(this.entities.push(t),this.$ref[t.$id]={entity:t,position:t.position}),this},e.prototype.update=function(t){this.show&&(this.entities.forEach(function(e){return e.update(t)}),this.configBuilder&&this.configBuilder.texts.forEach(function(e){return t.writeFont(e)}))},e.prototype.render=function(t){this.show&&this.entities.forEach(function(e){return e.render(t)})},e.prototype.event=function(t,e){this.show&&this.entities.forEach(function(n){return n.event(t,e)})},e.prototype.init=function(t){this.entities.forEach(function(e){return e.init(t)})},e.prototype.parseMap=function(t,e){var n=this;this.configBuilder=new a.default(t),this.configBuilder.build(e),this.configBuilder.objects.forEach(function(t){return n.addEntity(t)})},e}(n(7970).default);e.default=s},3765:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n,r,i,o){return t.call(this,e,n,o||0,r,i,1)||this}return i(e,t),e.create=function(){return new e(0,0,0,0,0)},e.prototype.newCenter=function(){return new e(this.x+this.width/2,this.y+this.height/2,this.width,this.height,this.z)},e}(n(6276).default);e.default=o},3893:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(8136),i=function(){function t(t){this.engineHelper=t}return t.prototype.createTexture=function(t){return this.textureSource=t,this.hasTexture=!0,this},t.prototype.addBuffer=function(t){return this.vertexModel=t,this},t.prototype.build=function(t,e){this.vertexModel||console.error("VertexModel is undefined",this);var n=new r.ShaderEntity,i=n.getOpt();return i.renderType=e.renderType,i.shaderType=e.shaderType,n.model=t.getModel,n.modelPosition=function(){return t.position},n.vertexModel=this.vertexModel,n.vertexModel.registerModel(this.engineHelper),this.engineHelper.registerEntity(n),this.hasTexture&&(n.src=this.textureSource,this.engineHelper.createTexture(n)),n},t.clone=function(t){return Object.assign(new r.ShaderEntity,t)},t}();e.default=i},3968:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.$id=t._$ID++}return t._$ID=1,t}();e.default=n},4032:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5282),a=n(1442),s=n(8431),u=n(2167),c=function(t){function e(){return t.call(this)||this}return i(e,t),e.prototype.render=function(){var t=this;this.entities.forEach(function(e){return e.render(t.engineHelper)})},e.prototype.update=function(){var t=this;this.entities.forEach(function(e){return e.update(t.engineHelper)});var e=this.engineHelper.camera.camera3d.position,n=e.x,r=e.y,i=e.z;this.sky.center(n,r,i)},e.prototype.event=function(e){t.prototype.event.call(this,e),e.eventType===o.Events.DRAG&&(this.engineHelper.camera.camera3d.angleY(-e.dxRaw),this.engineHelper.camera.camera3d.angleX(e.dyRaw),this.engineHelper.camera.camera3d.updateProjectionView())},e.prototype.loadResources=function(){this.engineHelper.getResource("assets/sphere.txt").then(o.ResourceResolver.objResolverMultiple(this.engineHelper,[{textureSource:"assets/background.jpg",name:"background"},{textureSource:"assets/sun.png",name:"sun"}])),this.engineHelper.getResource("assets/low_poly_tree.txt").then(o.ResourceResolver.objResolver(this.engineHelper,"assets/low_poly_tree.png","low_poly_tree")),this.engineHelper.getResource("assets/low_poly_girl.txt").then(o.ResourceResolver.objResolver(this.engineHelper,"assets/low_poly_girl.png","low_poly_girl")),this.engineHelper.getResource("assets/racing_car.txt").then(o.ResourceResolver.objResolver(this.engineHelper,"assets/racing_car.png","racing_car")),this.engineHelper.getResource("assets/paprika.fnt").then(o.ResourceResolver.bmFontResolver(this.engineHelper)),this.engineHelper.getResource("assets/atlas.txt").then(o.ResourceResolver.bitmapResolver(this.engineHelper,1024,1024,.02))},e.prototype.init=function(){var e=this;this.engineHelper.camera.camera3d.center(0,2,11),this.engineHelper.camera.camera3d.updateProjectionView(),this.sky=new u.default(new o.Rect3d(0,2,0,30,32,30),"background"),this.sky.setRenderType(o.RenderType.PLAIN),this.addEntity(this.sky),this.lowPolyGirl=new o.Object3d(new o.Rect3d(-4,.95,5,1,1,1),"low_poly_girl"),this.lowPolyGirl.angleY(240),this.lowPolyGirl.scale(.7,.7,.7),this.addEntity(this.lowPolyGirl),this.racingCar=new o.Object3d(new o.Rect3d(0,-.25,0,1.5,1.5,1.5),"racing_car"),this.racingCar.angleY(135),this.addEntity(this.racingCar),this.ground=new a.default(new o.Rect3d(0,0,0,20,0,30),"grass"),this.ground.event=function(t,n){if(t.eventType===o.Events.UP&&t.prevEventType===o.Events.DOWN){var r=e.ground.isPointInGround(new o.Coordinate(t.x,t.y,0));if(r){var i=n.camera.camera3d.position.x,a=n.camera.camera3d.position.z,s=Math.abs(i-r.position.x),u=Math.abs(a-r.position.z),c=Math.sqrt(s*s+u*u)/.005;n.camera.camera3d.pan(c,r.position.x,void 0,r.position.z)}}},this.addEntity(this.ground),this.cube=new s.default(new o.Rect3d(-4,2,-12,1,1,1),"assets/atlas.png",["wood","cloth","sky","grass","paper","rock"]),this.cube.update=function(){var t=this;this.position.ay++,this.position.ax++,this.position.az++,this.planes.forEach(function(e){e.angleY(t.position.ay),e.angleX(t.position.ax),e.angleZ(t.position.az)})},this.addEntity(this.cube),this.cube2=new s.default(new o.Rect3d(4,2,2,1,1,1),"assets/atlas.png",["wood","cloth","sky","grass","paper","rock"]),this.cube2.update=function(){var t=this;this.position.ay++,this.position.ax++,this.position.az++,this.planes.forEach(function(e){e.angleY(t.position.ay),e.angleX(t.position.ax),e.angleZ(t.position.az)})},this.addEntity(this.cube2),this.sun=new u.default(new o.Rect3d(0,10,-15,1,1,1),"sun"),this.sun.setRenderType(o.RenderType.PLAIN),this.sun.update=function(){this.position.ay++,this.position.ay++,this.position.ay++,this.position.ay++,this.position.ay++,this.angleY(this.position.ay),this.angleX(this.position.ax),this.angleZ(this.position.az)},this.addEntity(this.sun),this.lowPolyTree=[];for(var n=function(t,n){var r=new o.Object3d(new o.Rect3d(t,0,n,1,1,1),"low_poly_tree"),i=.8*Math.random()-.8+3.5;r.scale(i,i,i),e.lowPolyTree.push(r),e.addEntity(r)},r=0;r<30;r+=4)n(-10,r-15),n(9,r-15);for(var i=1;i<19;i+=4)n(i-10,-15),n(i-10,14);var c=this.engineHelper.newVertexModel("ground",o.PlaneType.XZ);this.road=new o.Plane3d(new o.Rect3d(0,.01,0,1,1,1),c),this.road.scale(3,1,40/Math.sqrt(2)),this.road.angleY(-45),this.road.center(-2,.01,-15),this.addEntity(this.road),t.prototype.init.call(this),this.engineHelper.setLighting(new o.Light({pos:[-20,15,-20],in:[1,1,1],attenuation:.015,ambientCoeff:.3,at:[0,0,0]}))},e}(o.ObjectManager);e.default=c},4284:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(39),a=function(t){function e(e,n){var r=t.call(this,e,new o.default)||this;return r.vertexUvCacheId=n,r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(e){this.vertexModel=e.newVertexModelUv3d(this.vertexUvCacheId),t.prototype.init.call(this,e)},e}(n(6525).default);e.default=a},4382:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump float;\nprecision mediump int;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying mat4 v_model;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_attenuation;\nvarying float v_light1_ambient_coefficient;\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\n\nuniform sampler2D texture;\nuniform sampler2D shadowMap;\nuniform float numLights;\n\nstruct Light {\n  vec3 position;\n  vec3 intensities;\n  float ambientCoefficient;\n  float attenuation;\n};\n\nvoid main(void) {\n  Light light1;\n  light1.intensities = v_light1_intensities;\n  light1.position = v_light1_pos;\n  light1.attenuation = v_light1_attenuation;\n  light1.ambientCoefficient = v_light1_ambient_coefficient;\n\n  vec3 n = normalize(v_normal);\n  vec3 l = normalize(v_light1_pos);\n  float cosTheta = clamp(dot(n, l), 0.0, 1.0);\n\n  vec4 surfaceColor = texture2D(texture, v_texture_coords);\n  vec3 diffuse = v_diffuseCoefficient * surfaceColor.rgb * light1.intensities;\n  vec3 ambient = light1.ambientCoefficient * surfaceColor.rgb * light1.intensities;\n\n  vec3 linearColor = ambient + v_attenuation * diffuse * cosTheta;\n\n  vec3 gamma = vec3(1.0 / 2.2);\n  gl_FragColor = vec4(pow(linearColor, gamma), surfaceColor.a);\n}\n"},4445:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontCharacter=e.FontMeta=void 0;e.FontMeta=function(){this.fonts={}};e.FontCharacter=function(){};e.default=function(){}},4494:function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.SubscriptionListeners=e.Subscription=void 0;var i=function(t){this.key=t};e.Subscription=i;var o=function(t){function e(e){var n=t.call(this,e)||this;return n.listeners={},n.subscriptionId=0,n}return r(e,t),e.prototype.listen=function(t){return this.listeners[this.subscriptionId++]=t,this.subscriptionId-1},e.prototype.unlisten=function(t){delete this.listeners[t]},e.prototype.publish=function(t){Object.values(this.listeners).forEach(function(e){return e(t)})},e.prototype.flush=function(){this.listeners={}},e}(i);e.SubscriptionListeners=o;var a=function(){function t(){this.subscribers={}}return t.prototype.listen=function(t,e){return this.getSubscriptionListeners(t).listen(e)},t.prototype.getSubscriptionListeners=function(t){var e=t.key;return this.subscribers[e]||(this.subscribers[e]=new o(e)),this.subscribers[e]},t.prototype.publish=function(t,e){this.getSubscriptionListeners(t).publish(e)},t}();e.default=a},4686:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(1656),i=n(6276),o=n(757),a=function(){function t(){var t=this;this.position=new o.default,this.dirtyModel=!0,this.dirtyQuat=!0,this.dirtyPos=!0,this.dirtyScale=!0,this.dirtyOrigin=!0,this.intermediateModels=[r.mat4.create(),r.mat4.create(),r.mat4.create(),r.mat4.create()],this.initialMat4Temp=r.mat4.create(),this.rotateQuatTemp=r.quat.create(),this.rotateMat4Temp=r.mat4.create(),this.getModel=function(){return t.dirtyModel&&(t.dirtyModel=!1,t._buildModel()),t.cachedModel}}return t.prototype.setPosition=function(t){this.position=t},t.prototype.pos=function(){return[this.position.x,this.position.y,this.position.z]},t.prototype.centerRect=function(t){this.center(t.x,t.y,t.z)},t.prototype.rotateOriginRect=function(t){this.rotateOrigin(t.x,t.y,t.z)},t.prototype.centerCoord=function(t){this.center(t.x,t.y,t.z)},t.prototype.center=function(t,e,n){this.position.x=t,this.position.y=e,this.position.z=n,this.dirtyPos=!0,this.dirtyModel=!0,this.rotateOrigin(t+this.position.width/2,e+this.position.height/2,n+this.position.length/2)},t.prototype.rotateOrigin=function(t,e,n){this.position.originX=t,this.position.originY=e,this.position.originZ=n,this.dirtyOrigin=!0,this.dirtyQuat=!0,this.dirtyModel=!0},t.prototype.angleX=function(t){this.position.ax=t,this.dirtyQuat=!0,this.dirtyModel=!0},t.prototype.angleY=function(t){this.position.ay=t,this.dirtyQuat=!0,this.dirtyModel=!0},t.prototype.angleZ=function(t){this.position.az=t,this.dirtyQuat=!0,this.dirtyModel=!0},t.prototype.rotateX=function(t){this.angleX(t)},t.prototype.rotateY=function(t){this.angleY(t)},t.prototype.rotateZ=function(t){this.angleZ(t)},t.prototype.scaleX=function(t){this.position.scaleX=t,this.position.width=this.position.scaleX,this.dirtyScale=!0,this.dirtyModel=!0},t.prototype.scaleY=function(t){this.position.scaleY=t,this.position.height=this.position.scaleY,this.dirtyScale=!0,this.dirtyModel=!0},t.prototype.scaleZ=function(t){this.position.scaleZ=t,this.dirtyScale=!0,this.dirtyModel=!0},t.prototype.scale=function(t,e,n){this.position.scaleX=t,this.position.scaleY=e,this.position.scaleZ=n,this.position.width=t,this.position.height=e,this.position.length=n,this.dirtyScale=!0,this.dirtyModel=!0},t.prototype.scaleRect=function(t){this.scale(t.width,t.height,t.length)},t.prototype.translate=function(t,e,n){this.position.x+=t,this.position.y+=e,this.position.z+=n,this.dirtyPos=!0,this.dirtyModel=!0,this.rotateOrigin(this.position.x+this.position.width/2,this.position.y+this.position.height/2,this.position.z+this.position.length/2)},t.prototype._buildQuat=function(){var t=this.createMat4NoAlloc(this.rotateMat4Temp),e=this.createQuatNoAlloc(this.rotateQuatTemp);return e=r.quat.rotateX(e,e,this.degreesToRadians(this.position.ax)),e=r.quat.rotateY(e,e,this.degreesToRadians(this.position.ay)),e=r.quat.rotateZ(e,e,this.degreesToRadians(this.position.az)),e=r.quat.normalize(e,e),r.mat4.fromQuat(t,e)},t.prototype.getIntermediateModel=function(t,e){var n=this.intermediateModels[t];for(var r in e)e.hasOwnProperty(r)&&(e[r]=n[r]);return e},t.prototype._buildModelIntermediate=function(t,e){var n=this.intermediateModels[t];for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return e},t.prototype.createQuatNoAlloc=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},t.prototype.createMat4NoAlloc=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.prototype._buildModel=function(){var t=!1,e=this.createMat4NoAlloc(this.initialMat4Temp);if(this.dirtyOrigin){t=!0;var n=[this.position.originX,this.position.originY,this.position.originZ];r.mat4.translate(e,e,n),this._buildModelIntermediate(0,e)}else e=this.getIntermediateModel(0,e);if(this.dirtyQuat||t?(t=!0,this.quatRotationxyz=this._buildQuat(),r.mat4.multiply(e,e,this.quatRotationxyz),this._buildModelIntermediate(1,e)):e=this.getIntermediateModel(1,e),this.dirtyPos||t){t=!0;var i=[-1*this.position.originX,-1*this.position.originY,-1*this.position.originZ];r.mat4.translate(e,e,i);var o=[this.position.x,this.position.y,this.position.z];r.mat4.translate(e,e,o),this._buildModelIntermediate(2,e)}else e=this.getIntermediateModel(2,e);if(this.dirtyScale||t){t=!0;var a=[this.position.scaleX,this.position.scaleY,this.position.scaleZ];r.mat4.scale(e,e,a),this._buildModelIntermediate(3,e)}else e=this.getIntermediateModel(3,e);this.dirtyPos=!1,this.dirtyQuat=!1,this.dirtyScale=!1,this.dirtyOrigin=!1,this.cachedModel=e},t.prototype.degreesToRadians=function(t){return Math.round(100*r.glMatrix.toRadian(t))/100},t.prototype.setRect=function(t){this.scaleRect(t),this.centerRect(t)},t.prototype.getRect=function(){return new i.default(this.position.x,this.position.y,this.position.z,this.position.width,this.position.height,this.position.length)},t}();e.default=a},5038:function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.NotificationPayload=e.Notification=void 0;var i=function(t,e){this.key=t,this.action=e};e.Notification=i;var o=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.data=r,i}return r(e,t),e.from=function(t,n){return new e(t.key,t.action,n)},e}(i);e.NotificationPayload=o;var a=function(t){this.data=t},s=function(){function t(){this.queueMap={}}return t.prototype.clearQueue=function(){this.queueMap={}},t.prototype.pushPayload=function(t){var e=t.key,n=this.queueMap[e];if(n||(this.queueMap[e]={bottom:void 0,top:void 0},n=this.queueMap[e]),n.bottom){if(!n.top)throw new Error("Unexpected state for notification push payload");n.top.next=new a(t),n.top=n.top.next}else n.bottom=new a(t),n.top=n.bottom},t.prototype.push=function(t,e){t instanceof o&&console.error("Please use pushPayload"),this.pushPayload(new o(t.key,t.action,e))},t.prototype.pushNotification=function(t,e){this.push(new i(t,e))},t.prototype.take=function(t){if(this.getBottom(t)){var e=this.peak(t);if(!e)throw new Error("Expected data to appear when reading data from notification");return this.shiftQueue(t),e}},t.prototype.shiftQueue=function(t){var e=this.queueMap[t],n=e.bottom;if(!n)throw new Error("Trying to shift queue with bottom undefined");e.bottom=n.next,e.bottom||(e.top=void 0)},t.prototype.getBottom=function(t){return this.queueMap[t]?this.queueMap[t].bottom:void 0},t.prototype.peak=function(t){var e=this.getBottom(t);return e&&e.data||void 0},t}();e.default=s},5169:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e,n,r){if(n){if(this.ref=e.getAttribLocation(r,t),-1===this.ref)throw new Error("Unable to find attribute shader key = "+t)}else if(this.ref=e.getUniformLocation(r,t),null===this.ref)throw new Error("Unable to find uniform shader key = "+t)}},5228:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4445),a=function(t){function e(e){var n=t.call(this)||this,r=e.split("\n");for(var i in n.context=new o.FontMeta,r)if(r.hasOwnProperty(i)){var a=r[i];n.parseWidth(n.context,a),n.parseHeight(n.context,a),n.parseFilename(n.context,a),n.parseLineHeight(n.context,a),n.parseChar(n.context,a)}return n}return i(e,t),e.prototype.parseChar=function(t,n){var r=n.match(e.FONT_CHAR);if(r){var i=new o.FontCharacter;i.charCode=parseFloat(r[1]),i.x=parseFloat(r[2]),i.y=parseFloat(r[3]),i.width=parseFloat(r[4]),i.height=parseFloat(r[5]),i.xOffset=parseFloat(r[6])/t.width,i.yOffset=parseFloat(r[7])/t.height,i.char=String.fromCharCode(i.charCode),t.fonts[i.char]=i}},e.prototype.parseHeight=function(t,n){if(!t.height){var r=n.match(e.HEIGHT);r&&(t.height=parseFloat(r[1]))}},e.prototype.parseLineHeight=function(t,n){if(!t.lineHeight){var r=n.match(e.LINE_HEIGHT);r&&(t.lineHeight=parseFloat(r[1]))}},e.prototype.parseWidth=function(t,n){if(!t.width){var r=n.match(e.WIDTH);r&&(t.width=parseFloat(r[1]))}},e.prototype.parseFilename=function(t,n){if(!t.filename){var r=n.match(e.FILENAME);r&&(t.filename=r[1])}},e.FILENAME=/file="([\w\d_.\\/-]+)"/,e.WIDTH=/scaleW=([\d]+)/,e.HEIGHT=/scaleH=([\d]+)/,e.LINE_HEIGHT=/lineHeight=([\d]+)/,e.FONT_CHAR=new RegExp("char[\\s]+"+["id","x","y","width","height","xoffset","yoffset"].map(function(t){return"".concat(t,"=([-\\d]+)[\\s]+")}).reduce(function(t,e){return t+e})),e}(o.default);e.default=a},5278:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.registerModel=function(t){this.vertexBufferId||(this.vertexBufferId=t.addBufferCache(this.createModel()))},t}();e.default=n},5282:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CircleColour2d=e.TriangleColour2d=e.PlaneColour=e.Plane3d=e.Plane2d=e.Object3d=e.Moveable=e.Arrow=e.ProgressBar=e.Button=e.VertexParser=e.FntFontReader=e.BitmapConfigParser=e.EntityManager2d=e.EntityManager=e.ObjectManager=e.EngineEvent=e.Events=e.ShaderEntity=e.ModelPosition=e.ModelObjectRect3d=e.ModelObject3d=e.ModelObject2d=e.EngineObject=e.VertexModel=e.Vector2d=e.ColourRenderUnit=e.TextureRenderUnit=e.RenderUnit=e.Rect2d=e.ModelData=e.FontCharacter=e.FontMeta=e.FontMetaData=e.FontReference=e.Coordinate=e.EngineObjectHelper=e.TextureVertexModel=e.ColourVertexModel=e.Colour=e.PlaneType=e.Rect3d=e.LightOptions=e.Light=e.RenderType=e.Timer=e.EngineMath=e.Physics=e.Collision=e.CollisionDetection=void 0,e.RandomMovementConfig=e.RandomMovement=e.Camera=e.Notification=e.NotificationPayload=e.NotificationQueue=e.SubscriptionListeners=e.Subscription=e.SubscriberPool=e.ResourceResolver=e.Position=e.EngineMap=e.EngineHelper=e.SpriteModel=void 0;var r=n(7103),i=n(3207);Object.defineProperty(e,"CollisionDetection",{enumerable:!0,get:function(){return i.CollisionDetection}}),Object.defineProperty(e,"Collision",{enumerable:!0,get:function(){return i.Collision}});var o=n(9515);Object.defineProperty(e,"Physics",{enumerable:!0,get:function(){return o.default}});var a=n(3300);Object.defineProperty(e,"EngineMath",{enumerable:!0,get:function(){return a.default}});var s=n(9661);Object.defineProperty(e,"Timer",{enumerable:!0,get:function(){return s.default}});var u=n(8108);Object.defineProperty(e,"RenderType",{enumerable:!0,get:function(){return u.RenderType}});var c=n(6945);Object.defineProperty(e,"Light",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"LightOptions",{enumerable:!0,get:function(){return c.LightOptions}});var h=n(6276);Object.defineProperty(e,"Rect3d",{enumerable:!0,get:function(){return h.default}});var f=n(3623);Object.defineProperty(e,"PlaneType",{enumerable:!0,get:function(){return f.default}});var p=n(2913);Object.defineProperty(e,"Colour",{enumerable:!0,get:function(){return p.default}});var l=n(6050);Object.defineProperty(e,"ColourVertexModel",{enumerable:!0,get:function(){return l.default}});var d=n(39);Object.defineProperty(e,"TextureVertexModel",{enumerable:!0,get:function(){return d.default}});var y=n(1883);Object.defineProperty(e,"EngineObjectHelper",{enumerable:!0,get:function(){return y.default}});var v=n(9979);Object.defineProperty(e,"Coordinate",{enumerable:!0,get:function(){return v.default}});var m=n(3215);Object.defineProperty(e,"FontReference",{enumerable:!0,get:function(){return m.FontReference}});var b=n(4445);Object.defineProperty(e,"FontMetaData",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(e,"FontMeta",{enumerable:!0,get:function(){return b.FontMeta}}),Object.defineProperty(e,"FontCharacter",{enumerable:!0,get:function(){return b.FontCharacter}});var g=n(3968);Object.defineProperty(e,"ModelData",{enumerable:!0,get:function(){return g.default}});var _=n(3765);Object.defineProperty(e,"Rect2d",{enumerable:!0,get:function(){return _.default}});var x=n(7435);Object.defineProperty(e,"RenderUnit",{enumerable:!0,get:function(){return x.RenderUnit}}),Object.defineProperty(e,"TextureRenderUnit",{enumerable:!0,get:function(){return x.TextureRenderUnit}}),Object.defineProperty(e,"ColourRenderUnit",{enumerable:!0,get:function(){return x.ColourRenderUnit}});var w=n(2276);Object.defineProperty(e,"Vector2d",{enumerable:!0,get:function(){return w.default}});var M=n(5278);Object.defineProperty(e,"VertexModel",{enumerable:!0,get:function(){return M.default}});var E=n(9727);Object.defineProperty(e,"EngineObject",{enumerable:!0,get:function(){return E.default}});var T=n(3276);Object.defineProperty(e,"ModelObject2d",{enumerable:!0,get:function(){return T.default}});var P=n(6525);Object.defineProperty(e,"ModelObject3d",{enumerable:!0,get:function(){return P.default}});var R=n(875);Object.defineProperty(e,"ModelObjectRect3d",{enumerable:!0,get:function(){return R.default}});var O=n(4686);Object.defineProperty(e,"ModelPosition",{enumerable:!0,get:function(){return O.default}});var S=n(8136);Object.defineProperty(e,"ShaderEntity",{enumerable:!0,get:function(){return S.ShaderEntity}});var C=n(8495);Object.defineProperty(e,"Events",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(e,"EngineEvent",{enumerable:!0,get:function(){return C.EngineEvent}});var I=n(5692);Object.defineProperty(e,"ObjectManager",{enumerable:!0,get:function(){return I.default}});var A=n(9172);Object.defineProperty(e,"EntityManager",{enumerable:!0,get:function(){return A.default}});var j=n(7970);Object.defineProperty(e,"EntityManager2d",{enumerable:!0,get:function(){return j.default}});var D=n(1406);Object.defineProperty(e,"BitmapConfigParser",{enumerable:!0,get:function(){return D.default}});var F=n(5228);Object.defineProperty(e,"FntFontReader",{enumerable:!0,get:function(){return F.default}});var L=n(1513);Object.defineProperty(e,"VertexParser",{enumerable:!0,get:function(){return L.default}});var N=n(1792);Object.defineProperty(e,"Button",{enumerable:!0,get:function(){return N.default}});var B=n(7310);Object.defineProperty(e,"ProgressBar",{enumerable:!0,get:function(){return B.default}});var U=n(3575);Object.defineProperty(e,"Arrow",{enumerable:!0,get:function(){return U.default}});var z=n(8227);Object.defineProperty(e,"Moveable",{enumerable:!0,get:function(){return z.default}});var V=n(4284);Object.defineProperty(e,"Object3d",{enumerable:!0,get:function(){return V.default}});var X=n(2104);Object.defineProperty(e,"Plane2d",{enumerable:!0,get:function(){return X.default}});var Y=n(2297);Object.defineProperty(e,"Plane3d",{enumerable:!0,get:function(){return Y.default}});var H=n(5854);Object.defineProperty(e,"PlaneColour",{enumerable:!0,get:function(){return H.default}});var G=n(1884);Object.defineProperty(e,"TriangleColour2d",{enumerable:!0,get:function(){return G.default}});var k=n(9016);Object.defineProperty(e,"CircleColour2d",{enumerable:!0,get:function(){return k.default}});var q=n(9802);Object.defineProperty(e,"SpriteModel",{enumerable:!0,get:function(){return q.default}});var W=n(1580);Object.defineProperty(e,"EngineHelper",{enumerable:!0,get:function(){return W.default}});var Z=n(3756);Object.defineProperty(e,"EngineMap",{enumerable:!0,get:function(){return Z.default}});var K=n(757);Object.defineProperty(e,"Position",{enumerable:!0,get:function(){return K.default}});var $=n(2922);Object.defineProperty(e,"ResourceResolver",{enumerable:!0,get:function(){return $.default}});var Q=n(4494);Object.defineProperty(e,"SubscriberPool",{enumerable:!0,get:function(){return Q.default}}),Object.defineProperty(e,"Subscription",{enumerable:!0,get:function(){return Q.Subscription}}),Object.defineProperty(e,"SubscriptionListeners",{enumerable:!0,get:function(){return Q.SubscriptionListeners}});var J=n(5038);Object.defineProperty(e,"NotificationQueue",{enumerable:!0,get:function(){return J.default}}),Object.defineProperty(e,"NotificationPayload",{enumerable:!0,get:function(){return J.NotificationPayload}}),Object.defineProperty(e,"Notification",{enumerable:!0,get:function(){return J.Notification}});var tt=n(7141);Object.defineProperty(e,"Camera",{enumerable:!0,get:function(){return tt.default}});var et=n(9788);Object.defineProperty(e,"RandomMovement",{enumerable:!0,get:function(){return et.default}}),Object.defineProperty(e,"RandomMovementConfig",{enumerable:!0,get:function(){return et.RandomMovementConfig}}),e.default=r.default},5431:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n){var r=t.call(this)||this;return r.spriteModel=n,r.spriteModel.setRect(e),r}return i(e,t),e.prototype.render=function(t){this.spriteModel.render(t)},e.prototype.update=function(t){this.spriteModel.update(t)},e.prototype.init=function(e){this.entities.push(this.spriteModel),t.prototype.initEntity.call(this,e),this.setRect(this.spriteModel.getRect()),this.updatePhysicsPosition()},e}(n(8227).default);e.default=o},5532:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7285),a=n(6373),s=n(9862),u=n(6732),c=n(3078),h=n(4382),f=n(9700),p=n(9232),l=n(1656),d=n(3676),y=n(5169),v=function(t){function e(e){var n=t.call(this,e)||this;return n.shadowDepthTextureSize=1024,n.arrayBuffer=new p.default(e),n.isShadowEnabled?(n.program=n.compileShaders(u.default,c.default),n.bindProgram(),n.shadowMap=new y.default("shadowMap",e,!1,n.program),n.light1View=new y.default("u_light1_view",e,!1,n.program),n.light1Projection=new y.default("u_light1_projection",e,!1,n.program)):(n.program=n.compileShaders(f.default,h.default),n.bindProgram()),n.normal=new y.default("a_normal",e,!0,n.program),n.position=new y.default("a_position",e,!0,n.program),n.textureCoords=new y.default("a_texture_coords",e,!0,n.program),n.projMtrx=new y.default("u_projection",e,!1,n.program),n.viewMtrx=new y.default("u_view",e,!1,n.program),n.modelMtrx=new y.default("u_model",e,!1,n.program),n.tex2DSampler=new y.default("texture",e,!1,n.program),n.light1Pos=new y.default("u_light1_pos",e,!1,n.program),n.light1Intensities=new y.default("u_light1_intensities",e,!1,n.program),n.light1Attenu=new y.default("u_light1_attenuation",e,!1,n.program),n.light1AmbCoeff=new y.default("u_light1_ambient_coefficient",e,!1,n.program),n.isShadowEnabled&&n.initShadowProgram(),n}return i(e,t),e.prototype.initShadowProgram=function(){var t=this.ctx;this.shadowProgram=this.compileShaders(s.default,a.default),this.bindShadowProgram(),this.shadowPos=new y.default("a_position",t,!0,this.shadowProgram),this.shadowProjection=new y.default("u_projection",t,!1,this.shadowProgram),this.shadowView=new y.default("u_view",t,!1,this.shadowProgram),this.shadowModel=new y.default("u_model",t,!1,this.shadowProgram),this.shadowFramebuffer=t.createFramebuffer(),this.createDepthTexture(),this.shadowRenderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.shadowRenderBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.shadowDepthTextureSize,this.shadowDepthTextureSize),t.bindFramebuffer(t.FRAMEBUFFER,this.shadowFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.shadowDepthTexture,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.shadowRenderBuffer),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},e.prototype.createDepthTexture=function(){var t=this.ctx;this.shadowTextureUnit=d.default.textureCount,t.activeTexture(t.TEXTURE0+this.shadowTextureUnit),d.default.textureCount+=1,this.shadowDepthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.shadowDepthTexture),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.shadowDepthTextureSize,this.shadowDepthTextureSize,0,t.RGBA,t.UNSIGNED_BYTE,null)},e.prototype.bindShadowProgram=function(){this._bindProgram(this.shadowProgram)},e.prototype.bindProgram=function(){this._bindProgram(this.program)},e.prototype.unbindProgram=function(){this._unbindProgram()},e.prototype.unbindShadowProgram=function(){},e.prototype.enableAttribPointers=function(){var t=this.ctx;t.enableVertexAttribArray(this.position.ref),t.enableVertexAttribArray(this.textureCoords.ref),t.enableVertexAttribArray(this.normal.ref)},e.prototype.bindAttributePointers=function(){this.enableAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.position.ref,3,t.FLOAT,!1,32,0),t.vertexAttribPointer(this.normal.ref,3,t.FLOAT,!0,32,12),t.vertexAttribPointer(this.textureCoords.ref,2,t.FLOAT,!0,32,24)},e.prototype.enableShadowAttribPointers=function(){this.ctx.enableVertexAttribArray(this.shadowPos.ref)},e.prototype.bindShadowAttributePointers=function(){this.enableShadowAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.shadowPos.ref,3,t.FLOAT,!1,32,0)},e.prototype.glSetShadowModelMatrix=function(t){this.ctx.uniformMatrix4fv(this.shadowModel.ref,!1,t)},e.prototype.unbindShadowAttributePointers=function(){this.ctx.disableVertexAttribArray(this.shadowPos.ref)},e.prototype.setLight=function(t,e){this.light=t;var n=t.lookAt();this.bindProgram();var r=this.ctx;if(r.uniform3fv(this.light1Pos.ref,t.pos),r.uniform3fv(this.light1Intensities.ref,t.in),r.uniform1f(this.light1AmbCoeff.ref,t.ambientCoeff),r.uniform1f(this.light1Attenu.ref,t.attenuation),this.isShadowEnabled){var i=l.mat4.frustum(l.mat4.create(),-1*e.aspect,1*e.aspect,-1*e.aspect,1*e.aspect,1,l.vec3.squaredDistance(t.posVec(),t.atVec()));r.uniformMatrix4fv(this.light1View.ref,!1,n),r.uniformMatrix4fv(this.light1Projection.ref,!1,i),this.bindShadowProgram(),r.uniformMatrix4fv(this.shadowView.ref,!1,n),r.uniformMatrix4fv(this.shadowProjection.ref,!1,i)}},e.prototype.prepareShadowTexture=function(){var t=this.ctx;t.activeTexture(t.TEXTURE0+this.shadowTextureUnit),t.bindTexture(t.TEXTURE_2D,this.shadowDepthTexture),t.bindRenderbuffer(t.RENDERBUFFER,this.shadowRenderBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.shadowFramebuffer),t.viewport(0,0,this.shadowDepthTextureSize,this.shadowDepthTextureSize),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.arrayBuffer.bind(t),this.bindShadowAttributePointers(),this.bindShadowProgram()},e.prototype.revertShadowTexture=function(){var t=this.ctx;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),this.arrayBuffer.unbind(t),this.unbindShadowAttributePointers(),this.unbindShadowProgram()},e.prototype.bindShadowTexture=function(){this.bindProgram(),this.ctx.uniform1i(this.shadowMap.ref,this.shadowTextureUnit)},e.prototype.unbindAttributePointers=function(){var t=this.ctx;t.disableVertexAttribArray(this.position.ref),t.disableVertexAttribArray(this.textureCoords.ref),t.disableVertexAttribArray(this.normal.ref)},e.prototype.glSetViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.viewMtrx.ref,!1,t)},e.prototype.glSetProjectMatrix=function(t){this.ctx.uniformMatrix4fv(this.projMtrx.ref,!1,t)},e.prototype.glSetModelViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.modelMtrx.ref,!1,t)},e.prototype.bindTexture=function(t){t.bindTexture(this.ctx,this.tex2DSampler.ref)},e.DRAW_VERTEX_SIZE=8,e}(o.default);e.default=v},5692:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=t.call(this)||this;return e.entities=[],e.deferred=[],e.isLoaded=!1,e}return i(e,t),e.prototype.addEntity=function(t){this.entities.push(t)},e.prototype.event=function(t){for(var e=0;e<this.entities.length;e++)this.entities[e].event(t,this.engineHelper)},e.prototype.loadTexture=function(t){this.isLoaded?t():this.deferred.push(t)},e.prototype.init=function(){for(var t=0;t<this.entities.length;t++)this.entities[t].init(this.engineHelper);this.deferred.forEach(function(t){return t()}),this.isLoaded=!0},e}(n(2223).default);e.default=o},5854:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(8108),a=n(9727),s=n(3893),u=n(6050),c=n(1883),h=function(t){function e(e,n){var r=t.call(this)||this;return r.vertexModel=(new u.default).fillRenderUnits(c.default.vertex.planeXYColour(n)),r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(t){var e=new o.default;e.renderType=o.RenderType.TRIANGLE,e.shaderType=o.ShaderType.COLOUR,this.shaderEntity=new s.default(t).addBuffer(this.vertexModel).build(this,e)},e}(a.default);e.default=h},5884:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump float;\nprecision mediump int;\nvarying vec2 v_texture_coords;\nuniform sampler2D texture;\nvoid main(void) {\n  vec4 texel = texture2D(texture, v_texture_coords);\n  gl_FragColor = texel;\n}\n"},6050:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7435),a=n(5278),s=n(3968),u=n(1883),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.createRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t;e++)this.renderUnits.push(new o.ColourRenderUnit);return this},e.prototype.fillRenderUnits=function(t){this.renderUnits=[];for(var e=0;e<t.length;e+=7){var n=new o.ColourRenderUnit;n.vertex.x=t[e],n.vertex.y=t[e+1],n.vertex.z=t[e+2],n.colour.r=t[e+3],n.colour.g=t[e+4],n.colour.b=t[e+5],n.colour.a=t[e+6],this.renderUnits.push(n)}return this},e.prototype.createModel=function(){var t=new s.default;return t.vertices=u.default.vertex.toColourArray(this.renderUnits),t},e}(a.default);e.default=c},6126:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump int;\nprecision mediump float;\n\nattribute vec3 a_position;\nattribute vec2 a_texture_coords;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_model;\nvarying vec2 v_texture_coords;\n\nvoid main(void) {\n  v_texture_coords = a_texture_coords;\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);\n}\n"},6276:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n,r,i,o,a){var s=t.call(this,e,n,r)||this;return s.x=e,s.y=n,s.z=r,s.width=i,s.height=o,s.length=a,s}return i(e,t),e.prototype.center=function(){return this.centre&&this.equalCenter(this.centre)||(this.centre=this.newCenter()),this.centre},e.prototype.equal=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.width===this.width&&t.height===this.height&&t.length===this.length},e.prototype.equalCenter=function(t){return t.x===this.x+this.width/2&&t.y===this.y+this.height/2&&t.z===this.z+this.length/2&&t.width===this.width&&t.height===this.height&&t.length===this.length},e.prototype.newCenter=function(){return new e(this.x+this.width/2,this.y+this.height/2,this.z+this.length/2,this.width,this.height,this.length)},e}(n(9979).default);e.default=o},6352:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump float;\nprecision mediump int;\n\nvarying vec2 v_texture_coords;\nuniform sampler2D texture;\n\nvoid main(void) {\n  vec4 texel = texture2D(texture, v_texture_coords);\n  gl_FragColor = texel;\n}\n"},6373:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump float;\n\nvec4 packDepthToRGBA(const float v) {\n  const float PackUpscale = 256. / 255.;\n  const vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n  const float ShiftRight8 = 1. / 256.;\n\n  vec4 r = vec4(fract(v * PackFactors), v);\n  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n  return r * PackUpscale;\n}\n\nvoid main(void) {\n  gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n}\n"},6525:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3893),a=n(8108),s=function(t){function e(e,n){var r=t.call(this)||this;return r.renderType=a.RenderType.TRIANGLE,r.vertexModel=n,r.centerRect(e),r.rotateOriginRect(e),r.scaleRect(e),r}return i(e,t),e.prototype.setRenderType=function(t){this.renderType=t},e.prototype.init=function(t){var e=new a.default;e.renderType=this.renderType,e.shaderType=a.ShaderType.THREE_DIMENSION,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).createTexture(this.vertexModel.textureSource).build(this,e)},e}(n(9727).default);e.default=s},6732:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump int;\nprecision mediump float;\n\nattribute vec3 a_position;\nattribute vec2 a_texture_coords;\nattribute vec3 a_normal;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_model;\n\nuniform vec3 u_light1_pos;\nuniform vec3 u_light1_intensities;\nuniform float u_light1_attenuation;\nuniform float u_light1_ambient_coefficient;\nuniform mat4 u_light1_view;\nuniform mat4 u_light1_projection;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying mat4 v_model;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_attenuation;\nvarying float v_light1_ambient_coefficient;\n\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\nvarying vec4 v_shadow_pos;\n\nstruct Light {\n  vec3 position;\n  vec3 intensities;\n  float ambientCoefficient;\n  float attenuation;\n};\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n    m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n    m[0][1], m[1][1], m[2][1],\n    m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n    m[0][1], m[1][1], m[2][1], m[3][1],\n    m[0][2], m[1][2], m[2][2], m[3][2],\n    m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1], -m[0][1],\n    -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n  a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n    a11 * b11 - a12 * b10 + a13 * b09,\n    a02 * b10 - a01 * b11 - a03 * b09,\n    a31 * b05 - a32 * b04 + a33 * b03,\n    a22 * b04 - a21 * b05 - a23 * b03,\n    a12 * b08 - a10 * b11 - a13 * b07,\n    a00 * b11 - a02 * b08 + a03 * b07,\n    a32 * b02 - a30 * b05 - a33 * b01,\n    a20 * b05 - a22 * b02 + a23 * b01,\n    a10 * b10 - a11 * b08 + a13 * b06,\n    a01 * b08 - a00 * b10 - a03 * b06,\n    a30 * b04 - a31 * b02 + a33 * b00,\n    a21 * b02 - a20 * b04 - a23 * b00,\n    a11 * b07 - a10 * b09 - a12 * b06,\n    a00 * b09 - a01 * b07 + a02 * b06,\n    a31 * b01 - a30 * b03 - a32 * b00,\n    a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nconst mat4 norm_shadow_coords = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);\n\nvoid main(void) {\n\n  v_texture_coords = a_texture_coords;\n  v_position = a_position;\n  v_normal = a_normal;\n  v_model = u_model;\n\n  v_light1_pos = u_light1_pos;\n  v_light1_intensities = u_light1_intensities;\n  v_light1_attenuation = u_light1_attenuation;\n  v_light1_ambient_coefficient = u_light1_ambient_coefficient;\n\n  Light light1;\n  light1.intensities = v_light1_intensities;\n  light1.position = v_light1_pos;\n  light1.attenuation = v_light1_attenuation;\n  light1.ambientCoefficient = v_light1_ambient_coefficient;\n\n  vec3 surfacePos = vec3(v_model * vec4(v_position, 1));\n\n  mat3 normalMatrix = transpose(inverse(mat3(v_model)));\n  vec3 normal = normalize(normalMatrix * v_normal);\n\n  vec3 fragPosition = vec3(v_model * vec4(v_position, 1));\n\n  vec3 surfaceToLight = light1.position - fragPosition;\n\n  float brightness = dot(normal, surfaceToLight) / (length(surfaceToLight) * length(normal));\n  if (brightness > 1.0) {\n    brightness = 1.0;\n  } else if (brightness < 0.0) {\n    brightness = 0.0;\n  }\n\n  float distanceToLight = length(light1.position - surfacePos);\n\n  v_diffuseCoefficient = max(0.0, dot(normal, surfaceToLight));\n  v_attenuation = 1.0 / (1.0 + light1.attenuation * pow(distanceToLight, 2.0));\n  v_shadow_pos = norm_shadow_coords * u_light1_projection * u_light1_view * u_model * vec4(a_position, 1.0);\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);\n}\n"},6945:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(1656),i=function(){function t(t){this.pos=t.pos,this.in=t.in,this.attenuation=t.attenuation,this.ambientCoeff=t.ambientCoeff,this.at=t.at}return t.prototype.vecZero=function(t){return r.vec3.equals(t,r.vec3.fromValues(0,0,0))},t.prototype.parellelVec=function(t,e){return!0!==this.vecZero(t)&&!0!==this.vecZero(e)&&!0===r.vec3.equals(r.vec3.normalize(r.vec3.create(),t),r.vec3.normalize(r.vec3.create(),e))},t.prototype.perpVec=function(t){var e=r.vec3.fromValues(1,0,0);return!0===this.parellelVec(t,e)&&(e=r.vec3.fromValues(0,0,1)),e},t.prototype.posVec=function(){return r.vec3.fromValues(this.pos[0],this.pos[1],this.pos[2])},t.prototype.atVec=function(){return r.vec3.fromValues(this.at[0],this.at[1],this.at[2])},t.prototype.lookAt=function(){var t=this.posVec(),e=this.atVec(),n=e,i=t;return!0===this.parellelVec(t,e)?n=this.perpVec(t):(!0===this.vecZero(t)&&(i=this.perpVec(e)),!0===this.vecZero(e)&&(n=this.perpVec(t))),this.up=r.vec3.cross(r.vec3.create(),i,n),r.mat4.lookAt(r.mat4.create(),t,e,this.up)},t}();e.default=i},7103:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AppSubscription=e.WebGLContainer=void 0;var r=n(7141),i=n(8801),o=n(7725),a=n(1580),s=n(8495),u=n(9661),c=n(5038),h=n(4494),f=function(){function t(t,e,n,r){this.aspectRatio=n,this.canvas=document.createElement("canvas"),this.canvas.id=t||"app",this.canvas.addEventListener("webglcontextlost",function(t){return t.preventDefault()},!1),this.canvas.addEventListener("webglcontextrestored",r,!1),e.appendChild(this.canvas)}return t.prototype.delete=function(){this.canvas.style.display="none",this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},t.prototype.resize=function(t){var e=t.offsetWidth,n=e/this.getAspectRatio();this.canvas.width=e*window.devicePixelRatio,this.canvas.height=n*window.devicePixelRatio,this.canvas.style.height="".concat(n,"px"),this.canvas.style.width="".concat(e,"px")},t.prototype.getAspectRatio=function(){var t=this.aspectRatio;return t||(t=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)/(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)),t},t.prototype.getCtx=function(){var t=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");if(!t)throw new Error("WebGL not avaliable");return t},t}();e.WebGLContainer=f;var p=function(){function t(){}return t.START_ITERATION=new h.Subscription("App#StartIteration"),t.GET_FPS=new h.Subscription("App#GetFPS"),t}();e.AppSubscription=p;var l=function(){function t(t){var e=this;if(this.ready=!1,this.isPaused=!0,this.frameTime=0,this.framesElapsed=0,this.setup=function(){var t=e.args;e.timer=new u.default,e.camera=new r.default,e.updater=new i.default(t),e.renderer=new o.default(t,e.webGLContainer,e.camera,e.notificationQueue,e.subscriberPool),e.camera.setupCamera(t.camera,e.webGLContainer.canvas),e.engineHelper=new a.default(e.notificationQueue,e.subscriberPool,e.camera),e.world=e.args.world,e.world.setEngineHelper(e.engineHelper)},this.onEvent=function(t){t.eventType===s.default.RESIZE&&e.resizeScreen(),e.world.event(t)},this.destroy=function(){clearInterval(e.interval),e.renderer.delete(),e.webGLContainer.delete()},this.animationFrame=function(){if(e.ready)try{e.updater.update(e.timer.peak(),e.engineHelper),e.renderer.render(e.timer.peak(),e.engineHelper),e.notifyFrames(),e.timer.start()}catch(t){console.error(t),clearInterval(e.interval),e.errorCallback&&e.errorCallback(t)}},this.startIteration=function(){return requestAnimationFrame(e.animationFrame)},this.notifyFrames=function(){e.frameTime+=e.timer.peak(),e.framesElapsed++,60===e.framesElapsed&&(e.args.subscribe&&e.args.subscribe({fps:1e3/e.frameTime*e.framesElapsed}),e.framesElapsed=0,e.frameTime=0)},this.startRunLoop=function(){e.timer.start();var t=e.fps;e.interval=setInterval(function(){e.isPaused||e.animationFrame(),e.isStepRender&&(clearInterval(e.interval),e.interval=void 0),e.fps!==t&&(clearInterval(e.interval),e.interval=void 0,e.startRunLoop())},t)},this.initSystem=function(){return e.initFont(),e.world.init(e.engineHelper),e.renderer.init(),e.engineHelper.getAllResourcesLoading()},this.loadResources=function(){return e.world.loadResources(),e.engineHelper.getAllResourcesLoading()},this.runApp=function(){e.ready=!0,e.isStepRender?e.animationFrame():e.startRunLoop()},this.onRunError=function(t){throw clearInterval(e.interval),console.error(t),t},this.run=function(){console.log("Running",e);var t=new Date;return e.loadResources().then(e.initSystem).then(function(){return e.renderer.bindBuffer()}).then(e.runApp).then(function(){return console.log("startup time: ".concat(new Date-t))}).catch(e.onRunError)},this.resizeCanvas=function(t){e.webGLContainer.resize(t)},this.resizeScreen=function(){var t=document.getElementById(e.args.elementId);e.resizeCanvas(t),e.camera.setupCamera(e.args.camera,e.webGLContainer.canvas),e.notificationQueue.push(o.RendererNotification.RESIZE_SCREEN),e.isStepRender&&e.ready&&e.animationFrame()},this.buildCanvas=function(t){if(!e.webGLContainer){var n=document.body;t.elementId&&(n=document.getElementById(t.elementId)),e.webGLContainer=new f(t.canvasId,n,t.aspectRatio,e.setup),e.resizeCanvas(n)}},this.reset=function(){e.world?e.world.reset():console.error("Game Delegate not ready to call reset")},this.toggleShow=function(){e.isVisible?e.hide():e.show()},this.show=function(){e.webGLContainer.canvas.style.display="initial",e.resizeScreen(),e.isVisible=!0},this.hide=function(){e.webGLContainer.canvas.style.display="none",e.isVisible=!1},this.togglePause=function(){e.isPaused=!e.isPaused},this.pause=function(){e.isPaused=!0},this.unpause=function(){e.isPaused=!1},!t)throw new Error("no args passed into App");this.notificationQueue=new c.default,this.subscriberPool=new h.default,this.subscriberPool.listen(p.START_ITERATION,this.startIteration),this.args=t,this.buildCanvas(t),this.isStepRender=t.isStepRender||!1,s.event.bind(this.onEvent,this.webGLContainer),s.event.setThrottle(t.eventThrottle||40),this.errorCallback=t.error,this.setup(),this.setFPS(t.fps)}return t.prototype.setFPS=function(t){this.fps=1e3/t||1e3/30,this.subscriberPool.publish(p.GET_FPS,this.fps)},t.prototype.toggleStepRender=function(t){void 0===t&&(t=!this.isStepRender),this.isStepRender=t,this.isStepRender||this.interval||this.startRunLoop()},t.prototype.initFont=function(){this.engineHelper.initFont()},t}();e.default=l},7141:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.BaseCamera=void 0;var o=n(1656),a=n(4686),s=n(9979),u=n(9661),c=n(3765),h=n(3207),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isUpdateView=!0,e.timer=new u.default,e.updateProjectionView=function(){e._isUpdateView=!0},e.commitProjectionView=function(){e._isUpdateView=!1;var t=o.quat.create();t=o.quat.rotateX(t,t,e.degreesToRadians(e.position.ax)),t=o.quat.rotateY(t,t,e.degreesToRadians(e.position.ay)),t=o.quat.rotateZ(t,t,e.degreesToRadians(e.position.az)),t=o.quat.normalize(t,t);var n=o.mat4.create(),r=o.mat4.create();o.mat4.fromQuat(r,t),o.mat4.multiply(n,n,r);var i=o.vec3.fromValues(-e.position.x,-e.position.y,-e.position.z);o.mat4.translate(n,n,i),e.viewMatrix=n},e.perspective=function(){return o.mat4.perspective(o.mat4.create(),e.degreesToRadians(e.fov),e.aspect,e.near,e.far)},e.updateProjectionMatrix=function(){e.frustum=e.perspective()},e}return i(e,t),e.prototype.clearPan=function(){this.interval&&(clearInterval(this.interval),this.interval=void 0)},e.prototype.pan=function(t,e,n,r,i){var o=this;this.interval&&(clearInterval(this.interval),this.interval=void 0),this.steps=t,this._moveTime=t,void 0!==n?(this.dx=n-this.position.x,this.tx=n):(this.dx=0,this.tx=this.position.x),void 0!==r?(this.dy=r-this.position.y,this.ty=r):(this.dy=0,this.ty=this.position.y),void 0!==i?(this.dz=i-this.position.z,this.tz=i):(this.dz=0,this.tz=this.position.z),this.timer.start(),this.interval=setInterval(function(){var t=o.timer.peak();o.steps>0?(o.steps-=t,o.steps<=0?(o.position.x=o.tx,o.position.y=o.ty,o.position.z=o.tz,o.interval&&(clearInterval(o.interval),o.interval=void 0)):(o.position.x+=o.dx*t/o._moveTime,o.position.y+=o.dy*t/o._moveTime,o.position.z+=o.dz*t/o._moveTime),o.updateProjectionView()):(o.position.x=o.tx,o.position.y=o.ty,o.position.z=o.tz,o.interval&&(clearInterval(o.interval),o.interval=void 0),o.updateProjectionView()),o.timer.start()},e)},e.prototype.isOutOfBound=function(t,e){return!1},e.prototype.isUpdateView=function(){return this._isUpdateView},e.prototype.angleX=function(t){if(this.position.ax-=t,this.position.ax>90){var e=90;this.position.ax=e}else this.position.ax<-90&&(e=-90,this.position.ax=e)},e.prototype.angleZ=function(t){if(this.position.az+=t,this.position.az>360){var e=this.position.az-360;this.position.az=e}else this.position.az<0&&(e=this.position.az+360,this.position.az=e)},e.prototype.angleY=function(t){if(this.position.ay+=t,this.position.ay>360){var e=this.position.ay-360;this.position.ay=e}else this.position.ay<0&&(e=this.position.ay+360,this.position.ay=e)},e.prototype.zoomIn=function(t){this.fov-=t,this.fov=Math.max(t,this.fov),this.updateProjectionMatrix()},e.prototype.zoomOut=function(t){var e=360*Math.atan(1/this.aspect)/Math.PI;this.fov+=t,this.fov=Math.min(Math.min(this.cameraOptions.maxFov||e,e),this.fov),this.updateProjectionMatrix()},e.prototype.setupCamera=function(t,e){this.cameraOptions=t||{};var n=this.near||t.near||1,r=this.far||t.far||4,i=t.aspect||e.width/e.height,o=this.fov||t.fov||45;t.isFovMax&&(o=360*Math.atan(1/i)/Math.PI),this.aspect=i,this.fov=o,this.near=n,this.far=r,this.updateProjectionMatrix(),this.updateProjectionView()},e}(a.default);e.BaseCamera=f;var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.pan=function(n,r,i,o){t.prototype.pan.call(this,n,e.INTERVAL_TIME,r,i,o)},e.INTERVAL_TIME=10,e}(f),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.zoomScale=2,e.bound=new c.default(0,0,1,1),e.perspective=function(){var t=o.mat4.create();return o.mat4.translate(t,t,o.vec3.fromValues(-1,-1,0)),o.mat4.scale(t,t,o.vec3.fromValues(e.zoomScale,e.zoomScale,1)),t},e}return i(e,t),e.prototype.distanceEvent=function(t){return new s.default(t.x+this.position.x,this.position.y+t.y)},e.prototype.zoomIn=function(t){this.zoomScale+=t,this.updateProjectionMatrix()},e.prototype.zoomOut=function(t){this.zoomScale=Math.max(.1,this.zoomScale-t),this.updateProjectionMatrix()},e.prototype.isOutOfBound=function(t){return this.bound.x=this.position.x,this.bound.y=this.position.y,!h.CollisionDetection.isRectInRect(this.bound,t)},e.prototype.pan=function(n,r,i){t.prototype.pan.call(this,n,e.INTERVAL_TIME,r,i)},e.INTERVAL_TIME=10,e}(f),d=function(){function t(){this.camera3d=new p,this.camera2d=new l}return t.prototype.setupCamera=function(t,e){this.camera3d.setupCamera(t,e),this.camera2d.setupCamera(t,e),this.height=e.height,this.width=e.width},t.prototype.commitProjectionView=function(){this.camera3d.isUpdateView()&&this.camera3d.commitProjectionView(),this.camera2d.isUpdateView()&&this.camera2d.commitProjectionView()},t}();e.default=d},7226:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nattribute vec3 a_position;\nattribute vec2 a_texture_coords;\nvarying vec2 v_texture_coords;\nuniform mat4 u_model;\nuniform mat4 u_view;\nuniform mat4 u_projection;\n\nvoid main(void) {\n  v_texture_coords = a_texture_coords;\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1);\n}\n"},7285:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.ctx=t}return t.prototype.compileShaders=function(t,e){var n=this.ctx,r=n.createShader(n.VERTEX_SHADER),i=n.createShader(n.FRAGMENT_SHADER);if(!r||!i)throw new Error("Unable to create vertex or fragment shader");var o=e,a=t;n.shaderSource(r,a),n.compileShader(r),n.shaderSource(i,o),n.compileShader(i);var s=n.getShaderParameter(r,n.COMPILE_STATUS);if(!s)throw new Error("could not compile vertex shader:"+n.getShaderInfoLog(r));if(s=null,!(s=n.getShaderParameter(i,n.COMPILE_STATUS)))throw new Error("could not compile fragment shader:"+n.getShaderInfoLog(i));var u=n.createProgram();if(n.attachShader(u,r),n.attachShader(u,i),n.linkProgram(u),s=null,!(s=n.getProgramParameter(u,n.LINK_STATUS)))throw new Error("program create failed:"+n.getProgramInfoLog(u));return u},t.prototype.delete=function(){this.ctx.deleteProgram(this.program)},t.prototype._bindProgram=function(t){this.ctx.useProgram(t)},t.prototype._unbindProgram=function(){},t}();e.default=n},7310:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7970),a=n(5854),s=function(t){function e(e,n,r){var i=t.call(this)||this;return i.setRect(e),i.background=n,i.bar=r,i}return i(e,t),e.prototype.setProgress=function(t){this.percent=t},e.prototype.init=function(e){this.powerMaxBar=new a.default(this.position,this.background),this.entities.push(this.powerMaxBar),this.powerBar=new a.default(this.position,this.bar),this.entities.push(this.powerBar),t.prototype.initEntity.call(this,e)},e.prototype.render=function(e){this.powerBar.scaleX(Math.max(0,this.percent*this.powerMaxBar.position.width/100)),t.prototype.render.call(this,e)},e.prototype.update=function(e){this.powerBar.setTop(this.isTop),this.powerMaxBar.setTop(this.isTop),t.prototype.update.call(this,e)},e}(o.default);e.default=s},7327:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(4032);e.default=r.default},7435:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.ColourRenderUnit=e.TextureRenderUnit=e.RenderUnit=e.Colour=e.TextureUnit=void 0;var o=n(9979),a=function(){this.u=0,this.v=0};e.TextureUnit=a;var s=function(){this.r=0,this.g=0,this.b=0,this.a=0};e.Colour=s;var u=function(){this.vertex=new o.default(0,0,0)};e.RenderUnit=u;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.texture=new a,e.normal=new o.default(0,0,0),e}return i(e,t),e}(u);e.TextureRenderUnit=c;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colour=new s,e}return i(e,t),e}(u);e.ColourRenderUnit=h},7725:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RendererNotification=e.RendererSubscription=void 0;var r=n(8108),i=n(8808),o=n(1207),a=n(3463),s=n(2344),u=n(9148),c=n(3676),h=n(5038),f=n(4494),p=function(){function t(){}return t.CREATE_TEXTURE=new f.Subscription("Renderer#CreateTexture"),t.REGISTER_ENTITY=new f.Subscription("Renderer#RegisterEntity"),t.createTexturePayload=function(t,e){return[t,e]},t.registerEntityPayload=function(t,e){return[t,e]},t}();e.RendererSubscription=p;var l=function(){function t(){}return t.NOTIFICATION_PRE_RENDER_KEY="Renderer#Prerender",t.NOTIFICATION_RENDER_KEY="Renderer#Render",t.NOTIFICATION_INIT_KEY="Renderer#Init",t.UPDATE_PROJECTION_MATRIX=new h.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"UPDATE_PROJECTION_MATRIX"),t.RESIZE_SCREEN=new h.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"RESIZE_SCREEN"),t.CREATE_TEXTURE=new h.Notification(t.NOTIFICATION_INIT_KEY,"CREATE_TEXTURE"),t.REGISTER_ENTITY=new h.Notification(t.NOTIFICATION_INIT_KEY,"REGISTER_ENTITY"),t.registerEntity=function(e,n){return h.NotificationPayload.from(t.REGISTER_ENTITY,[e,n])},t.UPDATE_BUFFER=new h.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"UPDATE_BUFFER"),t.updateBuffer=function(e,n){return h.NotificationPayload.from(t.UPDATE_BUFFER,[e,n])},t.createTexture=function(e,n){return h.NotificationPayload.from(t.CREATE_TEXTURE,[e,n])},t.SET_LIGHTING=new h.Notification(t.NOTIFICATION_PRE_RENDER_KEY,"SET_LIGHTING"),t.setLighting=function(e){return h.NotificationPayload.from(t.SET_LIGHTING,[e])},t.RENDER_ENTITY=new h.Notification(t.NOTIFICATION_RENDER_KEY,"RENDER_ENTITY"),t.renderEntity=function(e,n){return h.NotificationPayload.from(t.RENDER_ENTITY,[e,n])},t}();e.RendererNotification=l;var d=function(){function t(t,e,n,i,o){var a=this;if(this.textureReg={},this._renderEntities={},this.cachedModelData={},this.resizeViewPort=function(){a.glContext.resizeViewPort(a.webGLContainer.canvas)},this.updatePerspective=function(){a.shader3DProgram&&a.shader3DProgram.updatePerspective(a.camera.camera3d.frustum),a.shaderBasicProgram&&a.shaderBasicProgram.updatePerspective(a.camera.camera3d.frustum),a.shader2DProgram&&a.shader2DProgram.updatePerspective(a.camera.camera2d.frustum),a.shaderColourProgram&&a.shaderColourProgram.updatePerspective(a.camera.camera2d.frustum)},this.delete=function(){Object.values(a.textureReg).forEach(function(t){var e=t.texture;e.texture&&a.glContext.deleteTexture(e.texture),e.texture=void 0,e.texUnit=void 0}),c.default.textureCount=0,a.shader3DProgram&&a.shader3DProgram.delete(),a.shaderBasicProgram&&a.shaderBasicProgram.delete(),a.shader2DProgram&&a.shader2DProgram.delete(),a.shaderColourProgram&&a.shaderColourProgram.delete(),a.glContext.destroyWebGL()},this.setLighting=function(t){if(!a.shader3DProgram)throw new Error("Lighting is set without any 3D entities");a.shader3DProgram.setLight(t,a.camera.camera3d)},this.updateBuffer=function(t,e){var n=t.getOpt();a._getProgramOpt(n).updateBuffer(t,e)},this._getProgram3D=function(t){return a._isPlain(t)?a.shaderBasicProgram:a.shader3DProgram},this._getProgramOpt=function(t){var e;if(r.ShaderType.COLOUR===t.shaderType)e=a.shaderColourProgram;else if(r.ShaderType.THREE_DIMENSION===t.shaderType)e=a._getProgram3D(t);else{if(r.ShaderType.TWO_DIMENSION!==t.shaderType)throw new Error("unsupported opt shader type");e=a.shader2DProgram}return e},this._defRender=function(){a._defRenderTop(!1),a._defRenderTop(!0)},this._render=function(t,e){if(!t.hidden){var n=t.getOpt(),i=[t,e];r.ShaderType.COLOUR===n.shaderType?a._renderEntities[r.ShaderType.COLOUR].push(i):r.ShaderType.THREE_DIMENSION===n.shaderType?a._isPlain(n)?a._renderEntities[r.ShaderType.THREE_DIMENSION|r.RenderType.PLAIN].push(i):a._renderEntities[r.ShaderType.THREE_DIMENSION].push(i):r.ShaderType.TWO_DIMENSION===n.shaderType&&a._renderEntities[r.ShaderType.TWO_DIMENSION].push(i)}},this.bindBuffer=function(){a.shader2DProgram&&a.shader2DProgram.bindBuffer(),a.shaderColourProgram&&a.shaderColourProgram.bindBuffer(),a.shader3DProgram&&a.shader3DProgram.bindBuffer(),a.shaderBasicProgram&&a.shaderBasicProgram.bindBuffer()},this._resetDefferred=function(){a._renderEntities={},a._renderEntities[r.ShaderType.COLOUR]=[],a._renderEntities[r.ShaderType.TWO_DIMENSION]=[],a._renderEntities[r.ShaderType.THREE_DIMENSION]=[],a._renderEntities[r.ShaderType.THREE_DIMENSION|r.RenderType.PLAIN]=[]},this.handleNotification=function(t){var e=!1;switch(t.action){case l.RENDER_ENTITY.action:a._render(t.data[0],t.data[1]);break;case l.UPDATE_PROJECTION_MATRIX.action:e=!0;break;case l.RESIZE_SCREEN.action:a.resizeViewPort(),e=!0;break;case l.CREATE_TEXTURE.action:a.createTexture(t.data[0],t.data[1]);break;case l.UPDATE_BUFFER.action:a.updateBuffer(t.data[0],t.data[1]);break;case l.REGISTER_ENTITY.action:a.registerEntity(t.data[0],t.data[1]);break;case l.SET_LIGHTING.action:a.setLighting(t.data[0]);break;default:console.error("unhandled notification: ",t)}e&&a.updatePerspective()},!t.world)throw new Error("world not defined");this.notificationQueue=i,this.subscriberPool=o,this.camera=n,this.world=t.world,this.webGLContainer=e,this.ctx=this.webGLContainer.getCtx(),this.glContext=new u.default(this.ctx),this.glContext.setupDefault(),this.subscriberPool.listen(p.CREATE_TEXTURE,function(t){var e=t[0],n=t[1];a.createTexture(e,n)}),this.subscriberPool.listen(p.REGISTER_ENTITY,function(t){var e=t[0],n=t[1];a.registerEntity(e,n)})}return t.prototype._isPlain=function(t){return t.renderType===r.RenderType.PLAIN},t.prototype._defRenderTop=function(t){var e=this._renderEntities[r.ShaderType.THREE_DIMENSION].filter(function(e){return!!e[0].isTop===t});e.length>0&&(this.shader3DProgram.render3DShadowMap(e,this.resizeViewPort),this.shader3DProgram.render(e,this.camera.camera3d,this.textureReg));var n=this._renderEntities[r.ShaderType.THREE_DIMENSION|r.RenderType.PLAIN].filter(function(e){return!!e[0].isTop===t});n.length>0&&this.shaderBasicProgram.render(n,this.camera.camera3d,this.textureReg);var i=this._renderEntities[r.ShaderType.COLOUR].filter(function(e){return!!e[0].isTop===t});i.length>0&&this.shaderColourProgram.render(i,this.camera.camera2d);var o=this._renderEntities[r.ShaderType.TWO_DIMENSION].filter(function(e){return!!e[0].isTop===t});o.length>0&&this.shader2DProgram.render(o,this.camera.camera2d,this.textureReg)},t.prototype.init=function(){this.readMessages(l.NOTIFICATION_INIT_KEY)},t.prototype.readMessages=function(t,e){var n;void 0===e&&(e=!1);for(var r={};n=this.notificationQueue.take(t);)e&&void 0!==r[n.action]||(this.handleNotification(n),e&&(r[n.action]=!0))},t.prototype._lazyLoadProgram=function(t){if(r.ShaderType.COLOUR===t.shaderType)this.shaderColourProgram||(this.shaderColourProgram=new s.default(this.ctx));else if(r.ShaderType.THREE_DIMENSION===t.shaderType)this._isPlain(t)&&!this.shaderBasicProgram?this.shaderBasicProgram=new o.default(this.ctx):this.shader3DProgram||(this.shader3DProgram=new i.default(this.ctx));else{if(r.ShaderType.TWO_DIMENSION!==t.shaderType)throw console.error(this,t),new Error("unsupported opt shader type");this.shader2DProgram||(this.shader2DProgram=new a.default(this.ctx))}this.updatePerspective()},t.prototype.registerEntity=function(t,e){var n=t.getOpt();this._lazyLoadProgram(n);var r=this._getProgramOpt(n);this.cachedModelData[e.$id]?t.rendererBufferId=this.cachedModelData[e.$id]:(r.registerEntity(t,e.vertices),this.cachedModelData[e.$id]=t.rendererBufferId)},t.prototype.render=function(t,e){this.glContext.clear(),this.readMessages(l.NOTIFICATION_PRE_RENDER_KEY,!0),this.camera.commitProjectionView(),e.setTime(t),this._resetDefferred(),this.world.render(),e.renderFont(),this.readMessages(l.NOTIFICATION_RENDER_KEY),this._defRender()},t.prototype.createTexture=function(t,e){var n=t.getTextureSource();if(void 0===n)throw console.error("src is undefined when trying to create texture",t),new Error("src is undefined when trying to create texture");t.rendererTextureRef=n;var r=this.textureReg[n];if(r){if(r.texture&&r.texture.error)throw console.error("there was an error while trying to load texture",r),new Error("there was an error while trying to load texture")}else{var i=new c.default(n,this.ctx);this.textureReg[n]={texture:i},e.push(i.load)}},t}();e.default=d},7970:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(9172),a=n(2104),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.setLayer=function(t){return this.entities.forEach(function(e){e instanceof a.default&&e.setLayer(t)}),this.position.z=-1*t,this},e.prototype.initEntity=function(e){t.prototype.initEntity.call(this,e),this.setLayer(-this.position.z)},e}(o.default);e.default=s},8108:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RenderType=e.ShaderType=void 0;var n=function(){function t(){}return t.TWO_DIMENSION=1,t.THREE_DIMENSION=2,t.COLOUR=3,t}();e.ShaderType=n;var r=function(){function t(){}return t.PLAIN=4,t.TRIANGLE=5,t.RECTANGLE=6,t}();e.RenderType=r;e.default=function(){}},8127:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump float;\nvarying vec3 v_color;\nvoid main(void) {\n  gl_FragColor = vec4(v_color, 1);\n}\n"},8136:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderEntity=void 0;var r=n(8108),i=function(){function t(){this.opt=new r.default,this.clone=!1}return t.prototype.getVertexModel=function(){return this.vertexModel},t.prototype.getVertexBufferId=function(){return this.vertexModel.vertexBufferId},t.prototype.getOpt=function(){return this.opt},t.prototype.getModel=function(){return this.model()},t.prototype.getTextureSource=function(){return this.src},t.prototype.setTextureSource=function(t){this.src=t},t.prototype.renderCopy=function(t){var e=this.shallowCopy();return e.model=t.getModel,e.modelPosition=t.getPosition,e},t.prototype.shallowCopy=function(){var e=new t;return e.opt=this.opt,e.vertexModel=this.vertexModel,e.rendererBufferId=this.rendererBufferId,e.rendererTextureRef=this.rendererTextureRef,e.src=this.src,e.isTop=this.isTop,e.hidden=this.hidden,e},t}();e.ShaderEntity=i},8227:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(4686),a=n(9515),s=n(9172),u=n(9979),c=n(3300),h=n(3765),f=function(t){function e(){var e=t.call(this)||this;return e.completeSimulation=function(){e.resetPhysics()},e.resetPhysics=function(){e.physics.t.x=e.position.x,e.physics.t.y=e.position.y,e.physics.t.z=e.position.z,e.physics.d.x=0,e.physics.d.y=0,e.physics.d.z=0,e.physics.isMoving=!1,e.physics.collisionIteration=0},e.physicSimulation=function(t,n,r){var i=e.physics;i.isMoving=!0;var o=i.v.x*n,s=i.v.y*n,u=i.v.z*n,c=e;i.collisionSize&&(i.modelPos.setRect(i.collisionSize),c=i.modelPos);var h=a.default.isCollidingOffset2d(c,o,s);e.shouldTranslate(h)?(e.translate(o,s,u),e.updateLocBoundToBoundary(),i.collisionIteration=0):(i.collisionIteration++,i.collisionIteration>i.collisionStopItThres&&(e.completeSimulation(),a.default.cancelSimulation(t)))},e.physics={t:new u.default(0,0,0),d:new u.default(0,0,0),v:new u.default(0,0,0),a:new u.default(0,0,0),modelPos:new o.default,isMoving:!1,collisionSize:void 0,bound:void 0,simulationId:void 0,jumpSimulationId:void 0,gravitySimulationId:void 0,collisionIteration:0,collisionStopItThres:5},e.isMoveable=!0,e}return i(e,t),e.prototype.updatePhysicsPosition=function(){this.physics.t.x=this.position.x,this.physics.t.y=this.position.y,this.physics.t.z=this.position.z},e.prototype.updateDeltaDistance=function(t,e,n){void 0!==t?(this.physics.d.x=t-this.position.x,this.physics.t.x=t):this.physics.d.x=this.physics.t.x-this.position.x,void 0!==e?(this.physics.d.y=e-this.position.y,this.physics.t.y=e):this.physics.d.y=this.physics.t.y-this.position.y,void 0!==n?(this.physics.d.z=n-this.position.z,this.physics.t.z=n):this.physics.d.z=this.physics.t.z-this.position.z},e.prototype.defaultUpdateLocBoundToBoundary=function(){var t=new h.default(0,0,Math.min(1-this.position.width,this.position.x),Math.min(1-this.position.height,this.position.y)),e=c.default.boundRect(t,this.position);this.center(e.x,e.y,this.position.z)},e.prototype.updateLocBoundToBoundary=function(){if(this.physics.bound){var t=c.default.boundRect(this.physics.bound,this.position);this.center(t.x,t.y,this.position.z)}else this.defaultUpdateLocBoundToBoundary()},e.prototype.calcTotalDeltaDistance=function(){return Math.sqrt(this.physics.d.x*this.physics.d.x+this.physics.d.y*this.physics.d.y+this.physics.d.z*this.physics.d.z)},e.prototype.translateTo=function(t,e,n,r,i){var o=1e-5*(this.physics.d.x<0?-1:1);this.physics.t.x+=(e||0)+o,this.physics.t.y+=n||0,this.physics.t.z+=r||0,this.moveTo(t,this.physics.t.x,this.physics.t.y,this.physics.t.z,i)},e.prototype.shouldTranslate=function(t){return 0===t.length},e.prototype.moveTo=function(t,e,n,r,i){var o=this;if(this.isMoveable){var s=this.physics;this.updateDeltaDistance(e,n,r);var u=this.calcTotalDeltaDistance()/t;s.d.x>0?this.rotateY(0):s.d.x<0&&this.rotateY(-180);var c=this.completeSimulation;i&&(c=function(){i(),o.completeSimulation()}),s.simulationId=a.default.runSimulation(u,this.moveSimulation.bind(this),c,s.simulationId)}},e.prototype.addImpulse=function(t,e){this.physics.v.x+=t.x*e,this.physics.v.y+=t.y*e},e.prototype.setVelocity=function(t){this.physics.v.x=t.x,this.physics.v.y=t.y},e.prototype.moveSimulation=function(t,e,n){if(!(Math.abs(n)<1e-5)){var r=this.physics;r.isMoving=!0;var i=e/n,o=r.d.x*i,a=r.d.y*i,s=r.d.z*i;this.translateCollision(t,o,a,s)}},e.prototype.translateCollision=function(t,e,n,r){var i=a.default.isCollidingOffset2d(this,e,n);if(this.shouldTranslate(i))this.translate(e,n,r),this.updateLocBoundToBoundary(),this.physics.collisionIteration=0;else if(this.physics.collisionIteration++,this.physics.collisionIteration>this.physics.collisionStopItThres){var o=a.default.simulations[t];(null==o?void 0:o.completeSimulation)&&o.completeSimulation(),a.default.cancelSimulation(t)}},e.prototype.setMoveable=function(t){this.isMoveable=t},e}(s.default);e.default=f},8251:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7285),a=n(6126),s=n(6352),u=n(9232),c=n(5169),h=function(t){function e(e){var n=t.call(this,e)||this;return n.arrayBuffer=new u.default(e),n.program=n.compileShaders(a.default,s.default),n.bindProgram(),n.position=new c.default("a_position",e,!0,n.program),n.textureCoords=new c.default("a_texture_coords",e,!0,n.program),n.texture=new c.default("texture",e,!1,n.program),n.projMtrx=new c.default("u_projection",e,!1,n.program),n.viewMtrx=new c.default("u_view",e,!1,n.program),n.modelMtrx=new c.default("u_model",e,!1,n.program),n}return i(e,t),e.prototype.bindProgram=function(){this._bindProgram(this.program)},e.prototype.unbindProgram=function(){this._unbindProgram()},e.prototype.enableAttribPointers=function(){var t=this.ctx;t.enableVertexAttribArray(this.position.ref),t.enableVertexAttribArray(this.textureCoords.ref)},e.prototype.bindAttributePointers=function(){this.enableAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.position.ref,3,t.FLOAT,!1,32,0),t.vertexAttribPointer(this.textureCoords.ref,2,t.FLOAT,!0,32,24)},e.prototype.unbindAttributePointers=function(){var t=this.ctx;t.disableVertexAttribArray(this.position.ref),t.disableVertexAttribArray(this.textureCoords.ref)},e.prototype.glSetViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.viewMtrx.ref,!1,t)},e.prototype.glSetProjectMatrix=function(t){this.ctx.uniformMatrix4fv(this.projMtrx.ref,!1,t)},e.prototype.glSetModelViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.modelMtrx.ref,!1,t)},e.prototype.bindTexture=function(t){t.bindTexture(this.ctx,this.texture.ref)},e.DRAW_VERTEX_SIZE=5,e}(o.default);e.default=h},8431:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5282),a=function(t){function e(e,n,r){var i=t.call(this)||this;return i.setRect(e),i.textureSource=n,i.uvs=r,i}return i(e,t),e.prototype.render=function(t){this.planes.forEach(function(e){return e.render(t)})},e.prototype.isPointInCube=function(t,e){return o.CollisionDetection.isPointInPlane3d(e.camera.camera3d,this.planes[0],t.x,t.y)||o.CollisionDetection.isPointInPlane3d(e.camera.camera3d,this.planes[1],t.x,t.y)||o.CollisionDetection.isPointInPlane3d(e.camera.camera3d,this.planes[2],t.x,t.y)||o.CollisionDetection.isPointInPlane3d(e.camera.camera3d,this.planes[3],t.x,t.y)||o.CollisionDetection.isPointInPlane3d(e.camera.camera3d,this.planes[4],t.x,t.y)||o.CollisionDetection.isPointInPlane3d(e.camera.camera3d,this.planes[5],t.x,t.y)},e.prototype.init=function(t){var e=this,n=this.position.width,r=this.position.length,i=this.position.height,a=this.position.x,s=this.position.y,u=this.position.z,c=new o.Rect3d(a,s,u,n,i,r);this.planes=[new o.Plane3d(c,t.newVertexModel(this.uvs[0],o.PlaneType.YX)),new o.Plane3d(c,t.newVertexModel(this.uvs[1],o.PlaneType.XY)),new o.Plane3d(c,t.newVertexModel(this.uvs[2],o.PlaneType.ZX)),new o.Plane3d(c,t.newVertexModel(this.uvs[3],o.PlaneType.XZ)),new o.Plane3d(c,t.newVertexModel(this.uvs[4],o.PlaneType.ZY)),new o.Plane3d(c,t.newVertexModel(this.uvs[5],o.PlaneType.YZ))],this.planes.forEach(function(t){return e.entities.push(t)}),this.scaleRect(c),this.centerRect(c),this.rotateOriginRect(c),this.planes[0].center(a,s,u+r),this.planes[1].center(a,s,u),this.planes[2].center(a,s,u),this.planes[3].center(a,s+i,u),this.planes[4].center(a+n,s,u),this.planes[5].center(a,s,u),this.rotateOriginRect(this.getRect().center()),this.initEntity(t)},e}(o.EntityManager);e.default=a},8495:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.event=void 0;var r=n(9979),i=function(){function t(){var e=this;this.eventDown=!1,this.touchDown=!1,this.eventDownX=0,this.eventDownY=0,this.eventDownDx=0,this.eventDownDy=0,this.keyDownMap={},this.prevEvent=0,this.timeStamp=0,this.prevTimeStamp=0,this.motionTimeStamp=0,this.orientationQuaternion=[0,0,0,0],this.NULL_EVENT={x:0,y:0,dx:0,dy:0,dxRaw:0,dyRaw:0,eventType:-1,prevEventType:-1,timeStamp:0,prevTimeStamp:0,orientationQuaternion:[0,0,0,0],rawEvent:void 0},this.throttle=40,this.setThrottle=function(t){t&&(e.throttle=t)},this.bind=function(t,n){e.callback=t,e.webGLContainer=n,e.bindCanvas(),e.bindWindow()},this.handleOrientationChange=function(){e.orientation=window.orientation||0},this.handleMotion=function(n){if(e.motionTimeStamp||(e.motionTimeStamp=n.timeStamp),e.incrementQuaternion(n),n&&n.timeStamp-e.motionTimeStamp>e.throttle){var r=e.eventDownX,i=e.eventDownY;e.eventDownX=e.orientationQuaternion[0],e.eventDownY=e.orientationQuaternion[1],e.callback(e.buildEvent(n,t.ORIENTATION)),e.eventDownX=r,e.eventDownY=i,e.prevEvent=t.ORIENTATION,e.motionTimeStamp=n.timeStamp,e.orientationQuaternion=[0,0,0,1]}},this.incrementQuaternion=function(t){var n=t.rotationRate?t.rotationRate:{beta:0,gamma:0,alpha:0},r=e.getQuaternion(n.alpha,n.beta,n.gamma);e.orientationQuaternion[0]+=r[0],e.orientationQuaternion[1]+=r[1],e.orientationQuaternion[2]+=r[2]},this.buildEvent=function(t,n){return e.webGLContainer.canvas?{x:e.eventDownX/e.webGLContainer.canvas.offsetWidth,y:1-e.eventDownY/e.webGLContainer.canvas.offsetHeight,dx:2*e.eventDownDx/e.webGLContainer.canvas.offsetWidth,dy:2*e.eventDownDy/e.webGLContainer.canvas.offsetHeight,dxRaw:e.eventDownDx,dyRaw:e.eventDownDy,eventType:n,prevEventType:e.prevEvent,timeStamp:e.timeStamp,prevTimeStamp:e.prevTimeStamp,orientationQuaternion:e.orientationQuaternion,rawEvent:t}:e.NULL_EVENT},this.resize=function(n){e.callback(e.buildEvent(n,t.RESIZE))},this.buildEventKey=function(t,n){return{eventType:n,keyCode:t.key,code:t.code,event:t,keyDown:e.keyDownMap}},this.keyDown=function(n){switch(e.keyDownMap[n.code]=!0,e.callback(e.buildEventKey(n,t.KEY_DOWN)),n.keyCode){case 37:case 39:case 38:case 40:n.preventDefault()}},this.keyUp=function(n){e.keyDownMap[n.code]=!1,e.callback(e.buildEventKey(n,t.KEY_UP))},this.handleMouseUp=function(n){e.eventDown=!1,e.timeStamp=n.timeStamp,e.eventDownX=n.offsetX,e.eventDownY=n.offsetY,e.callback(e.buildEvent(n,t.UP)),e.prevEvent=t.UP,e.prevTimeStamp=n.timeStamp},this.handleEventDown=function(n){1===n.which&&(e.eventDown=!0,e.eventDownX=n.offsetX,e.eventDownY=n.offsetY,e.timeStamp=n.timeStamp,e.callback(e.buildEvent(n,t.DOWN)),e.prevEvent=t.DOWN,e.prevTimeStamp=n.timeStamp)},this.handleEventMove=function(n){if(e.eventDown&&n.timeStamp-e.timeStamp>e.throttle){var r=n.offsetX,i=n.offsetY;e.eventDownDx=e.eventDownX-r,e.eventDownDy=e.eventDownY-i,e.eventDownX=r,e.eventDownY=i,e.timeStamp=n.timeStamp,e.callback(e.buildEvent(n,t.DRAG)),e.prevEvent=t.DRAG,e.prevTimeStamp=n.timeStamp}},this.handleTouchEnd=function(n){e.touchDown=!1,e.timeStamp=n.timeStamp,e.callback(e.buildEvent(n,t.UP)),e.prevEvent=t.UP,e.prevTimeStamp=n.timeStamp},this.handleTouchStart=function(n){e.touchDown=!0,e.timeStamp=n.timeStamp,n.target instanceof HTMLElement&&(e.eventDownX=n.touches[0].clientX-n.target.offsetLeft,e.eventDownY=n.touches[0].clientY-n.target.offsetTop),e.callback(e.buildEvent(n,t.DOWN)),e.prevEvent=t.DOWN,e.prevTimeStamp=n.timeStamp},this.handleTouchMove=function(n){if(e.touchDown&&n.timeStamp-e.timeStamp>e.throttle&&n.target instanceof HTMLElement){var r=n.touches[0].clientX-n.target.offsetLeft,i=n.touches[0].clientY-n.target.offsetTop;e.eventDownDx=(e.eventDownX-r)/2,e.eventDownDy=(e.eventDownY-i)/2,e.eventDownX=r,e.eventDownY=i,e.timeStamp=n.timeStamp,e.callback(e.buildEvent(n,t.DRAG)),e.prevEvent=t.DRAG,e.prevTimeStamp=n.timeStamp}n.preventDefault()}}return t.prototype.bindWindow=function(){t.boundedWindow||(window.addEventListener("mouseup",this.handleMouseUp,!0),window.addEventListener("touchend",this.handleTouchEnd,!0),window.addEventListener("resize",this.resize,!0),window.addEventListener("keydown",this.keyDown,!0),window.addEventListener("keyup",this.keyUp,!0),window.hasOwnProperty("DeviceMotionEvent")&&window.addEventListener("devicemotion",this.handleMotion,!0),window.hasOwnProperty("DeviceOrientationEvent")&&window.addEventListener("orientationchange",this.handleOrientationChange,!0),t.boundedWindow=!0)},t.prototype.bindCanvas=function(){this.webGLContainer.canvas.addEventListener("mousedown",this.handleEventDown,!0),this.webGLContainer.canvas.addEventListener("mousemove",this.handleEventMove,!0),this.webGLContainer.canvas.addEventListener("touchstart",this.handleTouchStart,!0),this.webGLContainer.canvas.addEventListener("touchmove",this.handleTouchMove,!0)},t.prototype.getQuaternion=function(t,e,n){var i=Math.PI/180,o=180/Math.PI,a=e?e*i:0,s=n?n*i:0,u=t?t*i:0,c=Math.cos(a/2),h=Math.cos(s/2),f=Math.cos(u/2),p=Math.sin(a/2),l=Math.sin(s/2),d=Math.sin(u/2),y=c*h*f-p*l*d,v=p*h*f-c*l*d,m=c*l*f+p*h*d,b=c*h*d+p*l*f,g=new r.default(0,0,0);switch(this.orientation){case 90:g.x=-v,g.y=b;break;case 180:g.x=-b,g.y=-v;break;case 270:case-90:g.x=v,g.y=-b;break;default:g.x=b,g.y=v}return[g.x*o/y,-1*g.y*o/y,m*o/y,1]},t.DOWN=1,t.DRAG=2,t.UP=3,t.RESIZE=4,t.ORIENTATION=5,t.KEY_DOWN=6,t.KEY_UP=7,t.SYSTEM_EVENTS=8,t.boundedWindow=!1,t}();e.default=i,e.event=new i},8801:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){if(!t.world)throw new Error("world not defined");this.world=t.world}return t.prototype.update=function(t,e){e.setTime(t),this.world.update(),e.updateFont()},t}();e.default=n},8808:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(5532),i=n(8108),o=function(){function t(t){this.ctx=t,this.program=new r.default(t)}return t.prototype.updatePerspective=function(t){this.program.bindProgram(),this.program.glSetProjectMatrix(t)},t.prototype.delete=function(){this.program.arrayBuffer.delete(this.ctx),this.program.delete()},t.prototype.setLight=function(t,e){this.program.setLight(t,e)},t.prototype.updateBuffer=function(t,e){var n=t.getOpt();if(i.ShaderType.THREE_DIMENSION===n.shaderType){var o=this.program.arrayBuffer.bufferReg[t.rendererBufferId];e&&e.length===o.verticesSize||console.error("New Buffer data does not match initial buffer data!",t,e,o.verticesSize),this.program.arrayBuffer.bufferSub(this.ctx,o.offset,o.size,e,r.default.DRAW_VERTEX_SIZE)}else console.error("Updating buffer for registered 3D Entity but with different shader type as RenderOptions",n)},t.prototype._render3DShadowEntities=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n[0],o=n[1],a=r.getOpt();if(this.program.glSetShadowModelMatrix(o),!r.rendererBufferId)throw new Error("Unregistered entity buffer"+r);var s=this.program.arrayBuffer.bufferReg[r.rendererBufferId];a.renderType===i.RenderType.TRIANGLE?this.ctx.drawArrays(this.ctx.TRIANGLES,s.offset,s.size):this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,s.offset,s.size)}},t.prototype._setupShadow=function(){this.program.bindShadowTexture()},t.prototype.render3DShadowMap=function(t,e){this.program.isShadowEnabled&&(this.ctx.disable(this.ctx.CULL_FACE),this.program.prepareShadowTexture(),this._render3DShadowEntities(t),this.program.revertShadowTexture(),e(),this.ctx.enable(this.ctx.CULL_FACE),this.ctx.cullFace(this.ctx.BACK),this._setupShadow())},t.prototype.render=function(t,e,n){this.program.arrayBuffer.bind(this.ctx),this.program.bindAttributePointers(),this.program.bindProgram(),this.program.glSetViewMatrix(e.viewMatrix),this.ctx.isEnabled(this.ctx.CULL_FACE)||this.ctx.enable(this.ctx.CULL_FACE),this.ctx.isEnabled(this.ctx.DEPTH_TEST)||this.ctx.enable(this.ctx.DEPTH_TEST);for(var r=0;r<t.length;r++){var o=t[r],a=o[0],s=o[1],u=a.getOpt();if(!a.rendererTextureRef)throw new Error("Unregistered entity texture"+a);var c=n[a.rendererTextureRef];if(this.program.bindTexture(c.texture),this.program.glSetModelViewMatrix(s),!a.rendererBufferId)throw new Error("Unregistered entity buffer"+a);var h=this.program.arrayBuffer.bufferReg[a.rendererBufferId];u.renderType===i.RenderType.TRIANGLE?this.ctx.drawArrays(this.ctx.TRIANGLES,h.offset,h.size):this.ctx.drawArrays(this.ctx.TRIANGLE_STRIP,h.offset,h.size)}this.program.arrayBuffer.unbind(this.ctx),this.program.unbindAttributePointers(),this.program.unbindProgram()},t.prototype.bindBuffer=function(){this.program.arrayBuffer.bufferBind(this.ctx)},t.prototype.registerEntity=function(t,e){var n=e.length/r.default.DRAW_VERTEX_SIZE;this.program.arrayBuffer.bufferReg[this.program.arrayBuffer.bufferRegId]={offset:this.program.arrayBuffer.length(),size:n,verticesSize:e.length},this.program.arrayBuffer.push(e,n),t.rendererBufferId=this.program.arrayBuffer.bufferRegId,this.program.arrayBuffer.bufferRegId++},t}();e.default=o},9016:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3893),a=n(6050),s=n(3765),u=n(8108),c=n(9727),h=n(1883),f=function(t){function e(e,n,r){var i=t.call(this)||this,o=new s.default(e.x,e.y,n,n);return i.vertexModel=(new a.default).fillRenderUnits(h.default.vertex.circleXYColour(2*Math.PI*6,r)),i.centerRect(o),i.rotateOriginRect(o),i.scaleRect(o),i}return i(e,t),e.prototype.render=function(t){t.render(this.shaderEntity)},e.prototype.init=function(t){var e=new u.default;e.renderType=u.RenderType.TRIANGLE,e.shaderType=u.ShaderType.COLOUR,this.shaderEntity=new o.default(t).addBuffer(this.vertexModel).build(this,e)},e}(c.default);e.default=f},9148:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(2913),i=function(){function t(t){this.clearColour=new r.default(1,1,1,1),this.ctx=t}return t.prototype.setClearColor=function(t){this.clearColour=t,this.ctx.clearColor(t.r,t.g,t.b,t.a)},t.prototype.setupDefault=function(){this.setClearColor(this.clearColour),this.ctx.enable(this.ctx.BLEND),this.ctx.blendFunc(this.ctx.SRC_ALPHA,this.ctx.ONE_MINUS_SRC_ALPHA),this.ctx.enable(this.ctx.CULL_FACE),this.ctx.frontFace(this.ctx.CCW),this.ctx.cullFace(this.ctx.BACK),this.ctx.clearDepth(1),this.ctx.enable(this.ctx.DEPTH_TEST),this.ctx.depthFunc(this.ctx.LEQUAL)},t.prototype.clear=function(){this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT)},t.prototype.deleteTexture=function(t){this.ctx.deleteTexture(t)},t.prototype.resizeViewPort=function(t){this.ctx.viewport(0,0,t.width,t.height)},t.prototype.getWebGL2RenderingContext=function(){return this.ctx},t.prototype.destroyWebGL=function(){var t=this.ctx,e=this.getWebGL2RenderingContext(),n=!!e.createTransformFeedback;n&&e.bindVertexArray(null);var r=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var o=0;o<r;++o)t.disableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(o,0),n&&e.vertexAttribDivisor(o,0);t.deleteBuffer(i);var a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(o=0;o<a;++o)t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null),n&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(o,null));if(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),n){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);var s=t.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(o=0;o<s;++o)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,null);var u=t.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(o=0;o<u;++o)e.bindBufferBase(e.UNIFORM_BUFFER,o,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}},t.prototype.programInfo=function(t){for(var e=this.ctx.getProgramParameter(t,this.ctx.ACTIVE_ATTRIBUTES),n=0;n<e;++n){var r=this.ctx.getActiveAttrib(t,n);if(!r)break;console.log(this.ctx.getAttribLocation(t,r.name),r.name)}},t}();e.default=i},9172:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.entities=[],e}return i(e,t),e.prototype.setPosition=function(t){this.entities.forEach(function(e){return e.setPosition(t)})},e.prototype.center=function(e,n,r){t.prototype.center.call(this,e,n,r),this.entities.forEach(function(t){return t.center(e,n,r)})},e.prototype.rotateOrigin=function(e,n,r){t.prototype.rotateOrigin.call(this,e,n,r),this.entities.forEach(function(t){return t.rotateOrigin(e,n,r)})},e.prototype.rotateOriginRect=function(t){this.rotateOrigin(t.x,t.y,t.z)},e.prototype.rotateX=function(t){this.angleX(t)},e.prototype.rotateY=function(t){this.angleY(t)},e.prototype.rotateZ=function(t){this.angleZ(t)},e.prototype.angleX=function(e){t.prototype.angleX.call(this,e),this.entities.forEach(function(t){return t.angleX(e)})},e.prototype.angleY=function(e){t.prototype.angleY.call(this,e),this.entities.forEach(function(t){return t.angleY(e)})},e.prototype.angleZ=function(e){t.prototype.angleZ.call(this,e),this.entities.forEach(function(t){return t.angleZ(e)})},e.prototype.scaleX=function(e){t.prototype.scaleX.call(this,e),this.entities.forEach(function(t){return t.scaleX(e)})},e.prototype.scaleY=function(e){t.prototype.scaleY.call(this,e),this.entities.forEach(function(t){return t.scaleY(e)})},e.prototype.scaleZ=function(e){t.prototype.scaleZ.call(this,e),this.entities.forEach(function(t){return t.scaleZ(e)})},e.prototype.scale=function(e,n,r){t.prototype.scale.call(this,e,n,r),this.entities.forEach(function(t){return t.scale(e,n,r)})},e.prototype.translate=function(e,n,r){t.prototype.translate.call(this,e,n,r),this.entities.forEach(function(t){return t.translate(e,n,r)})},e.prototype.init=function(e){t.prototype.init.call(this,e),this.entities.forEach(function(t){return t.init(e)})},e.prototype.render=function(e){this.hidden||(this.entities.forEach(function(t){return t.render(e)}),t.prototype.render.call(this,e))},e.prototype.update=function(e){this.hidden||(this.entities.forEach(function(t){return t.update(e)}),t.prototype.update.call(this,e))},e.prototype.setTop=function(e){t.prototype.setTop.call(this,e),this.entities.forEach(function(t){return t.setTop(e)})},Object.defineProperty(e.prototype,"hidden",{set:function(t){this.$hidden=t,this.shaderEntity&&(this.shaderEntity.hidden=t),this.entities.forEach(function(e){return e.hidden=t})},enumerable:!1,configurable:!0}),e}(n(9727).default);e.default=o},9232:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.bufferArray=[],this.verticeSize=0,this.bufferReg={},this.bufferRegId=1,this.deleted=!1,this.bufferid=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.bufferid)}return t.prototype.delete=function(t){t.deleteBuffer(this.bufferid),this.deleted=!0},t.prototype.bufferBind=function(t){this.deleted||(this.bind(t),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.bufferArray),t.STATIC_DRAW))},t.prototype.length=function(){return this.verticeSize},t.prototype.bufferSub=function(t,e,n,r,i){this.deleted||(this.bind(t),t.bufferSubData(t.ARRAY_BUFFER,e*Float32Array.BYTES_PER_ELEMENT*i,new Float32Array(r)))},t.prototype.reset=function(){this.bufferArray=[]},t.prototype.push=function(t,e){this.bufferArray=this.bufferArray.concat(t),this.verticeSize+=e},t.prototype.bind=function(t){!0!==this.deleted&&t.bindBuffer(t.ARRAY_BUFFER,this.bufferid)},t.prototype.unbind=function(t){},t}();e.default=n},9515:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ParabolicSimulation=void 0;var r=n(9661),i=n(3207),o=function(){function t(){}return t.registerPhysics=function(e){e.$physicsId||(e.$physicsId=t.physicsEntityIdCount++,this.physicsEntities[e.$physicsId]={entity:e,enabled:!0})},t.deregisterPhysics=function(t){void 0!==t.$physicsId&&this.physicsEntities[t.$physicsId]&&delete this.physicsEntities[t.$physicsId]},t.setEnabledPhysics=function(t,e){this.physicsEntities[t.$physicsId]&&(this.physicsEntities[t.$physicsId].enabled=e)},t.isCollidingOffset2d=function(e,n,r){var i=e.position.x+n,o=e.position.y+r;return t.isCollidingPos2d(e,i,o)},t.isCollidingPoint2d=function(e){var n=e.position.x,r=e.position.y;return t.isCollidingPos2d(e,n,r)},t.isCollidingPos2d=function(t,e,n){var r=[];for(var o in this.physicsEntities)if(this.physicsEntities.hasOwnProperty(o)){var a=this.physicsEntities[o],s=a.entity;a.enabled&&s.$physicsId!==t.$physicsId&&i.CollisionDetection.isCollidingRect(s.position.x,s.position.y,s.position.width,s.position.height,e,n,t.position.width,t.position.height)&&r.push(a.entity)}return r},t.generateSimulationId=function(){var t=this.simulationIdCurrent;return this.simulationIdCurrent+=1,t},t.cancelSimulation=function(t){var e=this.simulations[t];e&&(e.completeSimulation&&e.completeSimulation(),delete this.simulations[t])},t.physicsLoop=function(){var t=0;for(var e in this.simulations)if(this.simulations.hasOwnProperty(e)){var n=this.simulations[e];if(n){var r=n.timer.peak();n.runTime+=r,0===n.totalIterations||n.runTime<n.totalRunTime?n.simulation(+e,r,n.totalRunTime):this.cancelSimulation(e),n.timer.start(),n.totalIterations+=1,t++}else delete this.simulations[e]}0===t&&this.simulationLoop&&(clearInterval(this.simulationLoop),this.simulationLoop=void 0)},t.runSimulation=function(t,e,n,i){var o=i||this.generateSimulationId(),a=this.simulations[o];return a?(a.totalRunTime=t,a.runTime=0):this.simulations[o]={timer:(new r.default).start(),simulation:e,totalRunTime:t,completeSimulation:n,totalIterations:0,runTime:0},void 0===this.simulationLoop&&(this.simulationLoop=setInterval(this.physicsLoop.bind(this),this.TIME_STEP_MILLIS)),o},t.parabolicSimulation=function(t,e,n){var r=this;return this.runSimulation(t.totalRunTime,function(n,i){var o=r.simulations[n];if(o){var a=o.runTime,s=t.height,u=t.width,c=t.totalRunTime,h=(1/3+1)*s/u/u,f=h*u,p=s/2/(c/2),l=(Math.sqrt(4*h*p*a+f*f)-f)/(2*h),d=-u/c,y=-(h*d*a*d*a+f*d*a),v=l-t.px,m=y-t.py;t.px=l,t.py=y,e(n,i,v,m)}},n)},t.TIME_STEP_MILLIS=10,t.simulations={},t.simulationIdCurrent=0,t.physicsEntities={},t.physicsEntityIdCount=0,t}();e.default=o;e.ParabolicSimulation=function(){}},9522:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(7285),a=n(8127),s=n(81),u=n(9232),c=n(5169),h=function(t){function e(e){var n=t.call(this,e)||this;return n.arrayBuffer=new u.default(e),n.program=n.compileShaders(s.default,a.default),n.bindProgram(),n.positionRef=new c.default("a_position",e,!0,n.program),n.colorRef=new c.default("a_color",e,!0,n.program),n.modelViewMatrixRef=new c.default("u_model",e,!1,n.program),n.viewMtrx=new c.default("u_view",e,!1,n.program),n.projMtrx=new c.default("u_projection",e,!1,n.program),n}return i(e,t),e.prototype.bindProgram=function(){this._bindProgram(this.program)},e.prototype.unbindProgram=function(){this._unbindProgram()},e.prototype.enableAttribPointers=function(){var t=this.ctx;t.enableVertexAttribArray(this.positionRef.ref),t.enableVertexAttribArray(this.colorRef.ref)},e.prototype.bindAttributePointers=function(){this.enableAttribPointers();var t=this.ctx;t.vertexAttribPointer(this.positionRef.ref,2,t.FLOAT,!1,28,0),t.vertexAttribPointer(this.colorRef.ref,3,t.FLOAT,!1,28,12)},e.prototype.unbindAttributePointers=function(){var t=this.ctx;t.disableVertexAttribArray(this.positionRef.ref),t.disableVertexAttribArray(this.colorRef.ref)},e.prototype.glSetProjectMatrix=function(t){this.ctx.uniformMatrix4fv(this.projMtrx.ref,!1,t)},e.prototype.glSetModelViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.modelViewMatrixRef.ref,!1,t)},e.prototype.glSetViewMatrix=function(t){this.ctx.uniformMatrix4fv(this.viewMtrx.ref,!1,t)},e.DRAW_VERTEX_SIZE=7,e}(o.default);e.default=h},9637:function(t,e,n){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var i=n(5431),o=n(2104),a=n(5854),s=n(9802),u=n(9979),c=n(3765),h=n(3215),f=n(9515),p=function(){function t(t){this.engineHelper=t,this.objects=[],this.ref={},this.anchor={},this.texts=[]}return t.prototype.build=function(t){for(var e in t)if(t.hasOwnProperty(e))if(e.startsWith("$"))this.ref[e]=t[e];else if(e.startsWith("+"))this.anchor[e]=t[e];else{var n=t[e];if(this.initObjectPosition(n),n.$ref&&this.ref[n.$ref]&&(n=r(r({},this.ref[n.$ref]),n)),n.$anchor&&this.anchor[n.$anchor]){var i=this.anchor[n.$anchor];"Font"===n.type?(n.position.x+=i.position.x,n.position.y+=i.position.y):(n.position.x+=i.position.x,n.position.y+=i.position.y,n.position.width+=i.position.width,n.position.height+=i.position.height)}this.buildObject(n)}},t.prototype.initObjectPosition=function(t){t.position?(t.position.x||(t.position.x=0),t.position.y||(t.position.y=0),t.position.width||(t.position.width=0),t.position.height||(t.position.height=0)):t.position={x:0,y:0,height:0,width:0}},t.prototype.buildObject=function(t){t.type?"Plane2D"===t.type?this.createPlane2D(t.model,this.createRect2d(t.position),t.hasPhysics):"Sprite"===t.type?this.createSprite(t.model,this.createRect2d(t.position),t.hasPhysics):"Font"===t.type?this.createText(t.texture,this.createCoordinate(t.position),t.fontSize,t.text):"Colour"===t.type&&this.createColour(t.rgba,this.createRect2d(t.position)):console.error("unable to parse empty type for object",t)},t.prototype.createRect2d=function(t){return new c.default(t.x,t.y,t.width,t.height,0)},t.prototype.createCoordinate=function(t){return new u.default(t.x,t.y,0)},t.prototype.createText=function(t,e,n,r){var i=h.FontReference.newFont(e,t,0).setText(r).setFontSize(n);this.texts.push(i)},t.prototype.createColour=function(t,e){var n=new a.default(e,t);this.objects.push(n)},t.prototype.createSprite=function(t,e,n){var r=new s.default(e,120,t),o=new i.default(e,r);n&&f.default.registerPhysics(o),this.objects.push(o)},t.prototype.createPlane2D=function(t,e,n){var r=new o.default(e,t);r.rotateZ(180),r.setLayer(-1),n&&f.default.registerPhysics(r),this.objects.push(r)},t}();e.default=p},9661:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this._start=Date.now()}return t.prototype.start=function(){return this._start=Date.now(),this},t.prototype.peak=function(){return Date.now()-this._start},t.prototype.stop=function(){this._end=Date.now();var t=this._end-this._start;return this._start=this._end,t},t}();e.default=n},9700:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump int;\nprecision mediump float;\n\nattribute vec3 a_position;\nattribute vec2 a_texture_coords;\nattribute vec3 a_normal;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_model;\n\nuniform vec3 u_light1_pos;\nuniform vec3 u_light1_intensities;\nuniform float u_light1_attenuation;\nuniform float u_light1_ambient_coefficient;\n\nvarying vec2 v_texture_coords;\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying mat4 v_model;\n\nvarying vec3 v_light1_pos;\nvarying vec3 v_light1_intensities;\nvarying float v_light1_attenuation;\nvarying float v_light1_ambient_coefficient;\nvarying float v_diffuseCoefficient;\nvarying float v_attenuation;\n\nstruct Light {\n  vec3 position;\n  vec3 intensities;\n  float ambientCoefficient;\n  float attenuation;\n};\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n    m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n    m[0][1], m[1][1], m[2][1],\n    m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n    m[0][1], m[1][1], m[2][1], m[3][1],\n    m[0][2], m[1][2], m[2][2], m[3][2],\n    m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1], -m[0][1],\n    -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n  a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n    a11 * b11 - a12 * b10 + a13 * b09,\n    a02 * b10 - a01 * b11 - a03 * b09,\n    a31 * b05 - a32 * b04 + a33 * b03,\n    a22 * b04 - a21 * b05 - a23 * b03,\n    a12 * b08 - a10 * b11 - a13 * b07,\n    a00 * b11 - a02 * b08 + a03 * b07,\n    a32 * b02 - a30 * b05 - a33 * b01,\n    a20 * b05 - a22 * b02 + a23 * b01,\n    a10 * b10 - a11 * b08 + a13 * b06,\n    a01 * b08 - a00 * b10 - a03 * b06,\n    a30 * b04 - a31 * b02 + a33 * b00,\n    a21 * b02 - a20 * b04 - a23 * b00,\n    a11 * b07 - a10 * b09 - a12 * b06,\n    a00 * b09 - a01 * b07 + a02 * b06,\n    a31 * b01 - a30 * b03 - a32 * b00,\n    a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nfloat pow3(float x, float y) {\n  return exp2(y * log2(x));\n}\n\nvec3 pow2(vec3 x, vec3 y) {\n  return vec3(pow3(x.x, y.x), pow3(x.y, y.y), pow3(x.z, y.z));\n}\n\nvoid main(void) {\n\n  v_texture_coords = a_texture_coords;\n  v_position = a_position;\n  v_normal = a_normal;\n  v_model = u_model;\n\n  v_light1_pos = u_light1_pos;\n  v_light1_intensities = u_light1_intensities;\n  v_light1_attenuation = u_light1_attenuation;\n  v_light1_ambient_coefficient = u_light1_ambient_coefficient;\n\n  Light light1;\n  light1.intensities = v_light1_intensities;\n  light1.position = v_light1_pos;\n  light1.attenuation = v_light1_attenuation;\n  light1.ambientCoefficient = v_light1_ambient_coefficient;\n\n  vec3 surfacePos = vec3(v_model * vec4(v_position, 1));\n\n  mat3 normalMatrix = transpose(inverse(mat3(v_model)));\n  vec3 normal = normalize(normalMatrix * v_normal);\n\n  vec3 fragPosition = vec3(v_model * vec4(v_position, 1));\n\n  vec3 surfaceToLight = light1.position - fragPosition;\n\n  float brightness = dot(normal, surfaceToLight) / (length(surfaceToLight) * length(normal));\n  if (brightness > 1.0) {\n    brightness = 1.0;\n  } else if (brightness < 0.0) {\n    brightness = 0.0;\n  }\n\n  float distanceToLight = length(light1.position - surfacePos);\n\n  v_diffuseCoefficient = max(0.0, dot(normal, surfaceToLight));\n  v_attenuation = 1.0 / (1.0 + light1.attenuation * pow3(distanceToLight, 2.0));\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);\n}\n"},9727:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$hidden=!1,e.$id="xxxxxxxxx".replace(/[x]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),e.isTop=!1,e}return i(e,t),Object.defineProperty(e.prototype,"shaderEntity",{get:function(){return this._shaderEntity},set:function(t){this._shaderEntity=t,this.isTop=this.isTop},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.$hidden},set:function(t){this.$hidden=t,this.shaderEntity&&(this.shaderEntity.hidden=t)},enumerable:!1,configurable:!0}),e.prototype.setTop=function(t){this.isTop=t,this.shaderEntity&&(this.shaderEntity.isTop=t)},e.prototype.update=function(t){},e.prototype.render=function(t){},e.prototype.event=function(t,e){},e.prototype.init=function(t){},e}(n(4686).default);e.default=o},9788:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.RandomMovementConfig=void 0;var o=n(4686),a=n(9661),s=n(3300),u=function(t){function e(e,n,r){var i=t.call(this)||this;return i.timer=new a.default,i.directionChangeTimer=new a.default,i.moveTimer=new a.default,i.directionY=1,i.directionX=1,i.speedFactorX=1,i.speedFactorY=1,i.setRect(e),i.bound=r,i.config=n,i.initTimers(),i.calcRandomDirection(),i}return i(e,t),e.prototype.initTimers=function(){this.timer.start(),this.directionChangeTimer.start(),this.moveTimer.start()},e.prototype.calcRandomDirection=function(){this.directionY=Math.random()>.5?1:-1,this.directionX=Math.random()>.5?1:-1,this.speedFactorY=Math.random()*this.config.varianceSpeed+this.config.minimumSpeed,this.speedFactorX=Math.random()*this.config.varianceSpeed+this.config.minimumSpeed},e.prototype.updateLocBoundToBoundary=function(){var t=s.default.boundRect(this.bound,this.position);this.position.x>t.x?this.directionX=-1:this.position.x<t.x&&(this.directionX=1),this.position.y>t.y?this.directionY=-1:this.position.y<t.y&&(this.directionY=1),this.center(t.x,t.y,this.position.z)},e.prototype.calculateNewPosition=function(){this.directionChangeTimer.peak()>this.config.directionInterval&&(this.calcRandomDirection(),this.directionChangeTimer.start());var t=0,e=0;if(this.moveTimer.peak()>this.config.moveInterval){this.moveTimer.start();var n=Math.min(this.timer.peak(),1);e=n*this.speedFactorY*this.directionY,t=n*this.speedFactorX*this.directionX}this.translate(t,e,0),this.updateLocBoundToBoundary()},e}(o.default);e.default=u;e.RandomMovementConfig=function(){}},9802:function(t,e,n){var r,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2104),a=n(9661),s=function(t){function e(e,n,r){var i=t.call(this)||this;return i.spriteIdx=0,i.timer=new a.default,i.setRect(e),i.ticks=n,i.textures=r,i}return i(e,t),e.prototype.update=function(t){},e.prototype.render=function(t){this.entities[this.spriteIdx].render(t),this.calcSpriteIdx()},e.prototype.calcSpriteIdx=function(){if(this.timer.peak()>this.ticks){var t=this.entities.length;if(this.spriteIdx+=Math.round(this.timer.peak()/this.ticks),this.spriteIdx>=t){var e=this.spriteIdx/t;this.spriteIdx=Math.round((e-Math.floor(e))*t),this.spriteIdx>=t&&(console.error("index out of bound after shaping",this.spriteIdx),this.spriteIdx=0)}this.timer.start()}},e.prototype.init=function(t){for(var e=0;e<this.textures.length;e++)this.entities.push(new o.default(this.getRect(),this.textures[e]));this.center(this.position.x,this.position.y,this.position.z),this.rotateOrigin(this.position.x,this.position.y,this.position.z),this.rotateZ(180),this.initEntity(t),this.timer.start()},e}(n(7970).default);e.default=s},9862:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nprecision mediump int;\nprecision mediump float;\n\nattribute vec3 a_position;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_model;\nvoid main(void) {\n  gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);\n}\n"},9979:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e,n){this.x=t,this.y=e,this.z=n||0}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{var t=r;Object.defineProperty(t,"__esModule",{value:!0});var e=n(7327),i=n(5282);window.onload=function(){try{var t={world:new e.default,elementId:"app",canvasId:"app-game",error:void 0,subscribe:void 0,camera:{near:.1,far:1e3,fov:45,maxFov:360*Math.atan(.5)/Math.PI,isFovMax:!0},eventThrottle:1e3/60,fps:15,isStepRender:!1},n=new i.default(t);n.run().catch(console.error),n.unpause(),window.onresize=n.resizeScreen}catch(t){console.error(t)}}})(),r})());